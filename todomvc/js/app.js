// Generated by CoffeeScript 1.8.0
"use strict";
var c = function(m){console.log(m);};;
var LengthController, MainController, Renderer, TodoController, TodoList, Todos, routes,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Renderer = {
  template: new EJS({
    url: 'js/todos.ejs'
  }),
  todo_template: new EJS({
    url: 'js/todo.ejs'
  }),
  view: new Sirius.View("#todo-list"),
  render: function(data) {
    var klass, t, template, todos;
    if (data == null) {
      data = [];
    }
    todos = (function() {
      var _i, _len, _results;
      _results = [];
      for (_i = 0, _len = data.length; _i < _len; _i++) {
        t = data[_i];
        klass = t.get("completed") ? "completed" : "";
        _results.push({
          "class_name": klass,
          "title": t.get("title"),
          id: t.get("id")
        });
      }
      return _results;
    })();
    template = this.template.render({
      todos: todos
    });
    return $("#todo-list").html("").html(template);
  },
  add: function(todo) {
    var template, todo_view;
    c("get id: " + (todo.id()));
    template = this.todo_template.render({
      todo: todo
    });
    this.view.render(template).append();
    todo_view = new Sirius.View("li\#" + (todo.id()));
    todo_view.bind(todo);
    return todo.bind(todo_view, {
      transform: function(t) {
        if (t) {
          return "completed";
        } else {
          return "";
        }
      }
    });
  }
};

TodoList = (function(_super) {
  __extends(TodoList, _super);

  TodoList.attrs = [
    "title", {
      completed: false
    }, "id"
  ];

  function TodoList(obj) {
    if (obj == null) {
      obj = {};
    }
    TodoList.__super__.constructor.call(this, obj);
    this._id = "todo-" + (Math.random().toString(36).substring(7));
  }

  TodoList.prototype.is_active = function() {
    return !this.completed();
  };

  TodoList.prototype.is_completed = function() {
    return this.completed();
  };

  return TodoList;

})(Sirius.BaseModel);

Todos = new Sirius.Collection(TodoList, [], {
  on_add: function(todo) {
    Renderer.add(todo);
    return Sirius.Application.get_adapter().and_then(function(adapter) {
      return adapter.fire(document, "length:changed");
    });
  }
});

MainController = {
  root: function() {
    return c("root");
  },
  active: function() {
    return Renderer.render(Todos.filter(function(t) {
      return t.is_active();
    }));
  },
  completed: function() {
    return Renderer.render(Todos.filter(function(t) {
      return t.is_completed();
    }));
  },
  start: function() {
    var model, view;
    view = new Sirius.View("#todoapp");
    model = new TodoList();
    view.bind2(model);
    view.on("#new-todo", "keypress", "todo:create", model);
    Todos.add(new TodoList({
      title: "Create a TodoMVC template",
      completed: true
    }));
    return Todos.add(new TodoList({
      title: "Rule the web"
    }));
  },
  click: function() {
    return c(Todos.all());
  }
};

TodoController = {
  is_enter: function(custom_event, original_event) {
    if (original_event.which === 13) {
      return true;
    }
    return false;
  },
  create: function(custom_event, original_event, model) {
    var todo;
    todo = model.clone();
    Todos.add(todo);
    model.title("");
    return c("id: " + (todo.id()) + " and " + (model.id()));
  },
  mark: function() {
    return c("mark");
  }
};

TodoController = {
  is_enter: function(custom_event, original_event) {
    if (original_event.which === 13) {
      return true;
    }
    return false;
  },
  create: function(custom_event, original_event, model) {
    var todo;
    todo = model.clone();
    Todos.add(todo);
    return model.title("");
  },
  mark: function() {
    return c("mark");
  }
};

LengthController = {
  length_changed: function() {
    var view;
    view = new Sirius.View("#todo-count", function(t) {
      return "" + t + " item left";
    });
    return view.render(Todos.size()).swap();
  }
};

routes = {
  "/": {
    controller: MainController,
    action: "root"
  },
  "/active": {
    controller: MainController,
    action: "active"
  },
  "/completed": {
    controller: MainController,
    action: "completed"
  },
  "application:run": {
    controller: MainController,
    action: "start"
  },
  "todo:create": {
    controller: TodoController,
    action: "create",
    guard: "is_enter"
  },
  "click #btn": {
    controller: MainController,
    action: "click"
  },
  "length:changed": {
    controller: LengthController,
    action: "length_changed"
  }
};

$(function() {
  var app;
  return app = Sirius.Application.run({
    route: routes,
    adapter: new JQueryAdapter()
  });
});
