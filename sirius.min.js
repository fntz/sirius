/*
 Sirius.js v0.8.5
  (c) 2014-2015 fntz
  license: MIT
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,d){b!=Array.prototype&&b!=Object.prototype&&(b[a]=d.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var a=0;return $jscomp.iteratorPrototype(function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.iteratorFromArray=function(b,a){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var d=0,f={next:function(){if(d<b.length){var e=d++;return{value:a(e,b[e]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};
$jscomp.polyfill=function(b,a,d,f){if(a){d=$jscomp.global;b=b.split(".");for(f=0;f<b.length-1;f++){var e=b[f];e in d||(d[e]={});d=d[e]}b=b[b.length-1];f=d[b];a=a(f);a!=f&&null!=a&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
var c=function(b){console.log(b)},Adapter,ComputedField,Sirius,VanillaJsAdapter,slice=[].slice,extend=function(b,a){function d(){this.constructor=b}for(var f in a)hasProp.call(a,f)&&(b[f]=a[f]);d.prototype=a.prototype;b.prototype=new d;b.__super__=a.prototype;return b},hasProp={}.hasOwnProperty,bind=function(b,a){return function(){return b.apply(a,arguments)}};Sirius={VERSION:"0.8.5"};
Adapter=function(){function b(){}b.prototype.bind=function(a,d,b,e){};b.prototype.off=function(a,d,b,e){};b.prototype.fire=function(){3<=arguments.length&&slice.call(arguments,2)};b.prototype.get_property=function(){2<=arguments.length&&slice.call(arguments,1)};b.prototype.get_attr=function(a,d){};b.prototype.set_prop=function(a,d,b){};b.prototype.swap=function(a,d){};b.prototype.append=function(a,d){};b.prototype.prepend=function(a,d){};b.prototype.clear=function(a){};b.prototype.set_attr=function(a,
d,b){};b.prototype.all=function(a){return"object"===typeof a&&1===a.nodeType||9===a.nodeType?a:document.querySelectorAll(a)};b.prototype.get=function(a){return document.querySelector(a)};b.prototype.state=function(a){};return b}();
VanillaJsAdapter=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype._get_element_from_selector=function(a){if("object"===typeof a&&1===a.nodeType)return a;var d=this.all(a);if(0===d.length)throw Error("Selector `"+a+"` not found");return d[0]};a.prototype.bind=function(a,b,e,g){var d,f;if(null===b||b===a)a.addEventListener(e,g);else if("object"===typeof b&&1===b.nodeType)b.addEventListener(e,g);else for(a=this.all(b),b=d=0,f=a.length;0<=f?d<f:d>f;b=
0<=f?++d:--d)a.item(b).addEventListener(e,g)};a.prototype.off=function(a,b,e,g){var d,f;if(null===b||b===a)a.removeEventListener(e,g);else for(a=this.all(b),b=d=0,f=a.length;0<=f?d<f:d>f;b=0<=f?++d:--d)a.item(b).removeEventListener(e,g)};a.prototype.fire=function(){var a=arguments[1];var b=3<=arguments.length?slice.call(arguments,2):[];var e=document.createEvent("CustomEvent");e.initCustomEvent(a,!1,!0,b);document.dispatchEvent(e)};a.prototype.get_property=function(a,b){var d;var f=a.target;var h=
[];var k=0;for(d=b.length;k<d;k++){var l=b[k];h.push(this.get_attr(f,l))}return h};a.prototype.get_attr=function(a,b){var d=this._get_element_from_selector(a);var f=d.getAttribute(b);return null==f?d[b]:f};a.prototype.swap=function(a,b){var d=this._get_element_from_selector(a);var f=d.tagName;"INPUT"===f||"TEXTAREA"===f||"SELECT"===f?d.value=b:d.textContent=b};a.prototype.set_attr=function(a,b,e){this._get_element_from_selector(a).setAttribute(b,e)};a.prototype.set_prop=function(a,b,e){this._get_element_from_selector(a).setAttribute(b,
e)};a.prototype.append=function(a,b){var d=this._get_element_from_selector(a);d.textContent+=b};a.prototype.prepend=function(a,b){var d=this._get_element_from_selector(a);d.textContent=b+d.textContent};a.prototype.clear=function(a){a=this._get_element_from_selector(a);var d=a.tagName;"INPUT"===d||"TEXTAREA"===d?a.value="":a.textContent=""};a.prototype.text=function(a){a=this._get_element_from_selector(a);var d=a.tagName;return"INPUT"===d||"TEXTAREA"===d||"SELECT"===d?a.value:a.innerText?a.innerText:
a.textContent};a.prototype.get_state=function(a){return this._get_element_from_selector(a).checked};return a}(Adapter);
Sirius.Logger=function(){function b(a,d,b){var f;var g=Sirius.Logger.Filters;var h=0;for(f=g.length;h<f;h++){var k=g[h];this[Sirius.Utils.underscore(k).toLowerCase()]=k}var l=Sirius.Logger.Levels;k=function(f){return function(e){return f[e]=function(f,h){if(a){if(!h)return b(e.toUpperCase(),f);if(-1!==d.indexOf(h)||null==h||-1===g.indexOf(h))return f="["+h.toUpperCase()+"] "+f,b(e.toUpperCase(),f)}}}}(this);var m=0;for(h=l.length;m<h;m++)f=l[m],k(f)}b.Levels=["debug","info","warn","error"];b.Filters=
"BaseModel Binding Collection View Routing Application Redirect Validation Transformer".split(" ");return b}();Sirius.Internal={};Sirius.Promise=function(){function b(a){this.value=a;this.fn=function(){}}b.prototype.and_then=function(a){return null!=this.value?a(this.value):this.fn=a};b.prototype.set_value=function(a){this.value=a;return this.fn(a)};return b}();
Sirius.Utils=function(){function b(){}b.is_function=function(a){return"[object Function]"===Object.prototype.toString.call(a)};b.is_string=function(a){return"[object String]"===Object.prototype.toString.call(a)};b.is_array=function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.is_object=function(a){return null!==a&&"object"===typeof a};b.camelize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};b.underscore=function(a){return a.replace(/([A-Z])/g,"_$1").replace(/^_/,"").toLowerCase()};
b.ie_version=function(){var a=window.navigator.userAgent;var d=a.indexOf("MSIE ");var b=a.indexOf("Trident/");return 0<d?parseInt(a.substring(d+5,a.indexOf(".",d)),10):0<b?(d=a.indexOf("rv:"),parseInt(a.substring(d+3,a.indexOf(".",d)),10)):0};b.is_ie9=function(){return 9===this.ie_version()};b.fn_name=function(a){if(this.is_function(a))return a.toString().match(/function ([^\(]+)/)[1];throw Error("Need function, given "+typeof a);};return b}();
Sirius.redirect=function(b){var a=Sirius.Application;a.logger.info("Redirect to "+b,a.logger.redirect);a.use_hash_routing_for_old_browsers&&!a.push_state_support&&(b=0===b.indexOf("#")?b:0===b.indexOf("/")?"#"+b:"#/"+b);if(0===b.indexOf("#")){if(a.push_state_support)return location.replace(b)}else if(a.push_state_support)return Sirius.Internal.RouteSystem.dispatch.call(null,{type:"redirect",target:{href:b}})};
Sirius.Internal.RoutePart=function(){function b(a){this.end=!0;this.start=null;this.parts=[];this.args=[];a=a.replace(/\/$/,"").split("/");""===a[0]&&(a[0]="#");"*"===a[a.length-1]&&(this.end=!1);this.parts=a.slice(0)}b.prototype.match=function(a){this.args=[];var d=a.replace(/\/$/,"").split("/");""===d[0]&&(d[0]="#");if(d.length!==this.parts.length&&this.end||1<this.parts.length&&d.length<this.parts.length)return!1;var b=function(a){return 0===a.indexOf(":")};var e=function(a){return 0===a.indexOf("[")};
var g=function(a){return 0===a.indexOf("*")};var h=-1;for(a=[];10>h;){h++;var k=[this.parts[h],d[h]];var l=k[0];k=k[1];if(!l||!k)break;if(b(l))a.push(d[h]);else if(e(l)){l=new RegExp("^"+l+"$");if(!l.test(k))return!1;a.push(l.exec(k)[0])}else{if(g(l)){a=a.concat(d.slice(h));break}if(l!==k)return!1}}this.args=a;return!0};return b}();
Sirius.Internal.ControlFlow=function(){function b(a,d){null==d&&(d=function(a){return a});this.logger=Sirius.Application.get_logger();var b;if(!(b=a.controller))throw Error("Params must contain a Controller");var e=a.action;if(Sirius.Utils.is_string(e))var g=b[e];else if(Sirius.Utils.is_function(e))g=e;else throw g="Action must be string or function",this.logger.error("ControlFlow: "+g,this.logger.routing),Error(g);if(!g)throw g="action "+e+" not found in controller "+b,this.logger.error("ControlFlow: "+
g,this.logger.routing),Error(g);this.action=d(g);g=function(d,f){null==f&&(f=!1);var g=a[d];var h=b[d+"_"+e];var k=function(a){return Error(a+" action must be string or function")};if(Sirius.Utils.is_string(g)){h=b[g];if(!Sirius.Utils.is_function(h))throw k(Sirius.Utils.camelize(d));return h}if(Sirius.Utils.is_function(g))return g;if(g)throw k(Sirius.Utils.camelize(d));if(h){if(!Sirius.Utils.is_function(h))throw k(Sirius.Utils.camelize(d));return h}return f?null:function(){}};this.before=g("before");
this.after=g("after");this.guard=g("guard",!0);this.data=a.data||null;this.controller=b}b.prototype.handle_event=function(){var a;var d=arguments[0];var b=2<=arguments.length?slice.call(arguments,1):[];this.logger.debug("ControlFlow: Start event processing",this.logger.routing);if(d){var e=Sirius.Utils.is_array(this.data)?this.data:this.data?[this.data]:[];e=Sirius.Application.adapter.get_property(d,e);d=[].concat([],[d],e);d=(a=[]).concat.apply(a,[[],d].concat(slice.call(b)));if(this.guard){if(this.guard.apply(this.controller,
d))return this.before.apply(this.controller),this.action.apply(this.controller,d),this.after.apply(this.controller)}else return this.before.apply(this.controller),this.action.apply(this.controller,d),this.after.apply(this.controller)}else if(b=[].concat.apply([],b),this.guard){if(this.guard.apply(this.controller,b))return this.before.apply(this.controller),this.action.apply(this.controller,b),this.after.apply(this.controller)}else return this.before.apply(this.controller),this.action.apply(this.controller,
b),this.after.apply(this.controller)};b.prototype.tick=function(){this.logger.debug("ControlFlow: tick",this.logger.routing);if(this.guard){if(this.guard.apply(this.controller))return this.before.apply(this.controller),this.action.apply(this.controller),this.after.apply(this.controller)}else return this.before.apply(this.controller),this.action.apply(this.controller),this.after.apply(this.controller)};return b}();
Sirius.Internal.RouteSystem={_every:"every",_scheduler:"scheduler",_once:"once",_selector:"a:not([href^='#'])",_is_hash_route:function(b){return 0===b.toString().indexOf("#")},_is_404_route:function(b){return"404"===b.toString()},_is_plain_route:function(b){return 0===b.toString().indexOf("/")},_is_scheduler_command:function(b){return 0===b.lastIndexOf(this._scheduler)||0===b.lastIndexOf(this._once)||0===b.lastIndexOf(this._every)},_is_event_route:function(b){return!this._is_hash_route(b)&&!this._is_404_route(b)&&
!this._is_plain_route(b)&&!this._is_scheduler_command(b)},_get_time_unit:function(b,a){var d;if(d=a.match(/^(\d+)(ms|s|m)/)){var f=parseInt(d[1],10);d=d[2]||"s";return"ms"===d?f:"s"===d?1E3*f:6E4*f}throw Error("Bad time unit: "+a+" in "+b+", available units: 'ms', 's', 'm'");},_get_scheduler_params:function(b){var a=b.split(" ");var d="Define time unit for scheduler, for example: 'every 10s', given: "+b;if(1===a.length)throw Error(d);if(2===a.length)return d=Sirius.Internal.RouteSystem._get_time_unit(b,
a[1]),{delay:null,time:d};if(3===a.length)return d=Sirius.Internal.RouteSystem._get_time_unit(b,a[1]),b=Sirius.Internal.RouteSystem._get_time_unit(b,a[2]),{delay:d,time:b};throw Error(d);},_scheduler_register:function(b,a,d,f){var e;var g=this._every;var h=this._scheduler;var k=this._get_scheduler_params;var l=[];for(e in b)d=b[e],this._is_scheduler_command(e)&&l.push(function(d,b){var e=Sirius.Utils.is_function(b)?a(b):function(){return(new Sirius.Internal.ControlFlow(b,a)).tick()};var l=k(d);f.debug("Define scheduler for '"+
d+"' with "+JSON.stringify(l),f.routing);return 0===d.lastIndexOf(g)||0===d.lastIndexOf(h)?null===l.delay?setInterval(e,l.time):setTimeout(function(){return setInterval(e,l.time)},l.delay):null===l.delay?setTimeout(e,l.time):setTimeout(function(){return setTimeout(e,l.time)},l.delay)}(e,d));return l},_event_register:function(b,a,d,f){var e;var g=[];for(e in b){var h=b[e];this._is_event_route(e)&&g.push(function(b,e){var g=Sirius.Utils.is_function(e)?a(e):function(){var d=arguments[0];var b=2<=arguments.length?
slice.call(arguments,1):[];return(new Sirius.Internal.ControlFlow(e,a)).handle_event(d,b)};var h=b.match(/^([a-zA-Z:]+)(\s+)?(.*)?/);var k=h[1];h=h[3]||document;d.bind(document,h,k,g);return f.debug("RouteSystem: define event route: '"+k+"' for '"+h+"'",f.routing)}(e,h))}return g},_get_hash_routes:function(b,a,d,f){var e=[];for(g in b)if(d=b[g],this._is_hash_route(g)){f.info("RouteSystem: define hash route: '"+g+"'",f.routing);var g=new Sirius.Internal.RoutePart(g);d=Sirius.Utils.is_function(d)?a(d):
new Sirius.Internal.ControlFlow(d,a);e.push([g,d])}return e},_get_plain_routes:function(b,a,d,f){var e=[];for(g in b)if(d=b[g],this._is_plain_route(g)){f.debug("RouteSystem: define route: '"+g+"'",f.routing);var g=new Sirius.Internal.RoutePart(g);d=Sirius.Utils.is_function(d)?a(d):new Sirius.Internal.ControlFlow(d,a);e.push([g,d])}return e},create:function(b,a,d){var f;null==d&&(d=function(){});var e=Sirius.Application.get_logger();var g=f=window.location.hash;var h=a.old;var k=a.support;var l=a.ignore;
return Sirius.Application.get_adapter().and_then(function(a){return function(p){if(h&&!k){e.info("RouteSystem: Convert plain routing into hash routing",e.routing);var r=[];var m={};for(n in b){var q=b[n];a._is_hash_route(n)&&r.push(n);if(a._is_plain_route(n)){var n="#"+n;-1!==r.indexOf(n)&&e.warn("RouteSystem: Routes already defined '"+n+"' url",e.routing)}m[n]=q}b=m}var u=function(a){var d;var b=Sirius.Application.controller_wrapper;for(d in b){var e=b[d];this[d]=e}return a};a._event_register(b,
u,p,e);a._scheduler_register(b,u,p,e);var w=a._get_hash_routes(b,u,p,e);var x=a._get_plain_routes(b,u,p,e);var y=function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1};var v=function(a){var d,h,r;f=g;var m=r=!1;e.info("RouteSystem: start processing route: '"+g+"'",e.routing);if("hashchange"===a.type){var q=w;g=window.location.hash;var n=window.location.origin;m=!0;k?history.pushState({href:g},""+g,n+"/"+g):history.replaceState({href:g},""+g,n+"/"+g)}else q=x,n=a.target.href,"popstate"!==
a.type&&k&&history.pushState({href:n},""+n,n),n=window.location.pathname,""===n&&(n="/"),g=n;var t=0;for(d=q.length;t<d;t++){var v=q[t];n=v[0];(h=n.match(g))&&!r&&(r=!0,v=v[1],v.handle_event?v.handle_event(null,n.args):v.apply(null,n.args))}r?(y(a),e.debug("RouteSystem: Url change to: "+g,e.routing),p.fire(document,"application:urlchange",g,f)):l?(m&&e.warn("Seems you ignore hash based urls: "+g),e.debug("ignore_not_matched_urls is enabled, url was not matched: '"+g+"'")):(e.warn("RouteSystem: route '"+
g+"' not found. Generate 404 event",e.routing),p.fire(document,"application:404",g,f),(m=b["404"]||b[404])&&(Sirius.Utils.is_function(m)?u(m)(g):(new Sirius.Internal.ControlFlow(m,u)).handle_event(null,g)),y(a))};a.dispatch=v;0!==x.length&&p.bind(document,a._selector,"click",v);window.onhashchange=v;k&&p.bind(window,null,"popstate",function(a){if(history&&null!=history.state&&void 0!==history.state.href&&0!==history.state.href.indexOf("#"))return v(a)});return d()}}(this))}};
Sirius.Application={log:!1,adapter:null,running:!1,route:{},start:!1,controller_wrapper:{redirect:Sirius.redirect},mix_logger_into_controller:!0,use_hash_routing_for_old_browsers:!0,ignore_not_matched_urls:!0,default_log_function:function(b,a){return console&&console.log?console.log(b+": "+a):alert("Not supported `console`. You should define own `logger` function for Sirius.Application")},log_filters:[],_wait:[],_messages_queue:[],get_logger:function(){var b;if(this.logger)return this.logger;var a=
Sirius.Logger.Levels;var d={};var f=this._messages_queue;var e=function(a){return d[a]=function(d,b){return f.push([a,d,b])}};var g=0;for(b=a.length;g<b;g++){var h=a[g];e(h)}b=Sirius.Logger.Filters;h=0;for(g=b.length;h<g;h++)e=b[h],d[Sirius.Utils.underscore(e).toLowerCase()]=e;return d},get_adapter:function(){if(null==this.adapter){var b=new Sirius.Promise;this._wait.push(b);return b}return new Sirius.Promise(this.adapter)},run:function(b){var a;null==b&&(b={});var d=function(a,d){return null!=b[a]?
b[a]:d};this.running=!0;this.log=b.log||this.log;this.adapter=b.adapter||new VanillaJsAdapter;this.route=b.route||this.route;this.mix_logger_into_controller=d("mix_logger_into_controller",this.mix_logger_into_controller);this.log_filters=b.log_filters||this.log_filters;this.ignore_not_matched_urls=d("ignore_not_matched_urls",this.ignore_not_matched_urls);if("all"===this.log_filters)this.log_filters=Sirius.Logger.Filters;else if(0<this.log_filters.length){var f=Sirius.Logger.Filters;var e=this.log_filters;
if("number"===typeof this.log_filters[0]){var g=e.sort()[e.length-1];var h=e.sort()[0];if(0>h)throw Error("Undefined index for log filters "+h);if(g>f.length)throw Error("Undefined index for log filters "+g);this.log_filters=e.map(function(a){return f[a]})}else if(g=this.log_filters.filter(function(a){return-1===f.indexOf(a)}),0!==g.length)throw Error("Check log filters given `"+e+"`. Allow "+f);}else this.log_filters=[];this.logger=new Sirius.Logger(this.log,this.log_filters,b.logger||this.default_log_function);
this.start=b.start||this.start;e=b.controller_wrapper||{};for(a in e)g=e[a],this.controller_wrapper[a]=g;this.hash_always_on_top=d("hash_always_on_top",this.hash_always_on_top);this.use_hash_routing_for_old_browsers=d("use_hash_routing_for_old_browsers",this.use_hash_routing_for_old_browsers);this.logger.info("Logger enabled? "+this.log,this.logger.application);this.logger.info("Log filters: "+this.log_filters,this.logger.application);this.logger.info("Adapter: "+Sirius.Utils.fn_name(this.adapter.constructor),
this.logger.application);this.logger.info("Use hash routing for old browsers: "+this.use_hash_routing_for_old_browsers,this.logger.application);this.logger.info("Current browser: "+navigator.userAgent,this.logger.application);this.logger.info("Ignore not matched urls: "+this.ignore_not_matched_urls,this.logger.application);this.push_state_support=history.pushState?!0:!1;this.logger.info("History pushState support: "+this.push_state_support,this.logger.application);!this.push_state_support&&this.use_hash_routing_for_old_browsers&&
this.logger.warn("You browser not support pushState, and you disable hash routing for old browser",this.logger.application);this.logger.info("Mix logger in controllers "+this.mix_logger_into_controller,this.logger.application);this.mix_logger_into_controller&&(this.controller_wrapper.logger&&this.logger.warn("Logger method already in `controller_wrapper`",this.logger.application),d=this.logger,this.controller_wrapper.logger={info:d.info,debug:d.debug,warn:d.warn,error:d.error});Sirius.Internal.RouteSystem.create(this.route,
{old:this.use_hash_routing_for_old_browsers,support:this.push_state_support,ignore:this.ignore_not_matched_urls},function(a){return function(){var d;var b=a._wait;var e=0;for(d=b.length;e<d;e++){var f=b[e];f.set_value(a.adapter)}a.adapter.fire(document,"application:run",new Date);b=a._messages_queue;var g=[];f=0;for(e=b.length;f<e;f++)d=b[f],g.push(a.logger[d[0]].call(null,d[1],d[2]));return g}}(this));if(this.start)return Sirius.redirect(this.start)}};
Sirius.Validator=function(){function b(){this.logger=Sirius.Application.get_logger();this.msg=null}b.prototype.error_message=function(){return this.msg};return b}();
Sirius.LengthValidator=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype.validate=function(a,b){this.logger.info("LengthValidator: start validate '"+a+"'",this.logger.validation);if(null!=a){var d=b.max||Number.POSITIVE_INFINITY;var f=b.min||Number.NEGATIVE_INFINITY;var h=b.length;var k=a.length;if(h){if(k===h)return!0;this.msg="Required length: "+h+", given: "+k;return!1}if(k>=f&&k<=d)return!0;this.msg="Required length in range [0.."+d+"], given: "+
k;return!1}this.msg="Given null for LengthValidator";return!1};return a}(Sirius.Validator);Sirius.ExclusionValidator=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype.validate=function(a,b){this.logger.info("ExclusionValidator: start validate '"+a+"'",this.logger.validation);if(-1===(b.within||[]).indexOf(a))return!0;this.msg="Value "+a+" reserved";return!1};return a}(Sirius.Validator);
Sirius.InclusionValidator=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype.validate=function(a,b){this.logger.info("InclusionValidator: start validate '"+a+"'",this.logger.validation);var d=b.within||[];if(-1<d.indexOf(a))return!0;this.msg="Value "+a+" should be in range "+d;return!1};return a}(Sirius.Validator);
Sirius.FormatValidator=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype.validate=function(a,b){this.logger.info("FormatValidator: start validate '"+a+"'",this.logger.validation);var d;if(!(d=b["with"]))throw Error("format attribute required");if(null!=a){if(d.test(a))return!0;this.msg="Value "+a+" not for current format";return!1}this.msg="Given null for Format";return!1};return a}(Sirius.Validator);
Sirius.NumericalityValidator=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype.validate=function(a,b){null==b&&(b={});this.logger.info("NumericalityValidator: start validate '"+a+"'",this.logger.validation);if(b.only_integers){if(/^\d+$/.test(a))return!0;this.msg="Only allows integer numbers";return!1}if(/^\d+(?:\.\d{1,})?$/.test(a))return!0;this.msg="Only allows numbers";return!1};return a}(Sirius.Validator);
Sirius.PresenceValidator=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype.validate=function(a,b){this.logger.info("PresenceValidator: start validate '"+a+"'",this.logger.validation);if(a)return!0;this.msg="Value required";return!1};return a}(Sirius.Validator);
Sirius.Internal.CacheHandlerProperty=function(){function b(a,d,b,e,g,h){this.from_element=a;this.watch_for=d;this.event=b;this.handler=e;this.observer=g;this.config=h}b.prototype.is_observer=function(){return null!==this.observer};b.prototype.is_listener=function(){return!this.is_observer};return b}();
Sirius.Internal.CacheObserverHandlers={_handlers:[],add_new_observer:function(b,a,d,f,e){b=new Sirius.Internal.CacheHandlerProperty(b,a,null,d,f,e);return this._handlers.push(b)},add_new_bind_event:function(b,a,d,f){b=new Sirius.Internal.CacheHandlerProperty(b,a,d,f,null);return this._handlers.push(b)},find_by_element:function(b){return this._handlers.filter(function(a){return a.from_element===b})},find_by_element_and_watch_for:function(b,a){return this._handlers.filter(function(d){return d.from_element===
b&&d.watch_for===a})},find_by_element_watch_for_and_event:function(b,a,d){return this._handlers.filter(function(f){return f.from_element===b&&f.watch_for===a&&f.event===d})}};
Sirius.Internal.Observer=function(){function b(a,d,b,f){this.from_element=a;this.original=d;this.watch_for=b;this.clb=null!=f?f:function(){};this._create=bind(this._create,this);Sirius.Application.get_adapter().and_then(this._create)}var a=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver||null;var d=["INPUT","TEXTAREA","SELECT"];var f=["checkbox","radio"];b.Ev={input:"input",selectionchange:"selectionchange",childList:"childList",change:"change",DOMNodeInserted:"DOMNodeInserted",
focusout:"focusout",focusin:"focusin",DOMAttrModified:"DOMAttrModified"};b.TextEvents=[b.Ev.input,b.Ev.childList,b.Ev.change,b.Ev.DOMNodeInserted,b.Ev.selectionchange];b.is_text_event=function(a){return-1!==this.TextEvents.indexOf(a.type)};b.is_focus_event=function(a){return-1!==[this.Ev.focusin,this.Ev.focusout].indexOf(a.type)};b.prototype._create=function(b){var e=Sirius.Application.get_logger();var h=this.clb;var k=this.from_element;var l=this.original;var m=null;var p=this.watch_for;var r=b.get_attr(k,
"tagName");var t=b.get_attr(k,"type");e.debug("Create binding for "+k,e.binding);var q=Sirius.Internal.Observer;var n=function(a){e.debug("Handler Function: given "+a.type+" event",e.binding);var d={text:null,attribute:null,from:k,original:l,element:a.target};if(!q.is_focus_event(a)){var f=b.text(k);if(-1===[q.Ev.input,q.Ev.selectionchange].indexOf(a.type)||f!==m){q.is_text_event(a)&&(m=d.text=f);a.type===q.Ev.change&&(d.state=b.get_state(k));if("attributes"===a.type){f=a.attributeName;var g=a.oldValue||
[];var r=b.get_attr(k,f);d.text=r;d.attribute=f;d.previous=g}a.type===q.Ev.DOMAttrModified&&(f=a.originalEvent.attrName,g=a.originalEvent.prevValue,r=b.get_attr(k,f),d.text=r,d.attribute=f,d.previous=g);return h(d)}}};if("text"===p)if(-1!==d.indexOf(r)){e.debug("It is not a "+d,e.binding);if(-1!==f.indexOf(t)||"OPTION"===r)return e.debug("Get a "+t+" & "+r+" element for bool elements",e.binding),b.bind(document,k,q.Ev.change,n),Sirius.Internal.CacheObserverHandlers.add_new_bind_event(k,p,q.Ev.change,
n);m=b.text(k);b.bind(document,k,q.Ev.input,n);Sirius.Internal.CacheObserverHandlers.add_new_bind_event(k,p,q.Ev.input,n);if(Sirius.Utils.is_ie9())return e.warn("Hook for work with IE9 browser",e.binding),b.bind(document,k,q.Ev.selectionchange,n),Sirius.Internal.CacheObserverHandlers.add_new_bind_event(k,p,q.Ev.selectionchange,n)}else return e.warn("Seems you try to bind for "+r+" of "+t+" for 'text' which is not supported");else{if(a){e.debug("MutationObserver support",e.binding);var u=new a(function(a){return a.forEach(n)});
r={childList:!0,attributes:!0,characterData:!0,attributeOldValue:!0,characterDataOldValue:!0,subtree:!1};t=b.get(k);u.observe(t,r);return Sirius.Internal.CacheObserverHandlers.add_new_observer(k,p,n,u,r)}e.warn("MutationObserver not supported",e.binding);e.warn("Use Deprecated events for observe",e.binding);b.bind(document,k,q.Ev.DOMNodeInserted,n);b.bind(document,k,q.Ev.DOMAttrModified,n);Sirius.Internal.CacheObserverHandlers.add_new_bind_event(k,p,q.Ev.DOMNodeInserted,n);return Sirius.Internal.CacheObserverHandlers.add_new_bind_event(k,
p,q.Ev.DOMAttrModified,n)}};return b}();
Sirius.View=function(){function b(a,b){var d;this.element=a;this.clb=null!=b?b:function(a){return a};var f=this.element;var h=this.clb;var k=Sirius.View._Cache.filter(function(a){return a.element===f&&""+a.clb===""+h});if(0!==k.length)return k[0];this._listeners=[];this._cache_event_handlers=[];this.logger=Sirius.Application.get_logger();this._result_fn=function(){var a=1<=arguments.length?slice.call(arguments,0):[];return h.apply.apply(h,[null].concat(slice.call(a)))};this.logger.debug("Create a new View for "+
this.element,this.logger.view);var l=this.constructor._Strategies;k=function(a){return function(b){var d=b[0];a.logger.debug("Define "+d+" strategy",a.logger.view);var e=b[1];var g=b[2];return a[d]=function(b){null==b&&(b="text");var d=a._result;f=a.element;a.logger.debug("Start processing strategy for "+f,a.logger.view);return Sirius.Application.get_adapter().and_then(function(a){var h="text"===b?a.text(f):a.get_attr(f,b);h=e(h,d);return g(a,f,h,b)})}}}(this);var m=0;for(d=l.length;m<d;m++){var p=
l[m];k(p)}Sirius.View._Cache.push(this);return this}b.prototype.name=function(){return"View"};b._Strategies=[];b._Cache=[];var a=function(){function a(a,b,d){this.selector=a;this.event_name=b;this.custom_event_name=d}a.prototype.eq=function(a){return this.selector===a.selector&&this.event_name===a.event_name&&this.custom_event_name.toString===a.custom_event_name.toString};return a}();b.prototype.get_element=function(){return this.element};b.prototype._register_state_listener=function(a){this.logger.debug("Register new listener for element: "+
this.get_element,this.logger.view);return this._listeners.push(a)};b.prototype.render=function(){var a=1<=arguments.length?slice.call(arguments,0):[];this.logger.debug("Call render for "+a,this.logger.view);this._result=this._result_fn(a);return this};b.prototype.zoom=function(a){a=a===this.element?this:new Sirius.View(this.element+" "+a);a._result=this._result;return a};b.prototype.on=function(){var b=arguments[0];var f=arguments[1];var e=arguments[2];var g=4<=arguments.length?slice.call(arguments,
3):[];b=b===this.element?b:this.element+" "+b;if(Sirius.Utils.is_string(e))var h=0;else if(Sirius.Utils.is_function(e))h=1;else throw Error("View: 'custom_event_name' must be string or function, "+typeof e+" given");var k=new a(b,f,e);var l=this._cache_event_handlers.filter(function(a){return a.eq(k)});if(0===l.length)if(this.logger.info("Bind event for "+b+", event name: "+f+", will be called : "+e,this.logger.view),0===h){var m=function(a){return Sirius.Application.get_adapter().and_then(function(b){var d;
return(d=b.fire).call.apply(d,[null,document,e,a].concat(slice.call(g)))})};Sirius.Application.get_adapter().and_then(function(a){return a.bind(document,b,f,m)});l=new a(b,f,m);this._cache_event_handlers.push(l)}else Sirius.Application.get_adapter().and_then(function(a){return a.bind(document,b,f,e)}),this._cache_event_handlers.push(k);else{var p=l.shift();l=this._cache_event_handlers.indexOf(p);-1<l&&this._cache_event_handlers.splice(l,1);this._cache_event_handlers.push(k);Sirius.Application.get_adapter().and_then(function(a){a.off(document,
b,f,p.custom_event_name);p=null;return a.bind(document,b,f,e)})}};b.prototype.for_me=function(){var a=arguments[0];var b=arguments[1];var e=3<=arguments.length?slice.call(arguments,2):[];return this.on.apply(this,[this.get_element(),a,b].concat(slice.call(e)))};b.prototype.get_attr=function(a){var b=this.get_element();return Sirius.Application.get_adapter().and_then(function(d){return d.get_attr(b,a)})};b.is_valid_strategy=function(a){return 0!==this._Strategies.filter(function(b){return b[0]===a}).length};
b.prototype.bind=function(a,b){return this.pipe(a,b)};b.prototype.pipe=function(a,b){(new Sirius.Transformer(this,a)).run(b)};b.register_strategy=function(a,b){null==b&&(b={});var d=Sirius.Application.get_logger();d.info("View: Register new Strategy "+a,d.view);var f=b.transform;var h=b.render;if(!Sirius.Utils.is_function(f))throw h="Strategy must be Function, but "+typeof f+" given.",d.error("View: "+h,d.view),Error(h);if(!Sirius.Utils.is_function(h))throw h="Strategy must be Function, but "+typeof h+
" given.",d.error("View: "+h,d.view),Error(h);if(!Sirius.Utils.is_string(a))throw h="Strategy name must be String, but "+typeof a+" given.",d.error("View: "+h,d.view),Error(h);this._Strategies.push([a,f,h]);return null};return b}();Sirius.View.register_strategy("swap",{transform:function(b,a){return""+a},render:function(b,a,d,f){return"text"===f?b.swap(a,d):"checked"===f?(d=Sirius.Utils.is_string(d)?"true"===d?!0:!1:!!d,b.set_prop(a,"checked",d)):b.set_attr(a,f,d)}});
Sirius.View.register_strategy("append",{transform:function(b,a){return a},render:function(b,a,d,f){var e=b.get_attr(a,"tagName");if("INPUT"===e||"TEXTAREA"===e||"SELECT"===e)throw Error("'append' strategy not work for `input` or `textarea` or `select` elements");if("text"===f)return b.append(a,d);throw Error("Strategy 'append' only work for 'text' content, not for '"+f+"'");}});
Sirius.View.register_strategy("prepend",{transform:function(b,a){return a},render:function(b,a,d,f){var e=b.get_attr(a,"tagName");if("INPUT"===e||"TEXTAREA"===e||"SELECT"===e)throw Error("'prepend' strategy not work for `input` or `textarea` or `select` elements");if("text"===f)return b.prepend(a,d);throw Error("Strategy 'prepend' only work for 'text' content, not for '"+f+"'");}});Sirius.View.register_strategy("clear",{transform:function(b,a){return""},render:function(b,a,d,f){return b.clear(a)}});
ComputedField=function(){function b(a,b,f){this.main=a;this.fields=b;this.fn=null!=f?f:null;this._count=this.fields.length;this._values=[]}b.prototype.get_fields=function(){return this.fields};b.prototype.complete=function(a,b){var d={};d[a]=b;return-1===this._values.map(function(a){return Object.keys(a)[0]}).indexOf(a)?(this._values.push(d),this.is_full()?this._result():null):null};b.prototype.field_name=function(){return this.main};b.prototype.remove=function(a){return delete this._values[a]};b.prototype._result=
function(){var a=this._values;var b=this.fields.map(function(b){return a.filter(function(a){return a[b]})[0][b]});return null===this.fn?b.join(" "):this.fn.apply(null,b)};b.prototype.is_full=function(){return this._values.length===this._count};return b}();
Sirius.BaseModel=function(){function b(a){var b,f,e,g;null==a&&(a={});(b=this.constructor.prototype)._cmp||(b._cmp=[]);(f=this.constructor.prototype)._cmp_fields||(f._cmp_fields=[]);this._listeners=[];this.logger=Sirius.Application.get_logger();this.errors={};this.attributes=this.normalize_attrs();var h=Sirius.Utils.fn_name(this.constructor);this.errors={};this._is_valid_attr={};f=this.attrs();var k=0;for(e=f.length;k<e;k++)if(b=f[k],this.logger.info("define '"+JSON.stringify(b)+"' attribute for '"+
h+"'",this.logger.base_model),Sirius.Utils.is_object(b)){var l=Object.keys(b);l=l[0];if(!l)throw this.logger.error("Attributes should have a key and value",this.logger.base_model),Error("Attributes should have a key and value");this["_"+l]=b[l];this._gen_method_name_for_attribute(l)}else this._gen_method_name_for_attribute(b),this["_"+b]=null;var m=this.constructor.skip;f=this.attributes;if(0!==Object.keys(a).length){var p=Object.keys(a);e=0;for(k=p.length;e<k;e++)b=p[e],-1===f.indexOf(b)&&m||(this._attribute_present(b),
h=this["_"+b],this["_"+b]=a[b],this._call_callbacks(b,a[b],h))}f=this.guid_for();k=0;for(b=f.length;k<b;k++)a=f[k],this.logger.debug("Generate guid for '"+this._klass_name()+"."+a+"'",this.logger.base_model),this.set(a,this._generate_guid());this._registered_validators=this.constructor._Validators;this._registered_validators_keys=this._registered_validators.map(function(a){return a[0]});a=this._model_validators=this.validators();for(l in a)for(g in b=a[l],this.errors[l]={},this._is_valid_attr[l]=
!1,b)if(-1===this._registered_validators_keys.indexOf(g)&&"validate_with"!==g)throw Error("Unregistered validator: "+g);this.after_create()}b._Validators=[];b.attrs=[];b.skip=!1;b.guid_for=null;b.validate={};b.comp=function(){var a,b,f,e;var g=1<=arguments.length?slice.call(arguments,0):[];(a=this.prototype)._cmp||(a._cmp=[]);(b=this.prototype)._cmp_fields||(b._cmp_fields=[]);(f=this.prototype)._cmp_refs||(f._cmp_refs={});if(0===g.length)throw new Exception("Compute field is empty");if(2===g.length)throw new Exception('Define compute field like: \'@comp("default_computed_field", "first_name", "last_name")\'');
var h=g[0];a=g.length;b=Sirius.Utils.is_function(g[a-1])?(e=g[a-1],[g.slice(1,a-1),g.slice(1,a-1),e]):[g.slice(1),g.slice(1),null];g=b[0];a=b[1];e=b[2];b=[h].concat(g);if(b.filter(function(a,b,d){return d.indexOf(a)===b}).length!==b.length)throw Error("Seems your calculated fields are not unique: ["+b+"]");var k=this.attrs.concat(this.prototype._cmp_fields);g.forEach(function(a){if(-1===k.indexOf(a))throw Error("Field is '"+a+"' not found, for '"+h+"'");});if(0<this.prototype._cmp_fields.length&&
(b=g.filter(function(a){return function(b){return a.prototype._cmp_refs[b]&&-1!==a.prototype._cmp_refs[b].indexOf(h)}}(this)),0<b.length))throw Error("Cyclic references detected in '"+h+"' field");Sirius.Application.get_logger().info("Define compute field '"+h+"' <- '["+g+"]'",Sirius.Application.get_logger().base_model);this.prototype._cmp_refs[h]=g;this.prototype._cmp_fields.push(h);return this.prototype._cmp.push(new ComputedField(h,a,e))};b.prototype.attrs=function(){return(this.constructor.attrs||
[]).concat(this.constructor.prototype._cmp_fields)};b.prototype.__name="BaseModel";b.prototype.normal_name=function(){return Sirius.Utils.underscore(this.constructor.name)};b.prototype._klass_name=function(){return this.constructor.name};b.prototype.validators=function(){return this.constructor.validate};b.prototype.guid_for=function(){var a;if(a=this.constructor.guid_for){if(Sirius.Utils.is_string(a))return[a];if(Sirius.Utils.is_array(a))return a;throw Error("'@guid_for' must be array of string, but "+
typeof a+" given");}return[]};b.prototype._compute=function(a,b){var d=this;return this.constructor.prototype._cmp.forEach(function(e){if(-1!==e.get_fields().indexOf(a)){var f=e.complete(a,b);if(e.is_full())return d._set(e.field_name(),f)}})};b.prototype.normalize_attrs=function(){var a;var b=this.attrs();var f=[];var e=0;for(a=b.length;e<a;e++){var g=b[e];f.push(function(a){return Sirius.Utils.is_object(a)?Object.keys(a)[0]:a}(g))}return f};b.prototype._gen_method_name_for_attribute=function(a){var b=
Sirius.Utils.underscore(a);if(-1!==Object.keys(this).indexOf(b))throw Error("Method "+b+" already exist");return this[b]=function(b){return function(d){return null!=d?b.set(a,d):b.get(a)}}(this)};b.prototype._generate_guid=function(){var a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return""+a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()};b.prototype.get_attributes=function(){return this.attributes};b.prototype._is_computed_attribute=function(a){return-1!==this.constructor.prototype._cmp_fields.indexOf(a)?
!0:!1};b.prototype._attribute_present=function(a){if(-1===this.attributes.indexOf(a))throw Error("Attribute '"+a+"' not found for "+this._klass_name()+" model");};b.prototype._call_callbacks=function(a,b,f){var d;var g=this._listeners;var h=0;for(d=g.length;h<d;h++){var k=g[h];k.apply(null,[a,b])}return this.after_update(a,b,f)};b.prototype._call_callbacks_for_errors=function(a,b,f){var d;a="errors."+a+"."+b;var g=this._listeners;var h=[];var k=0;for(d=g.length;k<d;k++)b=g[k],h.push(b.apply(null,
[a,f]));return h};b.prototype.set=function(a,b){if(this._is_computed_attribute(a))throw Error("Impossible set computed attribute "+a+" for "+this._klass_name());return this._set(a,b)};b.prototype._set=function(a,b){this._attribute_present(a);var d=this["_"+a];this["_"+a]=b;this.logger.debug("["+this.constructor.name+"] set: 'attr' to '"+b+"'",this.logger.base_model);this.validate(a);this._compute(a,b);return this._call_callbacks(a,b,d)};b.prototype.get=function(a){this._attribute_present(a);return this["_"+
a]};b.prototype.reset=function(){var a;var b=1<=arguments.length?slice.call(arguments,0):[];var f=this.attributes;this.logger.debug("Reset attributes: '"+b+"' for "+this._klass_name());var e=0;for(a=b.length;e<a;e++){var g=b[e];if(-1===f.indexOf(g))throw Error("Attribute '"+g+"' not found for "+this._klass_name()+" model");g="_"+g;"number"===typeof this[g]&&(this[g]=0);Sirius.Utils.is_string(this[g])&&(this[g]="");Sirius.Utils.is_array(this[g])&&(this[g]=[]);null!=this.errors[g]&&(this.errors[g]=
{})}};b.prototype.is_valid=function(){return 0===Object.keys(this._is_valid_attr).filter(function(a){return function(b){return!a._is_valid_attr[b]}}(this)).length};b.prototype.validate=function(a){null==a&&(a=null);var b=this._klass_name();var f=this.logger;var e=this.logger.base_model;Object.keys(this._model_validators||{}).filter(function(b){return null!=a?b===a:!0}).map(function(a){return function(d){var g,h;var m=a.get(d);var p=a._model_validators[d];var r=[];for(g in p){var t=p[g];var q="validate_with"===
g?(h=new Sirius.Validator,h.validate=t,h.msg=null,h):(h=a._registered_validators.filter(function(a){return a[0]===g})[0][1],new h);t=q.validate(m,t);f.debug("Validate: '"+b+"."+d+" = "+m+"' with '"+g+"' validator, valid?: '"+t+"'",e);q=t?(delete a.errors[d][g],a._is_valid_attr[d]=!0,""):(a.errors[d][g]=q.error_message(),a._is_valid_attr[d]=!1,q.error_message());r.push(a._call_callbacks_for_errors(d,g,q))}return r}}(this))};b.prototype.get_errors=function(a){var b;null==a&&(a=null);if(-1===this.attributes.indexOf(a)&&
null!==a)throw Error("Attribute '"+a+"' not found for "+this._klass_name()+" model");if(null!=a){var f=[];a=this.errors[a];for(b in a){var e=a[b];""!==e&&f.push(e)}return f}return this.errors};b.prototype.set_error=function(a,b){var d=a.split(".");if(2!==d.length)throw Error("Error must be pass as 'attr.validator' like 'name.length'");this.errors[d[0]][d[1]]=b;return this._is_valid_attr[d[0]]=!1};b.prototype.save=function(a){null==a&&(a=!1);this.validate();var b=this.constructor.name;if(a&&!this.is_valid())throw Error(b+
" model not valid!");return this.is_valid()?!1:!0};b.prototype.to_json=function(){var a=1<=arguments.length?slice.call(arguments,0):[];return JSON.stringify(this.to_object.apply(this,a))};b.prototype.to_object=function(){var a;var b=1<=arguments.length?slice.call(arguments,0):[];var f={};var e=this.attributes;var g=0;for(a=e.length;g<a;g++){var h=e[g];if(-1===b.indexOf(h)){var k=this.get(h);f[h]=k}}return f};b.from_json=function(a,b){var d;var e=new this;a=JSON.parse(a);var g=[].concat(e.attrs());
var h=0;for(d=g.length;h<d;h++){var k=g[h];if("object"===typeof k){var l=Object.keys(k);l=l[0];e.set(l,a[l]||k[l])}else l=a[k],e.set(k,l||e.get(k))}return e};b.prototype.compare=function(a){throw Error("`compare` method must be overridden");};b.prototype.after_create=function(){};b.prototype.after_update=function(a,b,f){};b.prototype.clone=function(){return this.constructor.from_json(this.to_json())};b.prototype._register_state_listener=function(a){var b;this.logger.debug("Register new listener for "+
this.constructor.name,this.logger.base_model);this._listeners.push(a);var f=this.get_attributes();var e=[];var g=0;for(b=f.length;g<b;g++){var h=f[g];null!==this["_"+h]?e.push(a.apply(null,[h,this["_"+h]])):e.push(void 0)}return e};b.prototype.pipe=function(a,b){null==b&&(b={});(new Sirius.Transformer(this,a)).run(b)};b.prototype.bind=function(a,b){null==b&&(b={});return this.pipe(a,b)};b.define_model=function(a){var b;var f=["attrs","guid_for","validate"];var e=function(b){function d(){return d.__super__.constructor.apply(this,
arguments)}extend(d,b);d.attrs=a.attrs||[];d.guid_for=a.guid_for||null;d.validate=a.validate||{};return d}(Sirius.BaseModel);for(b in a){var g=a[b];-1===f.indexOf(b)&&(e.prototype[b]=g)}return e};b.register_validator=function(a,b){var d=Sirius.Application.get_logger();d.info("register validator: "+a,d.base_model);this._Validators.push([a,b]);return null};return b}();Sirius.BaseModel.register_validator("length",Sirius.LengthValidator);Sirius.BaseModel.register_validator("exclusion",Sirius.ExclusionValidator);
Sirius.BaseModel.register_validator("inclusion",Sirius.InclusionValidator);Sirius.BaseModel.register_validator("format",Sirius.FormatValidator);Sirius.BaseModel.register_validator("numericality",Sirius.NumericalityValidator);Sirius.BaseModel.register_validator("presence",Sirius.PresenceValidator);
Sirius.Internal.AbstractTransformer=function(){function b(a,b,f){this._path=a;this._from=b;this._to=f;this.logger=Sirius.Application.get_logger();this._ln=this.logger.transformer;this._register()}b.prototype._register=function(){};return b}();
Sirius.Internal.ToFunctionTransformer=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype._register=function(){var a;if(this._from instanceof Sirius.BaseModel)return this._from._register_state_listener(this._to);this._from._register_state_listener(this);var b=this._fire_generator();var e=this._from.get_element();var g=this._path;var h=[];for(a in g)g=this._path.from||"text",h.push(new Sirius.Internal.Observer(e+" "+a,a,g,b));return h};a.prototype._fire_generator=
function(){var a=this._from;var b=this._to;return function(d){return b(d,a)}};return a}(Sirius.Internal.AbstractTransformer);
Sirius.Internal.ToViewTransformer=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype._register=function(){var a;var b=this._fire_generator();if(this._from instanceof Sirius.View){var e=this._from.get_element();var g=this._path.to;var h=[];var k=0;for(a=g.length;k<a;k++){var l=g[k];var m=Sirius.Utils.is_string(l)?[null,"text",l]:[l.from||e,l.attribute||"text",l.selector];var p=m[0];l=m[1];m=m[2];e=e===p?e:null!=p?e+" "+p:e;this.logger.debug("Observe '"+
e+"' -> '"+this._to.get_element()+" "+m+"'",this._ln);h.push(new Sirius.Internal.Observer(e,p,l,b))}return h}return this._from._register_state_listener(b)};a._default_via_method=function(){return function(a,b,e,g){null==g&&(g="text");return e.zoom(b).render(a).swap(g)}};a.prototype._fire_generator=function(){var a=this._to;var b=this._path;var e=this.logger;var g=this._ln;if(this._from instanceof Sirius.View)var h=function(d){var e;var f=b.to;var g=d.text;var h=[];var k=0;for(e=f.length;k<e;k++){var l=
f[k];if(Sirius.Utils.is_string(l)){var u=Sirius.Internal.ToViewTransformer._default_via_method();h.push(u(g,l,a,attribute))}else{var w=l.selector;d=l.attribute||"text";u=l.via||Sirius.Internal.ToViewTransformer._default_via_method();h.push(u(g,w,a,d))}}return h};else{var k=this._from;h=function(d,f){var h;if(h=b[d]){e.debug("Apply new value for '"+d+"' for '"+a.get_element()+"', value: "+f+" from "+k._klass_name(),g);var l=h.to;var m=h.attr||"text";h=h.via||Sirius.Internal.ToViewTransformer._default_via_method();
return h(f,l,a,m)}}}return h};return a}(Sirius.Internal.AbstractTransformer);
Sirius.Internal.ToModelTransformer=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype._register=function(){var a;this._from._register_state_listener(this);var b=this._fire_generator();var e=this._from.get_element();var g=this._path;var h=[];for(a in g)g=this._path.from||"text",h.push(new Sirius.Internal.Observer(e+" "+a,a,g,b));return h};a.prototype._default_via_method=function(){return function(a){return a}};a.prototype._fire_generator=function(){var a=
this._from;var b=this._path;var e=this._to;var g=this.logger;var h=this._ln;return function(d){var f;if(f=b[d.original]){var k=f.to;var p=f.from||"text";f=f.via||function(a){return a};g.debug("Apply new value from "+d.from+" ("+d.original+") to "+e._klass_name()+"."+k,h);return e.set(k,f(d.text,a,d.original,p,d.element))}}};return a}(Sirius.Internal.AbstractTransformer);
Sirius.Transformer=function(){function b(a,b){this.logger=Sirius.Application.get_logger();this.ln=this.logger.transformer;if(a instanceof Sirius.BaseModel)this._from=a;else if(a instanceof Sirius.View)this._from=a;else throw Error("Bad argument for Transformer, Model or View required, given "+a);if(b instanceof Sirius.BaseModel){if(this._from instanceof Sirius.BaseModel)throw Error("Impossible bind model and model");this._to=b}else if(b instanceof Sirius.View)this._to=b;else if(Sirius.Utils.is_function(b))this._to=
b;else throw Error("Bind works only with BaseModel, BaseView or Function, given: "+b);}b._Model=0;b._View=1;b._Function=2;b.prototype._from=null;b.prototype._to=null;b.prototype._path=null;b.prototype.run=function(a){var b;if(this._from&&this._to){if(this._from instanceof Sirius.BaseModel)for(h in a){var f=a[h];if(-1===this._from.get_attributes().indexOf(h)){var e=this._from._klass_name();var g=this._from.get_attributes();g="Attribute '"+h+"' not found in model attributes: '"+e+"', available: ["+
g+"]";-1!==h.indexOf(".")?0===h.lastIndexOf("errors")?(g=h.split("."),3!==g.length&&this.logger.warn("Try to bind '"+h+"' from errors, but validator was not found, correct definition like 'errors.id.numericality'",this.ln),this.logger.debug("bind: "+e+"."+h+" -> "+f.to,this.ln)):this.logger.warn(g,this.ln):this.logger.warn(g,this.ln)}}if(this._to instanceof Sirius.BaseModel)for(h in e=this._to._klass_name(),a)if(f=a[h],f=f.to)g=this._to.get_attributes(),-1===g.indexOf(f)?this.logger.warn("Attribute '"+
f+"' not found in model attributes: '"+e+"', available: ["+g+"]",this.ln):this.logger.debug("bind: '"+h+"' -> '"+e+"."+f+"'",this.ln);else throw a=JSON.stringify(a),Error("Impossible create transformer for "+e+", because in object: "+a+", 'to' key not defined");if(this._from instanceof Sirius.View&&this._to instanceof Sirius.View){e=this._from.get_element();var h=this._to.get_element();if(b=a.to)if(Sirius.Utils.is_array(b)){f=0;for(g=b.length;f<g;f++){var k=b[f];if(k.selector)k=k.selector,this.logger.debug("bind: '"+
e+"' -> '"+h+" "+k+"'",this.ln);else throw Error('You define binding with \'to\' as array of objects, but \'selector\' property was not found. Correct definition: {to: [{"selector": "#my-id", "attribute": "data-attr"}]}');}this._path=a}else if(Sirius.Utils.is_string(b))this.logger.debug("bind: '"+e+"' -> '"+h+" "+b+"'"),a.to=[b],this._path=a;else throw Error("For binding 'to' must be array or string, but "+typeof b+" given");else throw Error("Define View to View binding with: 'view1.bind(view2, {\"to\": \"selector\"})', but 'to' key not found");
}else{if(this._from instanceof Sirius.View&&Sirius.Utils.is_function(this._to)){e=this._from.get_element();if(0===Object.keys(a).length)throw Error("Binding with empty object forbidden");for(h in a)if(f=a[h],f.from)f=f.from,this.logger.debug("bind: '"+e+" "+h+"' (from '"+f+"') -> function",this.ln);else throw Error('For binding View and Function, you need to define object like: {"selector": {"from": "text"}}');}this._path=a}if(this._to instanceof Sirius.BaseModel)return new Sirius.Internal.ToModelTransformer(a,
this._from,this._to);if(this._to instanceof Sirius.View)return new Sirius.Internal.ToViewTransformer(a,this._from,this._to);if(Sirius.Utils.is_function(this._to))return new Sirius.Internal.ToFunctionTransformer(a,this._from,this._to)}else throw Error("Not all parameters defined for transformer: from: "+this._from+", to: "+this._to);};b.draw=function(a){var b=Sirius.Application.get_logger();b.debug("Draw Transformer",b.transformer);return a};return b}();
Sirius.Collection=function(){function b(a,b){var d;null==b&&(b={});if("BaseModel"!==a.__super__.__name)throw Error("Collection must be used only with `BaseModel` inheritor");this._array=[];this.logger=Sirius.Application.get_logger();this._klass=a;this._type=Sirius.Utils.fn_name(a);this._indexes=b.index||[];if(0<this._indexes.length){var e=a.prototype.attrs().map(function(a){return Sirius.Utils.is_object(a)?Object.keys(a)[0]:a});this._indexes.forEach(function(a){if(-1===e.indexOf(a))throw Error("Collection: field "+
a+" from indexes: ["+this._indexes+"] not exist in "+this._type);});this._indexes.forEach(function(a){return function(b){a.logger.debug("create index for "+b+" field in "+a._type,a.logger.collection);return a["index_"+b]={}}}(this))}this._subscribers={};var g=this.constructor._EVENTS;var h=0;for(d=g.length;h<d;h++){var k=g[h];this._subscribers[k]=[]}this.length=0}b._EVENTS=["add","remove"];b.prototype.push=function(a){return this.add(a)};b.prototype.add=function(a){this._add(a)};b.prototype._add=
function(a){var b=Sirius.Utils.fn_name(a.constructor);if(this._type!==b)throw b="Require `"+this._type+"`, but given `"+b+"`",this.logger.error("Collection: "+b,this.logger.collection),Error(b);this._array.push(a);0<this._indexes.length&&this._indexes.forEach(function(b){return function(d){return b["index_"+d][a.get(d)]=b.length}}(this));this.length++;return this._gen("add",a)};b.prototype.remove=function(a){var b=this.index(a);null!==b&&(this._array.splice(b,1),this._gen("remove",a),this.length--,
0<this._indexes.length&&this._indexes.forEach(function(d){return function(e){delete d["index_"+e][a.get(e)];return Object.keys(d["index_"+e]).filter(function(a){return d["index_"+e][a]>b}).map(function(a){return--d["index_"+e][a]})}}(this)))};b.prototype.index=function(a){var b,f;var e=null;var g=this._array;var h=b=0;for(f=g.length;b<f;h=++b){var k=g[h];k.compare(a)&&(e=h)}return e};b.prototype.find=function(a,b){return this.find_all(a,b)[0]||null};b.prototype.find_all=function(a,b){var d;if(0<this._indexes.length&&
-1!==this._indexes.indexOf(a))return[this._array[this["index_"+a][b]]];var e=this._array;var g=[];var h=0;for(d=e.length;h<d;h++){var k=e[h];k.get(a)===b&&g.push(k)}return g};b.prototype.filter=function(a){var b;null==a&&(a=function(){});var f=this._array;var e=[];var g=0;for(b=f.length;g<b;g++){var h=f[g];a.call(null,h)&&e.push(h)}return e};b.prototype.each=function(a){var b;null==a&&(a=function(){});var f=this._array;var e=[];var g=0;for(b=f.length;g<b;g++){var h=f[g];e.push(a.call(h))}return e};
b.prototype.first=function(){return this._array[0]};b.prototype.last=function(){return this._array[this._array.length-1]};b.prototype.all=function(){return this._array};b.prototype.clear=function(){this.length=0;this._array=[];if(0<this._indexes.length)return this._indexes.forEach(function(a){return function(b){return a["index_"+b]={}}}(this))};b.prototype.map=function(a){return this.collect(a)};b.prototype.collect=function(a){return this._array.map(a)};b.prototype.takeFirst=function(a){var b;var f=
null;var e=this._array;var g=0;for(b=e.length;g<b;g++){var h=e[g];if(a(h)){f=h;break}}return f};b.prototype.size=function(){return this._array.length};b.prototype.to_json=function(){var a;var b=this._array;var f=[];var e=0;for(a=b.length;e<a;e++){var g=b[e];f.push(g.to_object())}return JSON.stringify(f)};b.prototype.subscribe=function(a,b){if(-1===this.constructor._EVENTS.indexOf(a))throw Error("For 'subscribe' method available only ["+this.constructor._EVENTS+"], but given '"+a+"'");if(Sirius.Utils.is_string(b)||
Sirius.Utils.is_function(b))this.logger.info("Collection: Add new subscriber for '"+a+"' event",this.logger.collection),this._subscribers[a].push(b);else throw Error("Second parameter for 'subscribe' method must be Function or String, but '"+typeof b+"' given");};b.prototype._gen=function(){var a=arguments[0];var b=2<=arguments.length?slice.call(arguments,1):[];var f=this._subscribers[a];return Sirius.Application.get_adapter().and_then(function(a){var d;var e=[];var k=0;for(d=f.length;k<d;k++){var l=
f[k];Sirius.Utils.is_string(l)?e.push(a.fire.apply(a,[document,l].concat(slice.call(b)))):e.push(l.apply(null,b))}return e})};return b}();
