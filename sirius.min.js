/*
 Sirius.js v0.8.5
  (c) 2014-2015 fntz
  license: MIT
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var a=0;return $jscomp.iteratorPrototype(function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.iteratorFromArray=function(b,a){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var c=0,e={next:function(){if(c<b.length){var d=c++;return{value:a(d,b[d]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(b,a,c,e){if(a){c=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var d=b[e];d in c||(c[d]={});c=c[d]}b=b[b.length-1];e=c[b];a=a(e);a!=e&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
var Adapter,ComputedField,Sirius,VanillaJsAdapter,slice=[].slice,extend=function(b,a){function c(){this.constructor=b}for(var e in a)hasProp.call(a,e)&&(b[e]=a[e]);c.prototype=a.prototype;b.prototype=new c;b.__super__=a.prototype;return b},hasProp={}.hasOwnProperty,bind=function(b,a){return function(){return b.apply(a,arguments)}};Sirius={VERSION:"0.8.5"};
Adapter=function(){function b(){}b.prototype.bind=function(a,c,b,d){};b.prototype.off=function(a,c,b,d){};b.prototype.fire=function(){3<=arguments.length&&slice.call(arguments,2)};b.prototype.get_property=function(){2<=arguments.length&&slice.call(arguments,1)};b.prototype.get_attr=function(a,c){};b.prototype.set_prop=function(a,c,b){};b.prototype.swap=function(a,c){};b.prototype.append=function(a,c){};b.prototype.prepend=function(a,c){};b.prototype.clear=function(a){};b.prototype.set_attr=function(a,
c,b){};b.prototype.all=function(a){return"object"===typeof a&&1===a.nodeType||9===a.nodeType?a:document.querySelectorAll(a)};b.prototype.get=function(a){return document.querySelector(a)};b.prototype.state=function(a){};return b}();
VanillaJsAdapter=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype._get_element_from_selector=function(a){if("object"===typeof a&&1===a.nodeType)return a;var c=this.all(a);if(0===c.length)throw Error("Selector `"+a+"` not found");return c[0]};a.prototype.bind=function(a,b,d,f){var c,e;if(null===b||b===a)a.addEventListener(d,f);else if("object"===typeof b&&1===b.nodeType)b.addEventListener(d,f);else for(a=this.all(b),b=c=0,e=a.length;0<=e?c<e:c>e;b=
0<=e?++c:--c)a.item(b).addEventListener(d,f)};a.prototype.off=function(a,b,d,f){var c,e;if(null===b||b===a)a.removeEventListener(d,f);else for(a=this.all(b),b=c=0,e=a.length;0<=e?c<e:c>e;b=0<=e?++c:--c)a.item(b).removeEventListener(d,f)};a.prototype.fire=function(){var a=arguments[1];var b=3<=arguments.length?slice.call(arguments,2):[];var d=document.createEvent("CustomEvent");d.initCustomEvent(a,!1,!0,b);document.dispatchEvent(d)};a.prototype.get_property=function(a,b){var c;var e=a.target;var g=
[];var h=0;for(c=b.length;h<c;h++){var k=b[h];g.push(this.get_attr(e,k))}return g};a.prototype.get_attr=function(a,b){var c=this._get_element_from_selector(a);var e=c.getAttribute(b);return null==e?c[b]:e};a.prototype.swap=function(a,b){var c=this._get_element_from_selector(a);var e=c.tagName;"INPUT"===e||"TEXTAREA"===e||"SELECT"===e?c.value=b:c.textContent=b};a.prototype.set_attr=function(a,b,d){this._get_element_from_selector(a).setAttribute(b,d)};a.prototype.set_prop=function(a,b,d){this._get_element_from_selector(a).setAttribute(b,
d)};a.prototype.append=function(a,b){var c=this._get_element_from_selector(a);c.textContent+=b};a.prototype.prepend=function(a,b){var c=this._get_element_from_selector(a);c.textContent=b+c.textContent};a.prototype.clear=function(a){a=this._get_element_from_selector(a);var c=a.tagName;"INPUT"===c||"TEXTAREA"===c?a.value="":a.textContent=""};a.prototype.text=function(a){a=this._get_element_from_selector(a);var c=a.tagName;return"INPUT"===c||"TEXTAREA"===c||"SELECT"===c?a.value:a.innerText?a.innerText:
a.textContent};a.prototype.get_state=function(a){return this._get_element_from_selector(a).checked};return a}(Adapter);
Sirius.Logger=function(){function b(a,c,b){var e;var f=Sirius.Logger.Filters;var g=0;for(e=f.length;g<e;g++){var h=f[g];this[Sirius.Utils.underscore(h).toLowerCase()]=h}var k=Sirius.Logger.Levels;h=function(e){return function(d){return e[d]=function(e,g){if(a){if(!g)return b(d.toUpperCase(),e);if(-1!==c.indexOf(g)||null==g||-1===f.indexOf(g))return e="["+g.toUpperCase()+"] "+e,b(d.toUpperCase(),e)}}}}(this);var l=0;for(g=k.length;l<g;l++)e=k[l],h(e)}b.Levels=["debug","info","warn","error"];b.Filters=
"BaseModel Binding Collection View Routing Application Redirect Validation Transformer".split(" ");return b}();Sirius.Internal={};Sirius.Promise=function(){function b(a){this.value=a;this.fn=function(){}}b.prototype.and_then=function(a){return null!=this.value?a(this.value):this.fn=a};b.prototype.set_value=function(a){this.value=a;return this.fn(a)};return b}();
Sirius.Utils=function(){function b(){}b.is_function=function(a){return"[object Function]"===Object.prototype.toString.call(a)};b.is_string=function(a){return"[object String]"===Object.prototype.toString.call(a)};b.is_array=function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.is_object=function(a){return null!==a&&"object"===typeof a};b.camelize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};b.underscore=function(a){return a.replace(/([A-Z])/g,"_$1").replace(/^_/,"").toLowerCase()};
b.ie_version=function(){var a=window.navigator.userAgent;var c=a.indexOf("MSIE ");var b=a.indexOf("Trident/");return 0<c?parseInt(a.substring(c+5,a.indexOf(".",c)),10):0<b?(c=a.indexOf("rv:"),parseInt(a.substring(c+3,a.indexOf(".",c)),10)):0};b.is_ie9=function(){return 9===this.ie_version()};b.fn_name=function(a){if(this.is_function(a))return a.toString().match(/function ([^\(]+)/)[1];throw Error("Need function, given "+typeof a);};return b}();
Sirius.redirect=function(b){var a=Sirius.Application;a.logger.info("Redirect to "+b,a.logger.redirect);a.use_hash_routing_for_old_browsers&&!a.push_state_support&&(b=0===b.indexOf("#")?b:0===b.indexOf("/")?"#"+b:"#/"+b);if(0===b.indexOf("#")){if(a.push_state_support)return location.replace(b)}else if(a.push_state_support)return Sirius.Internal.RouteSystem.dispatch.call(null,{type:"redirect",target:{href:b}})};
Sirius.Internal.RoutePart=function(){function b(a){this.end=!0;this.start=null;this.parts=[];this.args=[];a=a.replace(/\/$/,"").split("/");""===a[0]&&(a[0]="#");"*"===a[a.length-1]&&(this.end=!1);this.parts=a.slice(0)}b.prototype.match=function(a){this.args=[];var c=a.replace(/\/$/,"").split("/");""===c[0]&&(c[0]="#");if(c.length!==this.parts.length&&this.end||1<this.parts.length&&c.length<this.parts.length)return!1;var b=function(a){return 0===a.indexOf(":")};var d=function(a){return 0===a.indexOf("[")};
var f=function(a){return 0===a.indexOf("*")};var g=-1;for(a=[];10>g;){g++;var h=[this.parts[g],c[g]];var k=h[0];h=h[1];if(!k||!h)break;if(b(k))a.push(c[g]);else if(d(k)){k=new RegExp("^"+k+"$");if(!k.test(h))return!1;a.push(k.exec(h)[0])}else{if(f(k)){a=a.concat(c.slice(g));break}if(k!==h)return!1}}this.args=a;return!0};return b}();
Sirius.Internal.ControlFlow=function(){function b(a,c){null==c&&(c=function(a){return a});this.logger=Sirius.Application.get_logger();var b;if(!(b=a.controller))throw Error("Params must contain a Controller");var d=a.action;if(Sirius.Utils.is_string(d))var f=b[d];else if(Sirius.Utils.is_function(d))f=d;else throw f="Action must be string or function",this.logger.error("ControlFlow: "+f,this.logger.routing),Error(f);if(!f)throw f="action "+d+" not found in controller "+b,this.logger.error("ControlFlow: "+
f,this.logger.routing),Error(f);this.action=c(f);f=function(c,e){null==e&&(e=!1);var f=a[c];var g=b[c+"_"+d];var h=function(a){return Error(a+" action must be string or function")};if(Sirius.Utils.is_string(f)){g=b[f];if(!Sirius.Utils.is_function(g))throw h(Sirius.Utils.camelize(c));return g}if(Sirius.Utils.is_function(f))return f;if(f)throw h(Sirius.Utils.camelize(c));if(g){if(!Sirius.Utils.is_function(g))throw h(Sirius.Utils.camelize(c));return g}return e?null:function(){}};this.before=f("before");
this.after=f("after");this.guard=f("guard",!0);this.data=a.data||null;this.controller=b}b.prototype.handle_event=function(){var a;var c=arguments[0];var b=2<=arguments.length?slice.call(arguments,1):[];this.logger.debug("ControlFlow: Start event processing",this.logger.routing);if(c){var d=Sirius.Utils.is_array(this.data)?this.data:this.data?[this.data]:[];d=Sirius.Application.adapter.get_property(c,d);c=[].concat([],[c],d);c=(a=[]).concat.apply(a,[[],c].concat(slice.call(b)));if(this.guard){if(this.guard.apply(this.controller,
c))return this.before.apply(this.controller),this.action.apply(this.controller,c),this.after.apply(this.controller)}else return this.before.apply(this.controller),this.action.apply(this.controller,c),this.after.apply(this.controller)}else if(b=[].concat.apply([],b),this.guard){if(this.guard.apply(this.controller,b))return this.before.apply(this.controller),this.action.apply(this.controller,b),this.after.apply(this.controller)}else return this.before.apply(this.controller),this.action.apply(this.controller,
b),this.after.apply(this.controller)};b.prototype.tick=function(){this.logger.debug("ControlFlow: tick",this.logger.routing);if(this.guard){if(this.guard.apply(this.controller))return this.before.apply(this.controller),this.action.apply(this.controller),this.after.apply(this.controller)}else return this.before.apply(this.controller),this.action.apply(this.controller),this.after.apply(this.controller)};return b}();
Sirius.Internal.RouteSystem={_every:"every",_scheduler:"scheduler",_once:"once",_selector:"a:not([href^='#'])",_is_hash_route:function(b){return 0===b.toString().indexOf("#")},_is_404_route:function(b){return"404"===b.toString()},_is_plain_route:function(b){return 0===b.toString().indexOf("/")},_is_scheduler_command:function(b){return 0===b.lastIndexOf(this._scheduler)||0===b.lastIndexOf(this._once)||0===b.lastIndexOf(this._every)},_is_event_route:function(b){return!this._is_hash_route(b)&&!this._is_404_route(b)&&
!this._is_plain_route(b)&&!this._is_scheduler_command(b)},_get_time_unit:function(b,a){var c;if(c=a.match(/^(\d+)(ms|s|m)/)){var e=parseInt(c[1],10);c=c[2]||"s";return"ms"===c?e:"s"===c?1E3*e:6E4*e}throw Error("Bad time unit: "+a+" in "+b+", available units: 'ms', 's', 'm'");},_get_scheduler_params:function(b){var a=b.split(" ");var c="Define time unit for scheduler, for example: 'every 10s', given: "+b;if(1===a.length)throw Error(c);if(2===a.length)return c=Sirius.Internal.RouteSystem._get_time_unit(b,
a[1]),{delay:null,time:c};if(3===a.length)return c=Sirius.Internal.RouteSystem._get_time_unit(b,a[1]),b=Sirius.Internal.RouteSystem._get_time_unit(b,a[2]),{delay:c,time:b};throw Error(c);},_scheduler_register:function(b,a,c,e){var d;var f=this._every;var g=this._scheduler;var h=this._get_scheduler_params;var k=[];for(d in b)c=b[d],this._is_scheduler_command(d)&&k.push(function(c,b){var d=Sirius.Utils.is_function(b)?a(b):function(){return(new Sirius.Internal.ControlFlow(b,a)).tick()};var k=h(c);e.debug("Define scheduler for '"+
c+"' with "+JSON.stringify(k),e.routing);return 0===c.lastIndexOf(f)||0===c.lastIndexOf(g)?null===k.delay?setInterval(d,k.time):setTimeout(function(){return setInterval(d,k.time)},k.delay):null===k.delay?setTimeout(d,k.time):setTimeout(function(){return setTimeout(d,k.time)},k.delay)}(d,c));return k},_event_register:function(b,a,c,e){var d;var f=[];for(d in b){var g=b[d];this._is_event_route(d)&&f.push(function(b,d){var f=Sirius.Utils.is_function(d)?a(d):function(){var c=arguments[0];var b=2<=arguments.length?
slice.call(arguments,1):[];return(new Sirius.Internal.ControlFlow(d,a)).handle_event(c,b)};var g=b.match(/^([a-zA-Z:]+)(\s+)?(.*)?/);var h=g[1];g=g[3]||document;c.bind(document,g,h,f);return e.debug("RouteSystem: define event route: '"+h+"' for '"+g+"'",e.routing)}(d,g))}return f},_get_hash_routes:function(b,a,c,e){var d=[];for(f in b)if(c=b[f],this._is_hash_route(f)){e.info("RouteSystem: define hash route: '"+f+"'",e.routing);var f=new Sirius.Internal.RoutePart(f);c=Sirius.Utils.is_function(c)?a(c):
new Sirius.Internal.ControlFlow(c,a);d.push([f,c])}return d},_get_plain_routes:function(b,a,c,e){var d=[];for(f in b)if(c=b[f],this._is_plain_route(f)){e.debug("RouteSystem: define route: '"+f+"'",e.routing);var f=new Sirius.Internal.RoutePart(f);c=Sirius.Utils.is_function(c)?a(c):new Sirius.Internal.ControlFlow(c,a);d.push([f,c])}return d},create:function(b,a,c){var e;null==c&&(c=function(){});var d=Sirius.Application.get_logger();var f=e=window.location.hash;var g=a.old;var h=a.support;var k=a.ignore;
return Sirius.Application.get_adapter().and_then(function(a){return function(n){if(g&&!h){d.info("RouteSystem: Convert plain routing into hash routing",d.routing);var q=[];var l={};for(m in b){var p=b[m];a._is_hash_route(m)&&q.push(m);if(a._is_plain_route(m)){var m="#"+m;-1!==q.indexOf(m)&&d.warn("RouteSystem: Routes already defined '"+m+"' url",d.routing)}l[m]=p}b=l}var t=function(a){var c;var b=Sirius.Application.controller_wrapper;for(c in b){var e=b[c];this[c]=e}return a};a._event_register(b,
t,n,d);a._scheduler_register(b,t,n,d);var v=a._get_hash_routes(b,t,n,d);var w=a._get_plain_routes(b,t,n,d);var x=function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1};var u=function(a){var c,g,q;e=f;var l=q=!1;d.info("RouteSystem: start processing route: '"+f+"'",d.routing);if("hashchange"===a.type){var p=v;f=window.location.hash;var m=window.location.origin;l=!0;h?history.pushState({href:f},""+f,m+"/"+f):history.replaceState({href:f},""+f,m+"/"+f)}else p=w,m=a.target.href,"popstate"!==
a.type&&h&&history.pushState({href:m},""+m,m),m=window.location.pathname,""===m&&(m="/"),f=m;var r=0;for(c=p.length;r<c;r++){var u=p[r];m=u[0];(g=m.match(f))&&!q&&(q=!0,u=u[1],u.handle_event?u.handle_event(null,m.args):u.apply(null,m.args))}q?(x(a),d.debug("RouteSystem: Url change to: "+f,d.routing),n.fire(document,"application:urlchange",f,e)):k?(l&&d.warn("Seems you ignore hash based urls: "+f),d.debug("ignore_not_matched_urls is enabled, url was not matched: '"+f+"'")):(d.warn("RouteSystem: route '"+
f+"' not found. Generate 404 event",d.routing),n.fire(document,"application:404",f,e),(l=b["404"]||b[404])&&(Sirius.Utils.is_function(l)?t(l)(f):(new Sirius.Internal.ControlFlow(l,t)).handle_event(null,f)),x(a))};a.dispatch=u;0!==w.length&&n.bind(document,a._selector,"click",u);window.onhashchange=u;h&&n.bind(window,null,"popstate",function(a){if(history&&null!=history.state&&void 0!==history.state.href&&0!==history.state.href.indexOf("#"))return u(a)});return c()}}(this))}};
Sirius.Application={log:!1,adapter:null,running:!1,route:{},start:!1,controller_wrapper:{redirect:Sirius.redirect},mix_logger_into_controller:!0,use_hash_routing_for_old_browsers:!0,ignore_not_matched_urls:!0,default_log_function:function(b,a){return console&&console.log?console.log(b+": "+a):alert("Not supported `console`. You should define own `logger` function for Sirius.Application")},log_filters:[],_wait:[],_messages_queue:[],get_logger:function(){var b;if(this.logger)return this.logger;var a=
Sirius.Logger.Levels;var c={};var e=this._messages_queue;var d=function(a){return c[a]=function(c,b){return e.push([a,c,b])}};var f=0;for(b=a.length;f<b;f++){var g=a[f];d(g)}b=Sirius.Logger.Filters;g=0;for(f=b.length;g<f;g++)d=b[g],c[Sirius.Utils.underscore(d).toLowerCase()]=d;return c},get_adapter:function(){if(null==this.adapter){var b=new Sirius.Promise;this._wait.push(b);return b}return new Sirius.Promise(this.adapter)},run:function(b){var a;null==b&&(b={});var c=function(a,c){return null!=b[a]?
b[a]:c};this.running=!0;this.log=b.log||this.log;this.adapter=b.adapter||new VanillaJsAdapter;this.route=b.route||this.route;this.mix_logger_into_controller=c("mix_logger_into_controller",this.mix_logger_into_controller);this.log_filters=b.log_filters||this.log_filters;this.ignore_not_matched_urls=c("ignore_not_matched_urls",this.ignore_not_matched_urls);if("all"===this.log_filters)this.log_filters=Sirius.Logger.Filters;else if(0<this.log_filters.length){var e=Sirius.Logger.Filters;var d=this.log_filters;
if("number"===typeof this.log_filters[0]){var f=d.sort()[d.length-1];var g=d.sort()[0];if(0>g)throw Error("Undefined index for log filters "+g);if(f>e.length)throw Error("Undefined index for log filters "+f);this.log_filters=d.map(function(a){return e[a]})}else if(f=this.log_filters.filter(function(a){return-1===e.indexOf(a)}),0!==f.length)throw Error("Check log filters given `"+d+"`. Allow "+e);}else this.log_filters=[];this.logger=new Sirius.Logger(this.log,this.log_filters,b.logger||this.default_log_function);
this.start=b.start||this.start;d=b.controller_wrapper||{};for(a in d)f=d[a],this.controller_wrapper[a]=f;this.hash_always_on_top=c("hash_always_on_top",this.hash_always_on_top);this.use_hash_routing_for_old_browsers=c("use_hash_routing_for_old_browsers",this.use_hash_routing_for_old_browsers);this.logger.info("Logger enabled? "+this.log,this.logger.application);this.logger.info("Log filters: "+this.log_filters,this.logger.application);this.logger.info("Adapter: "+Sirius.Utils.fn_name(this.adapter.constructor),
this.logger.application);this.logger.info("Use hash routing for old browsers: "+this.use_hash_routing_for_old_browsers,this.logger.application);this.logger.info("Current browser: "+navigator.userAgent,this.logger.application);this.logger.info("Ignore not matched urls: "+this.ignore_not_matched_urls,this.logger.application);this.push_state_support=history.pushState?!0:!1;this.logger.info("History pushState support: "+this.push_state_support,this.logger.application);!this.push_state_support&&this.use_hash_routing_for_old_browsers&&
this.logger.warn("You browser not support pushState, and you disable hash routing for old browser",this.logger.application);this.logger.info("Mix logger in controllers "+this.mix_logger_into_controller,this.logger.application);this.mix_logger_into_controller&&(this.controller_wrapper.logger&&this.logger.warn("Logger method already in `controller_wrapper`",this.logger.application),c=this.logger,this.controller_wrapper.logger={info:c.info,debug:c.debug,warn:c.warn,error:c.error});Sirius.Internal.RouteSystem.create(this.route,
{old:this.use_hash_routing_for_old_browsers,support:this.push_state_support,ignore:this.ignore_not_matched_urls},function(a){return function(){var c;var b=a._wait;var e=0;for(c=b.length;e<c;e++){var d=b[e];d.set_value(a.adapter)}a.adapter.fire(document,"application:run",new Date);b=a._messages_queue;var f=[];d=0;for(e=b.length;d<e;d++)c=b[d],f.push(a.logger[c[0]].call(null,c[1],c[2]));return f}}(this));if(this.start)return Sirius.redirect(this.start)}};
Sirius.Validator=function(){function b(){this.logger=Sirius.Application.get_logger();this.msg=null}b.prototype.error_message=function(){return this.msg};return b}();
Sirius.LengthValidator=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype.validate=function(a,b){this.logger.info("LengthValidator: start validate '"+a+"'",this.logger.validation);if(null!=a){var c=b.max||Number.POSITIVE_INFINITY;var e=b.min||Number.NEGATIVE_INFINITY;var g=b.length;var h=a.length;if(g){if(h===g)return!0;this.msg="Required length: "+g+", given: "+h;return!1}if(h>=e&&h<=c)return!0;this.msg="Required length in range [0.."+c+"], given: "+
h;return!1}this.msg="Given null for LengthValidator";return!1};return a}(Sirius.Validator);Sirius.ExclusionValidator=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype.validate=function(a,b){this.logger.info("ExclusionValidator: start validate '"+a+"'",this.logger.validation);if(-1===(b.within||[]).indexOf(a))return!0;this.msg="Value "+a+" reserved";return!1};return a}(Sirius.Validator);
Sirius.InclusionValidator=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype.validate=function(a,b){this.logger.info("InclusionValidator: start validate '"+a+"'",this.logger.validation);var c=b.within||[];if(-1<c.indexOf(a))return!0;this.msg="Value "+a+" should be in range "+c;return!1};return a}(Sirius.Validator);
Sirius.FormatValidator=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype.validate=function(a,b){this.logger.info("FormatValidator: start validate '"+a+"'",this.logger.validation);var c;if(!(c=b["with"]))throw Error("format attribute required");if(null!=a){if(c.test(a))return!0;this.msg="Value "+a+" not for current format";return!1}this.msg="Given null for Format";return!1};return a}(Sirius.Validator);
Sirius.NumericalityValidator=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype.validate=function(a,b){null==b&&(b={});this.logger.info("NumericalityValidator: start validate '"+a+"'",this.logger.validation);if(b.only_integers){if(/^\d+$/.test(a))return!0;this.msg="Only allows integer numbers";return!1}if(/^\d+(?:\.\d{1,})?$/.test(a))return!0;this.msg="Only allows numbers";return!1};return a}(Sirius.Validator);
Sirius.PresenceValidator=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype.validate=function(a,b){this.logger.info("PresenceValidator: start validate '"+a+"'",this.logger.validation);if(a)return!0;this.msg="Value required";return!1};return a}(Sirius.Validator);
Sirius.Internal.CacheHandlerProperty=function(){function b(a,c,b,d,f,g){this.from_element=a;this.watch_for=c;this.event=b;this.handler=d;this.observer=f;this.config=g}b.prototype.is_observer=function(){return null!==this.observer};b.prototype.is_listener=function(){return!this.is_observer};return b}();
Sirius.Internal.CacheObserverHandlers={_handlers:[],add_new_observer:function(b,a,c,e,d){b=new Sirius.Internal.CacheHandlerProperty(b,a,null,c,e,d);return this._handlers.push(b)},add_new_bind_event:function(b,a,c,e){b=new Sirius.Internal.CacheHandlerProperty(b,a,c,e,null);return this._handlers.push(b)},find_by_element:function(b){return this._handlers.filter(function(a){return a.from_element===b})},find_by_element_and_watch_for:function(b,a){return this._handlers.filter(function(c){return c.from_element===
b&&c.watch_for===a})},find_by_element_watch_for_and_event:function(b,a,c){return this._handlers.filter(function(e){return e.from_element===b&&e.watch_for===a&&e.event===c})}};
Sirius.Internal.Observer=function(){function b(a,c,b,e){this.from_element=a;this.original=c;this.watch_for=b;this.clb=null!=e?e:function(){};this._create=bind(this._create,this);Sirius.Application.get_adapter().and_then(this._create)}var a=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver||null;var c=["INPUT","TEXTAREA","SELECT"];var e=["checkbox","radio"];b.Ev={input:"input",selectionchange:"selectionchange",childList:"childList",change:"change",DOMNodeInserted:"DOMNodeInserted",
focusout:"focusout",focusin:"focusin",DOMAttrModified:"DOMAttrModified"};b.TextEvents=[b.Ev.input,b.Ev.childList,b.Ev.change,b.Ev.DOMNodeInserted,b.Ev.selectionchange];b.is_text_event=function(a){return-1!==this.TextEvents.indexOf(a.type)};b.is_focus_event=function(a){return-1!==[this.Ev.focusin,this.Ev.focusout].indexOf(a.type)};b.prototype._create=function(b){var d=Sirius.Application.get_logger();var g=this.clb;var h=this.from_element;var k=this.original;var l=null;var n=this.watch_for;var q=b.get_attr(h,
"tagName");var r=b.get_attr(h,"type");d.debug("Create binding for "+h,d.binding);var p=Sirius.Internal.Observer;var m=function(a){d.debug("Handler Function: given "+a.type+" event",d.binding);var c={text:null,attribute:null,from:h,original:k,element:a.target};if(!p.is_focus_event(a)){var e=b.text(h);if(-1===[p.Ev.input,p.Ev.selectionchange].indexOf(a.type)||e!==l){p.is_text_event(a)&&(l=c.text=e);a.type===p.Ev.change&&(c.state=b.get_state(h));if("attributes"===a.type){e=a.attributeName;var f=a.oldValue||
[];var q=b.get_attr(h,e);c.text=q;c.attribute=e;c.previous=f}a.type===p.Ev.DOMAttrModified&&(e=a.originalEvent.attrName,f=a.originalEvent.prevValue,q=b.get_attr(h,e),c.text=q,c.attribute=e,c.previous=f);return g(c)}}};if("text"===n)if(-1!==c.indexOf(q)){d.debug("It is not a "+c,d.binding);if(-1!==e.indexOf(r)||"OPTION"===q)return d.debug("Get a "+r+" & "+q+" element for bool elements",d.binding),b.bind(document,h,p.Ev.change,m),Sirius.Internal.CacheObserverHandlers.add_new_bind_event(h,n,p.Ev.change,
m);l=b.text(h);b.bind(document,h,p.Ev.input,m);Sirius.Internal.CacheObserverHandlers.add_new_bind_event(h,n,p.Ev.input,m);if(Sirius.Utils.is_ie9())return d.warn("Hook for work with IE9 browser",d.binding),b.bind(document,h,p.Ev.selectionchange,m),Sirius.Internal.CacheObserverHandlers.add_new_bind_event(h,n,p.Ev.selectionchange,m)}else return d.warn("Seems you try to bind for "+q+" of "+r+" for 'text' which is not supported");else{if(a){d.debug("MutationObserver support",d.binding);var t=new a(function(a){return a.forEach(m)});
q={childList:!0,attributes:!0,characterData:!0,attributeOldValue:!0,characterDataOldValue:!0,subtree:!1};r=b.get(h);t.observe(r,q);return Sirius.Internal.CacheObserverHandlers.add_new_observer(h,n,m,t,q)}d.warn("MutationObserver not supported",d.binding);d.warn("Use Deprecated events for observe",d.binding);b.bind(document,h,p.Ev.DOMNodeInserted,m);b.bind(document,h,p.Ev.DOMAttrModified,m);Sirius.Internal.CacheObserverHandlers.add_new_bind_event(h,n,p.Ev.DOMNodeInserted,m);return Sirius.Internal.CacheObserverHandlers.add_new_bind_event(h,
n,p.Ev.DOMAttrModified,m)}};return b}();
Sirius.View=function(){function b(a,b){var c;this.element=a;this.clb=null!=b?b:function(a){return a};var e=this.element;var g=this.clb;var h=Sirius.View._Cache.filter(function(a){return a.element===e&&""+a.clb===""+g});if(0!==h.length)return h[0];this._listeners=[];this._cache_event_handlers=[];this.logger=Sirius.Application.get_logger();this._result_fn=function(){var a=1<=arguments.length?slice.call(arguments,0):[];return g.apply.apply(g,[null].concat(slice.call(a)))};this.logger.debug("Create a new View for "+
this.element,this.logger.view);var k=this.constructor._Strategies;h=function(a){return function(b){var c=b[0];a.logger.debug("Define "+c+" strategy",a.logger.view);var d=b[1];var f=b[2];return a[c]=function(b){null==b&&(b="text");var c=a._result;e=a.element;a.logger.debug("Start processing strategy for "+e,a.logger.view);return Sirius.Application.get_adapter().and_then(function(a){var g="text"===b?a.text(e):a.get_attr(e,b);g=d(g,c);return f(a,e,g,b)})}}}(this);var l=0;for(c=k.length;l<c;l++){var n=
k[l];h(n)}Sirius.View._Cache.push(this);return this}b.prototype.name=function(){return"View"};b._Strategies=[];b._Cache=[];var a=function(){function a(a,b,c){this.selector=a;this.event_name=b;this.custom_event_name=c}a.prototype.eq=function(a){return this.selector===a.selector&&this.event_name===a.event_name&&this.custom_event_name.toString===a.custom_event_name.toString};return a}();b.prototype.get_element=function(){return this.element};b.prototype._register_state_listener=function(a){this.logger.debug("Register new listener for element: "+
this.get_element,this.logger.view);return this._listeners.push(a)};b.prototype.render=function(){var a=1<=arguments.length?slice.call(arguments,0):[];this.logger.debug("Call render for "+a,this.logger.view);this._result=this._result_fn(a);return this};b.prototype.zoom=function(a){a=a===this.element?this:new Sirius.View(this.element+" "+a);a._result=this._result;return a};b.prototype.on=function(){var b=arguments[0];var e=arguments[1];var d=arguments[2];var f=4<=arguments.length?slice.call(arguments,
3):[];b=b===this.element?b:this.element+" "+b;if(Sirius.Utils.is_string(d))var g=0;else if(Sirius.Utils.is_function(d))g=1;else throw Error("View: 'custom_event_name' must be string or function, "+typeof d+" given");var h=new a(b,e,d);var k=this._cache_event_handlers.filter(function(a){return a.eq(h)});if(0===k.length)if(this.logger.info("Bind event for "+b+", event name: "+e+", will be called : "+d,this.logger.view),0===g){var l=function(a){return Sirius.Application.get_adapter().and_then(function(b){var c;
return(c=b.fire).call.apply(c,[null,document,d,a].concat(slice.call(f)))})};Sirius.Application.get_adapter().and_then(function(a){return a.bind(document,b,e,l)});k=new a(b,e,l);this._cache_event_handlers.push(k)}else Sirius.Application.get_adapter().and_then(function(a){return a.bind(document,b,e,d)}),this._cache_event_handlers.push(h);else{var n=k.shift();k=this._cache_event_handlers.indexOf(n);-1<k&&this._cache_event_handlers.splice(k,1);this._cache_event_handlers.push(h);Sirius.Application.get_adapter().and_then(function(a){a.off(document,
b,e,n.custom_event_name);n=null;return a.bind(document,b,e,d)})}};b.prototype.for_me=function(){var a=arguments[0];var b=arguments[1];var d=3<=arguments.length?slice.call(arguments,2):[];return this.on.apply(this,[this.get_element(),a,b].concat(slice.call(d)))};b.prototype.get_attr=function(a){var b=this.get_element();return Sirius.Application.get_adapter().and_then(function(c){return c.get_attr(b,a)})};b.is_valid_strategy=function(a){return 0!==this._Strategies.filter(function(b){return b[0]===a}).length};
b.prototype.bind=function(a,b){return this.pipe(a,b)};b.prototype.pipe=function(a,b){(new Sirius.Transformer(this,a)).run(b)};b.register_strategy=function(a,b){null==b&&(b={});var c=Sirius.Application.get_logger();c.info("View: Register new Strategy "+a,c.view);var e=b.transform;var g=b.render;if(!Sirius.Utils.is_function(e))throw g="Strategy must be Function, but "+typeof e+" given.",c.error("View: "+g,c.view),Error(g);if(!Sirius.Utils.is_function(g))throw g="Strategy must be Function, but "+typeof g+
" given.",c.error("View: "+g,c.view),Error(g);if(!Sirius.Utils.is_string(a))throw g="Strategy name must be String, but "+typeof a+" given.",c.error("View: "+g,c.view),Error(g);this._Strategies.push([a,e,g]);return null};return b}();Sirius.View.register_strategy("swap",{transform:function(b,a){return""+a},render:function(b,a,c,e){return"text"===e?b.swap(a,c):"checked"===e?(c=Sirius.Utils.is_string(c)?"true"===c?!0:!1:!!c,b.set_prop(a,"checked",c)):b.set_attr(a,e,c)}});
Sirius.View.register_strategy("append",{transform:function(b,a){return a},render:function(b,a,c,e){var d=b.get_attr(a,"tagName");if("INPUT"===d||"TEXTAREA"===d||"SELECT"===d)throw Error("'append' strategy not work for `input` or `textarea` or `select` elements");if("text"===e)return b.append(a,c);throw Error("Strategy 'append' only work for 'text' content, not for '"+e+"'");}});
Sirius.View.register_strategy("prepend",{transform:function(b,a){return a},render:function(b,a,c,e){var d=b.get_attr(a,"tagName");if("INPUT"===d||"TEXTAREA"===d||"SELECT"===d)throw Error("'prepend' strategy not work for `input` or `textarea` or `select` elements");if("text"===e)return b.prepend(a,c);throw Error("Strategy 'prepend' only work for 'text' content, not for '"+e+"'");}});Sirius.View.register_strategy("clear",{transform:function(b,a){return""},render:function(b,a,c,e){return b.clear(a)}});
ComputedField=function(){function b(a,b,e){this.main=a;this.fields=b;this.fn=null!=e?e:null;this._count=this.fields.length;this._values=[]}b.prototype.get_fields=function(){return this.fields};b.prototype.complete=function(a,b){var c={};c[a]=b;return-1===this._values.map(function(a){return Object.keys(a)[0]}).indexOf(a)?(this._values.push(c),this.is_full()?this._result():null):null};b.prototype.field_name=function(){return this.main};b.prototype.remove=function(a){return delete this._values[a]};b.prototype._result=
function(){var a=this._values;var b=this.fields.map(function(b){return a.filter(function(a){return a[b]})[0][b]});return null===this.fn?b.join(" "):this.fn.apply(null,b)};b.prototype.is_full=function(){return this._values.length===this._count};return b}();
Sirius.BaseModel=function(){function b(a){var b,e,d,f;null==a&&(a={});(b=this.constructor.prototype)._cmp||(b._cmp=[]);(e=this.constructor.prototype)._cmp_fields||(e._cmp_fields=[]);this._listeners=[];this.logger=Sirius.Application.get_logger();this.errors={};this.attributes=this.normalize_attrs();var g=Sirius.Utils.fn_name(this.constructor);this.errors={};this._is_valid_attr={};e=this.attrs();var h=0;for(d=e.length;h<d;h++)if(b=e[h],this.logger.info("define '"+JSON.stringify(b)+"' attribute for '"+
g+"'",this.logger.base_model),Sirius.Utils.is_object(b)){var k=Object.keys(b);k=k[0];if(!k)throw this.logger.error("Attributes should have a key and value",this.logger.base_model),Error("Attributes should have a key and value");this["_"+k]=b[k];this._gen_method_name_for_attribute(k)}else this._gen_method_name_for_attribute(b),this["_"+b]=null;var l=this.constructor.skip;e=this.attributes;if(0!==Object.keys(a).length){var n=Object.keys(a);d=0;for(h=n.length;d<h;d++)b=n[d],-1===e.indexOf(b)&&l||(this._attribute_present(b),
g=this["_"+b],this["_"+b]=a[b],this._call_callbacks(b,a[b],g))}e=this.guid_for();h=0;for(b=e.length;h<b;h++)a=e[h],this.logger.debug("Generate guid for '"+this._klass_name()+"."+a+"'",this.logger.base_model),this.set(a,this._generate_guid());this._registered_validators=this.constructor._Validators;this._registered_validators_keys=this._registered_validators.map(function(a){return a[0]});a=this._model_validators=this.validators();for(k in a)for(f in b=a[k],this.errors[k]={},this._is_valid_attr[k]=
!1,b)if(-1===this._registered_validators_keys.indexOf(f)&&"validate_with"!==f)throw Error("Unregistered validator: "+f);this.after_create()}b._Validators=[];b.attrs=[];b.skip=!1;b.guid_for=null;b.validate={};b.comp=function(){var a,b,e,d;var f=1<=arguments.length?slice.call(arguments,0):[];(a=this.prototype)._cmp||(a._cmp=[]);(b=this.prototype)._cmp_fields||(b._cmp_fields=[]);(e=this.prototype)._cmp_refs||(e._cmp_refs={});if(0===f.length)throw new Exception("Compute field is empty");if(2===f.length)throw new Exception('Define compute field like: \'@comp("default_computed_field", "first_name", "last_name")\'');
var g=f[0];a=f.length;b=Sirius.Utils.is_function(f[a-1])?(d=f[a-1],[f.slice(1,a-1),f.slice(1,a-1),d]):[f.slice(1),f.slice(1),null];f=b[0];a=b[1];d=b[2];b=[g].concat(f);if(b.filter(function(a,b,c){return c.indexOf(a)===b}).length!==b.length)throw Error("Seems your calculated fields are not unique: ["+b+"]");var h=this.attrs.concat(this.prototype._cmp_fields);f.forEach(function(a){if(-1===h.indexOf(a))throw Error("Field is '"+a+"' not found, for '"+g+"'");});if(0<this.prototype._cmp_fields.length&&
(b=f.filter(function(a){return function(b){return a.prototype._cmp_refs[b]&&-1!==a.prototype._cmp_refs[b].indexOf(g)}}(this)),0<b.length))throw Error("Cyclic references detected in '"+g+"' field");Sirius.Application.get_logger().info("Define compute field '"+g+"' <- '["+f+"]'",Sirius.Application.get_logger().base_model);this.prototype._cmp_refs[g]=f;this.prototype._cmp_fields.push(g);return this.prototype._cmp.push(new ComputedField(g,a,d))};b.prototype.attrs=function(){return(this.constructor.attrs||
[]).concat(this.constructor.prototype._cmp_fields)};b.prototype.__name="BaseModel";b.prototype.normal_name=function(){return Sirius.Utils.underscore(this.constructor.name)};b.prototype._klass_name=function(){return this.constructor.name};b.prototype.validators=function(){return this.constructor.validate};b.prototype.guid_for=function(){var a;if(a=this.constructor.guid_for){if(Sirius.Utils.is_string(a))return[a];if(Sirius.Utils.is_array(a))return a;throw Error("'@guid_for' must be array of string, but "+
typeof a+" given");}return[]};b.prototype._compute=function(a,b){var c=this;return this.constructor.prototype._cmp.forEach(function(e){if(-1!==e.get_fields().indexOf(a)){var d=e.complete(a,b);if(e.is_full())return c._set(e.field_name(),d)}})};b.prototype.normalize_attrs=function(){var a;var b=this.attrs();var e=[];var d=0;for(a=b.length;d<a;d++){var f=b[d];e.push(function(a){return Sirius.Utils.is_object(a)?Object.keys(a)[0]:a}(f))}return e};b.prototype._gen_method_name_for_attribute=function(a){var b=
Sirius.Utils.underscore(a);if(-1!==Object.keys(this).indexOf(b))throw Error("Method "+b+" already exist");return this[b]=function(b){return function(c){return null!=c?b.set(a,c):b.get(a)}}(this)};b.prototype._generate_guid=function(){var a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return""+a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()};b.prototype.get_attributes=function(){return this.attributes};b.prototype._is_computed_attribute=function(a){return-1!==this.constructor.prototype._cmp_fields.indexOf(a)?
!0:!1};b.prototype._attribute_present=function(a){if(-1===this.attributes.indexOf(a))throw Error("Attribute '"+a+"' not found for "+this._klass_name()+" model");};b.prototype._call_callbacks=function(a,b,e){var c;var f=this._listeners;var g=0;for(c=f.length;g<c;g++){var h=f[g];h.apply(null,[a,b])}return this.after_update(a,b,e)};b.prototype._call_callbacks_for_errors=function(a,b,e){var c;a="errors."+a+"."+b;var f=this._listeners;var g=[];var h=0;for(c=f.length;h<c;h++)b=f[h],g.push(b.apply(null,
[a,e]));return g};b.prototype.set=function(a,b){if(this._is_computed_attribute(a))throw Error("Impossible set computed attribute "+a+" for "+this._klass_name());return this._set(a,b)};b.prototype._set=function(a,b){this._attribute_present(a);var c=this["_"+a];this["_"+a]=b;this.logger.debug("["+this.constructor.name+"] set: 'attr' to '"+b+"'",this.logger.base_model);this.validate(a);this._compute(a,b);return this._call_callbacks(a,b,c)};b.prototype.get=function(a){this._attribute_present(a);return this["_"+
a]};b.prototype.reset=function(){var a;var b=1<=arguments.length?slice.call(arguments,0):[];var e=this.attributes;this.logger.debug("Reset attributes: '"+b+"' for "+this._klass_name());var d=0;for(a=b.length;d<a;d++){var f=b[d];if(-1===e.indexOf(f))throw Error("Attribute '"+f+"' not found for "+this._klass_name()+" model");f="_"+f;"number"===typeof this[f]&&(this[f]=0);Sirius.Utils.is_string(this[f])&&(this[f]="");Sirius.Utils.is_array(this[f])&&(this[f]=[]);null!=this.errors[f]&&(this.errors[f]=
{})}};b.prototype.is_valid=function(){return 0===Object.keys(this._is_valid_attr).filter(function(a){return function(b){return!a._is_valid_attr[b]}}(this)).length};b.prototype.validate=function(a){null==a&&(a=null);var b=this._klass_name();var e=this.logger;var d=this.logger.base_model;Object.keys(this._model_validators||{}).filter(function(b){return null!=a?b===a:!0}).map(function(a){return function(c){var f,g;var l=a.get(c);var n=a._model_validators[c];var q=[];for(f in n){var r=n[f];var p="validate_with"===
f?(g=new Sirius.Validator,g.validate=r,g.msg=null,g):(g=a._registered_validators.filter(function(a){return a[0]===f})[0][1],new g);r=p.validate(l,r);e.debug("Validate: '"+b+"."+c+" = "+l+"' with '"+f+"' validator, valid?: '"+r+"'",d);p=r?(delete a.errors[c][f],a._is_valid_attr[c]=!0,""):(a.errors[c][f]=p.error_message(),a._is_valid_attr[c]=!1,p.error_message());q.push(a._call_callbacks_for_errors(c,f,p))}return q}}(this))};b.prototype.get_errors=function(a){var b;null==a&&(a=null);if(-1===this.attributes.indexOf(a)&&
null!==a)throw Error("Attribute '"+a+"' not found for "+this._klass_name()+" model");if(null!=a){var e=[];a=this.errors[a];for(b in a){var d=a[b];""!==d&&e.push(d)}return e}return this.errors};b.prototype.set_error=function(a,b){var c=a.split(".");if(2!==c.length)throw Error("Error must be pass as 'attr.validator' like 'name.length'");this.errors[c[0]][c[1]]=b;return this._is_valid_attr[c[0]]=!1};b.prototype.save=function(){this.validate();return this.is_valid()?!1:!0};b.prototype.to_json=function(){var a=
1<=arguments.length?slice.call(arguments,0):[];return JSON.stringify(this.to_object.apply(this,a))};b.prototype.to_object=function(){var a;var b=1<=arguments.length?slice.call(arguments,0):[];var e={};var d=this.attributes;var f=0;for(a=d.length;f<a;f++){var g=d[f];if(-1===b.indexOf(g)){var h=this.get(g);e[g]=h}}return e};b.from_json=function(a){var b;var e=new this;a=JSON.parse(a);var d=[].concat(e.attrs());var f=0;for(b=d.length;f<b;f++){var g=d[f];if("object"===typeof g){var h=Object.keys(g);h=
h[0];e.set(h,a[h]||g[h])}else h=a[g],e.set(g,h||e.get(g))}return e};b.prototype.compare=function(a){throw Error("`compare` method must be overridden");};b.prototype.after_create=function(){};b.prototype.after_update=function(a,b,e){};b.prototype.clone=function(){return this.constructor.from_json(this.to_json())};b.prototype._register_state_listener=function(a){var b;this.logger.debug("Register new listener for "+this.constructor.name,this.logger.base_model);this._listeners.push(a);var e=this.get_attributes();
var d=[];var f=0;for(b=e.length;f<b;f++){var g=e[f];null!==this["_"+g]?d.push(a.apply(null,[g,this["_"+g]])):d.push(void 0)}return d};b.prototype.pipe=function(a,b){null==b&&(b={});(new Sirius.Transformer(this,a)).run(b)};b.prototype.bind=function(a,b){null==b&&(b={});return this.pipe(a,b)};b.register_validator=function(a,b){var c=Sirius.Application.get_logger();c.info("register validator: "+a,c.base_model);this._Validators.push([a,b]);return null};return b}();
Sirius.BaseModel.register_validator("length",Sirius.LengthValidator);Sirius.BaseModel.register_validator("exclusion",Sirius.ExclusionValidator);Sirius.BaseModel.register_validator("inclusion",Sirius.InclusionValidator);Sirius.BaseModel.register_validator("format",Sirius.FormatValidator);Sirius.BaseModel.register_validator("numericality",Sirius.NumericalityValidator);Sirius.BaseModel.register_validator("presence",Sirius.PresenceValidator);
Sirius.Internal.AbstractTransformer=function(){function b(a,b,e){this._path=a;this._from=b;this._to=e;this.logger=Sirius.Application.get_logger();this._ln=this.logger.transformer;this._register()}b.prototype._register=function(){};return b}();
Sirius.Internal.ToFunctionTransformer=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype._register=function(){var a;if(this._from instanceof Sirius.BaseModel)return this._from._register_state_listener(this._to);this._from._register_state_listener(this);var b=this._fire_generator();var d=this._from.get_element();var f=this._path;var g=[];for(a in f)f=this._path.from||"text",g.push(new Sirius.Internal.Observer(d+" "+a,a,f,b));return g};a.prototype._fire_generator=
function(){var a=this._from;var b=this._to;return function(c){return b(c,a)}};return a}(Sirius.Internal.AbstractTransformer);
Sirius.Internal.ToViewTransformer=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype._register=function(){var a;var b=this._fire_generator();if(this._from instanceof Sirius.View){var d=this._from.get_element();var f=this._path.to;var g=[];var h=0;for(a=f.length;h<a;h++){var k=f[h];var l=Sirius.Utils.is_string(k)?[null,"text",k]:[k.from||d,k.attribute||"text",k.selector];var n=l[0];k=l[1];l=l[2];d=d===n?d:null!=n?d+" "+n:d;this.logger.debug("Observe '"+
d+"' -> '"+this._to.get_element()+" "+l+"'",this._ln);g.push(new Sirius.Internal.Observer(d,n,k,b))}return g}return this._from._register_state_listener(b)};a._default_via_method=function(){return function(a,b,d,f){null==f&&(f="text");return d.zoom(b).render(a).swap(f)}};a.prototype._fire_generator=function(){var a=this._to;var b=this._path;var d=this.logger;var f=this._ln;if(this._from instanceof Sirius.View)var g=function(c){var e;var d=b.to;var f=c.text;var g=[];var h=0;for(e=d.length;h<e;h++){var k=
d[h];if(Sirius.Utils.is_string(k)){var t=Sirius.Internal.ToViewTransformer._default_via_method();g.push(t(f,k,a,attribute))}else{var v=k.selector;c=k.attribute||"text";t=k.via||Sirius.Internal.ToViewTransformer._default_via_method();g.push(t(f,v,a,c))}}return g};else{var h=this._from;g=function(c,e){var g;if(g=b[c]){d.debug("Apply new value for '"+c+"' for '"+a.get_element()+"', value: "+e+" from "+h._klass_name(),f);var k=g.to;var l=g.attr||"text";g=g.via||Sirius.Internal.ToViewTransformer._default_via_method();
return g(e,k,a,l)}}}return g};return a}(Sirius.Internal.AbstractTransformer);
Sirius.Internal.ToModelTransformer=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}extend(a,b);a.prototype._register=function(){var a;this._from._register_state_listener(this);var b=this._fire_generator();var d=this._from.get_element();var f=this._path;var g=[];for(a in f)f=this._path.from||"text",g.push(new Sirius.Internal.Observer(d+" "+a,a,f,b));return g};a.prototype._default_via_method=function(){return function(a){return a}};a.prototype._fire_generator=function(){var a=
this._from;var b=this._path;var d=this._to;var f=this.logger;var g=this._ln;return function(c){var e;if(e=b[c.original]){var h=e.to;var n=e.from||"text";e=e.via||function(a){return a};f.debug("Apply new value from "+c.from+" ("+c.original+") to "+d._klass_name()+"."+h,g);return d.set(h,e(c.text,a,c.original,n,c.element))}}};return a}(Sirius.Internal.AbstractTransformer);
Sirius.Transformer=function(){function b(a,b){this.logger=Sirius.Application.get_logger();this.ln=this.logger.transformer;if(a instanceof Sirius.BaseModel)this._from=a;else if(a instanceof Sirius.View)this._from=a;else throw Error("Bad argument for Transformer, Model or View required, given "+a);if(b instanceof Sirius.BaseModel){if(this._from instanceof Sirius.BaseModel)throw Error("Impossible bind model and model");this._to=b}else if(b instanceof Sirius.View)this._to=b;else if(Sirius.Utils.is_function(b))this._to=
b;else throw Error("Bind works only with BaseModel, BaseView or Function, given: "+b);}b._Model=0;b._View=1;b._Function=2;b.prototype._from=null;b.prototype._to=null;b.prototype._path=null;b.prototype.run=function(a){var b;if(this._from&&this._to){if(this._from instanceof Sirius.BaseModel)for(g in a){var e=a[g];if(-1===this._from.get_attributes().indexOf(g)){var d=this._from._klass_name();var f=this._from.get_attributes();f="Attribute '"+g+"' not found in model attributes: '"+d+"', available: ["+
f+"]";-1!==g.indexOf(".")?0===g.lastIndexOf("errors")?(f=g.split("."),3!==f.length&&this.logger.warn("Try to bind '"+g+"' from errors, but validator was not found, correct definition like 'errors.id.numericality'",this.ln),this.logger.debug("bind: "+d+"."+g+" -> "+e.to,this.ln)):this.logger.warn(f,this.ln):this.logger.warn(f,this.ln)}}if(this._to instanceof Sirius.BaseModel)for(g in d=this._to._klass_name(),a)if(e=a[g],e=e.to)f=this._to.get_attributes(),-1===f.indexOf(e)?this.logger.warn("Attribute '"+
e+"' not found in model attributes: '"+d+"', available: ["+f+"]",this.ln):this.logger.debug("bind: '"+g+"' -> '"+d+"."+e+"'",this.ln);else throw a=JSON.stringify(a),Error("Impossible create transformer for "+d+", because in object: "+a+", 'to' key not defined");if(this._from instanceof Sirius.View&&this._to instanceof Sirius.View){d=this._from.get_element();var g=this._to.get_element();if(b=a.to)if(Sirius.Utils.is_array(b)){e=0;for(f=b.length;e<f;e++){var h=b[e];if(h.selector)h=h.selector,this.logger.debug("bind: '"+
d+"' -> '"+g+" "+h+"'",this.ln);else throw Error('You define binding with \'to\' as array of objects, but \'selector\' property was not found. Correct definition: {to: [{"selector": "#my-id", "attribute": "data-attr"}]}');}this._path=a}else if(Sirius.Utils.is_string(b))this.logger.debug("bind: '"+d+"' -> '"+g+" "+b+"'"),a.to=[b],this._path=a;else throw Error("For binding 'to' must be array or string, but "+typeof b+" given");else throw Error("Define View to View binding with: 'view1.bind(view2, {\"to\": \"selector\"})', but 'to' key not found");
}else{if(this._from instanceof Sirius.View&&Sirius.Utils.is_function(this._to)){d=this._from.get_element();if(0===Object.keys(a).length)throw Error("Binding with empty object forbidden");for(g in a)if(e=a[g],e.from)e=e.from,this.logger.debug("bind: '"+d+" "+g+"' (from '"+e+"') -> function",this.ln);else throw Error('For binding View and Function, you need to define object like: {"selector": {"from": "text"}}');}this._path=a}if(this._to instanceof Sirius.BaseModel)return new Sirius.Internal.ToModelTransformer(a,
this._from,this._to);if(this._to instanceof Sirius.View)return new Sirius.Internal.ToViewTransformer(a,this._from,this._to);if(Sirius.Utils.is_function(this._to))return new Sirius.Internal.ToFunctionTransformer(a,this._from,this._to)}else throw Error("Not all parameters defined for transformer: from: "+this._from+", to: "+this._to);};b.draw=function(a){var b=Sirius.Application.get_logger();b.debug("Draw Transformer",b.transformer);return a};return b}();
Sirius.Collection=function(){function b(a,b){var c;null==b&&(b={});if("BaseModel"!==a.__super__.__name)throw Error("Collection must be used only with `BaseModel` inheritor");this._array=[];this.logger=Sirius.Application.get_logger();this._klass=a;this._type=Sirius.Utils.fn_name(a);this._indexes=b.index||[];if(0<this._indexes.length){var d=a.prototype.attrs().map(function(a){return Sirius.Utils.is_object(a)?Object.keys(a)[0]:a});this._indexes.forEach(function(a){if(-1===d.indexOf(a))throw Error("Collection: field "+
a+" from indexes: ["+this._indexes+"] not exist in "+this._type);});this._indexes.forEach(function(a){return function(b){a.logger.debug("create index for "+b+" field in "+a._type,a.logger.collection);return a["index_"+b]={}}}(this))}this._subscribers={};var f=this.constructor._EVENTS;var g=0;for(c=f.length;g<c;g++){var h=f[g];this._subscribers[h]=[]}this.length=0}b._EVENTS=["add","remove"];b.prototype.push=function(a){return this.add(a)};b.prototype.add=function(a){this._add(a)};b.prototype._add=
function(a){var b=Sirius.Utils.fn_name(a.constructor);if(this._type!==b)throw b="Require `"+this._type+"`, but given `"+b+"`",this.logger.error("Collection: "+b,this.logger.collection),Error(b);this._array.push(a);0<this._indexes.length&&this._indexes.forEach(function(b){return function(c){return b["index_"+c][a.get(c)]=b.length}}(this));this.length++;return this._gen("add",a)};b.prototype.remove=function(a){var b=this.index(a);null!==b&&(this._array.splice(b,1),this._gen("remove",a),this.length--,
0<this._indexes.length&&this._indexes.forEach(function(c){return function(d){delete c["index_"+d][a.get(d)];return Object.keys(c["index_"+d]).filter(function(a){return c["index_"+d][a]>b}).map(function(a){return--c["index_"+d][a]})}}(this)))};b.prototype.index=function(a){var b,e;var d=null;var f=this._array;var g=b=0;for(e=f.length;b<e;g=++b){var h=f[g];h.compare(a)&&(d=g)}return d};b.prototype.find=function(a,b){return this.find_all(a,b)[0]||null};b.prototype.find_all=function(a,b){var c;if(0<this._indexes.length&&
-1!==this._indexes.indexOf(a))return[this._array[this["index_"+a][b]]];var d=this._array;var f=[];var g=0;for(c=d.length;g<c;g++){var h=d[g];h.get(a)===b&&f.push(h)}return f};b.prototype.filter=function(a){var b;null==a&&(a=function(){});var e=this._array;var d=[];var f=0;for(b=e.length;f<b;f++){var g=e[f];a.call(null,g)&&d.push(g)}return d};b.prototype.each=function(a){var b;null==a&&(a=function(){});var e=this._array;var d=[];var f=0;for(b=e.length;f<b;f++){var g=e[f];d.push(a.call(g))}return d};
b.prototype.first=function(){return this._array[0]};b.prototype.last=function(){return this._array[this._array.length-1]};b.prototype.all=function(){return this._array};b.prototype.clear=function(){this.length=0;this._array=[];if(0<this._indexes.length)return this._indexes.forEach(function(a){return function(b){return a["index_"+b]={}}}(this))};b.prototype.map=function(a){return this.collect(a)};b.prototype.collect=function(a){return this._array.map(a)};b.prototype.takeFirst=function(a){var b;var e=
null;var d=this._array;var f=0;for(b=d.length;f<b;f++){var g=d[f];if(a(g)){e=g;break}}return e};b.prototype.size=function(){return this._array.length};b.prototype.to_json=function(){var a;var b=this._array;var e=[];var d=0;for(a=b.length;d<a;d++){var f=b[d];e.push(f.to_object())}return JSON.stringify(e)};b.prototype.subscribe=function(a,b){if(-1===this.constructor._EVENTS.indexOf(a))throw Error("For 'subscribe' method available only ["+this.constructor._EVENTS+"], but given '"+a+"'");if(Sirius.Utils.is_string(b)||
Sirius.Utils.is_function(b))this.logger.info("Collection: Add new subscriber for '"+a+"' event",this.logger.collection),this._subscribers[a].push(b);else throw Error("Second parameter for 'subscribe' method must be Function or String, but '"+typeof b+"' given");};b.prototype._gen=function(){var a=arguments[0];var b=2<=arguments.length?slice.call(arguments,1):[];var e=this._subscribers[a];return Sirius.Application.get_adapter().and_then(function(a){var c;var d=[];var h=0;for(c=e.length;h<c;h++){var k=
e[h];Sirius.Utils.is_string(k)?d.push(a.fire.apply(a,[document,k].concat(slice.call(b)))):d.push(k.apply(null,b))}return d})};return b}();
