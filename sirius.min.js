/*
 Sirius.js v1.0.2
  (c) 2014-2018 fntz
  license: MIT
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");var Adapter,ComputedField,Sirius,VanillaJsAdapter;Sirius={VERSION:"0.8.5"};
var lib$sirius$classdecl$var0=function(){};lib$sirius$classdecl$var0.prototype.bind=function(a,b,c,d){};lib$sirius$classdecl$var0.prototype.off=function(a,b,c,d){};lib$sirius$classdecl$var0.prototype.fire=function(a,b,c){};lib$sirius$classdecl$var0.prototype.get_property=function(a,b){};lib$sirius$classdecl$var0.prototype.get_attr=function(a,b){};lib$sirius$classdecl$var0.prototype.set_prop=function(a,b,c){};lib$sirius$classdecl$var0.prototype.swap=function(a,b){};
lib$sirius$classdecl$var0.prototype.append=function(a,b){};lib$sirius$classdecl$var0.prototype.prepend=function(a,b){};lib$sirius$classdecl$var0.prototype.clear=function(a){};lib$sirius$classdecl$var0.prototype.set_attr=function(a,b,c){};lib$sirius$classdecl$var0.prototype.all=function(a){return"object"===typeof a&&1===a.nodeType||9===a.nodeType?a:document.querySelectorAll(a)};lib$sirius$classdecl$var0.prototype.get=function(a){return document.querySelector(a)};
lib$sirius$classdecl$var0.prototype.state=function(a){};Adapter=lib$sirius$classdecl$var0;var lib$sirius$classdecl$var1=function(a){return Adapter.apply(this,arguments)||this};$jscomp.inherits(lib$sirius$classdecl$var1,Adapter);lib$sirius$classdecl$var1.prototype._get_element_from_selector=function(a){if("object"===typeof a&&1===a.nodeType)return a;var b=this.all(a);if(0===b.length)throw Error("Selector `"+a+"` not found");return b[0]};
lib$sirius$classdecl$var1.prototype.bind=function(a,b,c,d){var e,f;if(null===b||b===a)a.addEventListener(c,d);else if("object"===typeof b&&1===b.nodeType)b.addEventListener(c,d);else for(a=this.all(b),b=e=0,f=a.length;0<=f?0<=e&&e<f:0>=e&&e>f;b=0<=f?++e:--e)a.item(b).addEventListener(c,d)};
lib$sirius$classdecl$var1.prototype.off=function(a,b,c,d){var e,f;if(null===b||b===a)a.removeEventListener(c,d);else for(a=this.all(b),b=e=0,f=a.length;0<=f?0<=e&&e<f:0>=e&&e>f;b=0<=f?++e:--e)a.item(b).removeEventListener(c,d)};lib$sirius$classdecl$var1.prototype.fire=function(a,b,c){for(var d=[],e=2;e<arguments.length;++e)d[e-2]=arguments[e];e=document.createEvent("CustomEvent");e.initCustomEvent(b,!1,!0,d);document.dispatchEvent(e)};
lib$sirius$classdecl$var1.prototype.get_property=function(a,b){var c;var d=a.target;var e=[];var f=0;for(c=b.length;f<c;f++){var g=b[f];e.push(this.get_attr(d,g))}return e};lib$sirius$classdecl$var1.prototype.get_attr=function(a,b){var c=this._get_element_from_selector(a);var d=c.getAttribute(b);return null==d?c[b]:d};lib$sirius$classdecl$var1.prototype.swap=function(a,b){var c=this._get_element_from_selector(a);var d=c.tagName;"INPUT"===d||"TEXTAREA"===d||"SELECT"===d?c.value=b:c.textContent=b};
lib$sirius$classdecl$var1.prototype.set_attr=function(a,b,c){this._get_element_from_selector(a).setAttribute(b,c)};lib$sirius$classdecl$var1.prototype.set_prop=function(a,b,c){this._get_element_from_selector(a).setAttribute(b,c)};lib$sirius$classdecl$var1.prototype.append=function(a,b){var c=this._get_element_from_selector(a);c.textContent+=b};lib$sirius$classdecl$var1.prototype.prepend=function(a,b){var c=this._get_element_from_selector(a);c.textContent=b+c.textContent};
lib$sirius$classdecl$var1.prototype.clear=function(a){a=this._get_element_from_selector(a);var b=a.tagName;"INPUT"===b||"TEXTAREA"===b?a.value="":a.textContent=""};lib$sirius$classdecl$var1.prototype.text=function(a){a=this._get_element_from_selector(a);var b=a.tagName;return"INPUT"===b||"TEXTAREA"===b||"SELECT"===b?a.value:a.innerText?a.innerText:a.textContent};lib$sirius$classdecl$var1.prototype.get_state=function(a){return this._get_element_from_selector(a).checked};VanillaJsAdapter=lib$sirius$classdecl$var1;
Sirius.Logger=function(){var a=function(a,c,d){var b=this,f;var g=Sirius.Logger.Filters;var h=0;for(f=g.length;h<f;h++){var k=g[h];this[Sirius.Utils.underscore(k).toLowerCase()]=k}var l=Sirius.Logger.Levels;f=0;for(k=l.length;f<k;f++)h=l[f],function(e){return b[e]=function(b,f){if(a){if(!f)return d(e.toUpperCase(),b);if(-1!==c.indexOf(f)||null==f||-1===g.indexOf(f))return b="["+f.toUpperCase()+"] "+b,d(e.toUpperCase(),b)}}}(h)};a.Levels=["debug","info","warn","error"];a.Filters="BaseModel Binding Collection View Routing Application Redirect Validation Transformer".split(" ");
return a}.call(this);Sirius.Internal={};var lib$sirius$classdecl$var2=function(a){this.value=a;this.fn=function(){}};lib$sirius$classdecl$var2.prototype.and_then=function(a){return null!=this.value?a(this.value):this.fn=a};lib$sirius$classdecl$var2.prototype.set_value=function(a){this.value=a;return this.fn(a)};Sirius.Promise=lib$sirius$classdecl$var2;var lib$sirius$classdecl$var3=function(){};lib$sirius$classdecl$var3.is_function=function(a){return"[object Function]"===Object.prototype.toString.call(a)};
lib$sirius$classdecl$var3.is_string=function(a){return"[object String]"===Object.prototype.toString.call(a)};lib$sirius$classdecl$var3.is_array=function(a){return"[object Array]"===Object.prototype.toString.call(a)};lib$sirius$classdecl$var3.is_object=function(a){return null!==a&&"object"===typeof a};lib$sirius$classdecl$var3.camelize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};lib$sirius$classdecl$var3.underscore=function(a){return a.replace(/([A-Z])/g,"_$1").replace(/^_/,"").toLowerCase()};
lib$sirius$classdecl$var3.ie_version=function(){var a=window.navigator.userAgent;var b=a.indexOf("MSIE ");var c=a.indexOf("Trident/");return 0<b?parseInt(a.substring(b+5,a.indexOf(".",b)),10):0<c?(b=a.indexOf("rv:"),parseInt(a.substring(b+3,a.indexOf(".",b)),10)):0};lib$sirius$classdecl$var3.is_ie9=function(){return 9===this.ie_version()};
lib$sirius$classdecl$var3.fn_name=function(a){if(this.is_function(a))return a.toString().match(/function ([^\(]+)/)[1];throw Error("Need function, given "+typeof a);};Sirius.Utils=lib$sirius$classdecl$var3;
Sirius.redirect=function(a){var b=Sirius.Application;b.logger.info("Redirect to "+a,b.logger.redirect);b.use_hash_routing_for_old_browsers&&!b.push_state_support&&(a=0===a.indexOf("#")?a:0===a.indexOf("/")?"#"+a:"#/"+a);if(0===a.indexOf("#")){if(b.push_state_support)return location.replace(a)}else if(b.push_state_support)return Sirius.Internal.RouteSystem.dispatch.call(null,{type:"redirect",target:{href:a}})};
var lib$sirius$classdecl$var4=function(a){this.end=!0;this.start=null;this.parts=[];this.args=[];a=a.replace(/\/$/,"").split("/");""===a[0]&&(a[0]="#");"*"===a[a.length-1]&&(this.end=!1);this.parts=a.slice(0)};
lib$sirius$classdecl$var4.prototype.match=function(a){this.args=[];var b=a.replace(/\/$/,"").split("/");""===b[0]&&(b[0]="#");if(b.length!==this.parts.length&&this.end||1<this.parts.length&&b.length<this.parts.length)return!1;var c=function(a){return 0===a.indexOf(":")};var d=function(a){return 0===a.indexOf("[")};var e=function(a){return 0===a.indexOf("*")};var f=-1;for(a=[];10>f;){f++;var g=$jscomp.makeIterator([this.parts[f],b[f]]);var h=g.next().value;g=g.next().value;if(!h||!g)break;if(c(h))a.push(b[f]);
else if(d(h)){h=new RegExp("^"+h+"$");if(!h.test(g))return!1;a.push(h.exec(g)[0])}else{if(e(h)){a=a.concat(b.slice(f));break}if(h!==g)return!1}}this.args=a;return!0};Sirius.Internal.RoutePart=lib$sirius$classdecl$var4;
var lib$sirius$classdecl$var5=function(a,b){b=void 0===b?function(a){return a}:b;this.logger=Sirius.Application.get_logger();var c;if(!(c=a.controller))throw Error("Params must contain a Controller");var d=a.action;if(Sirius.Utils.is_string(d))var e=c[d];else if(Sirius.Utils.is_function(d))e=d;else throw e="Action must be string or function",this.logger.error("ControlFlow: "+e,this.logger.routing),Error(e);if(!e)throw e="action "+d+" not found in controller "+c,this.logger.error("ControlFlow: "+e,
this.logger.routing),Error(e);this.action=b(e);e=function(b,e){e=void 0===e?!1:e;var f=a[b];var g=c[b+"_"+d];var l=function(a){return Error(a+" action must be string or function")};if(Sirius.Utils.is_string(f)){g=c[f];if(!Sirius.Utils.is_function(g))throw l(Sirius.Utils.camelize(b));return g}if(Sirius.Utils.is_function(f))return f;if(f)throw l(Sirius.Utils.camelize(b));if(g){if(!Sirius.Utils.is_function(g))throw l(Sirius.Utils.camelize(b));return g}return e?null:function(){}};this.before=e("before");
this.after=e("after");this.guard=e("guard",!0);this.data=a.data||null;this.controller=c};
lib$sirius$classdecl$var5.prototype.handle_event=function(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];this.logger.debug("ControlFlow: Start event processing",this.logger.routing);if(a)if(d=Sirius.Utils.is_array(this.data)?this.data:this.data?[this.data]:[],d=Sirius.Application.adapter.get_property(a,d),d=[].concat([],[a],d),d=[].concat.apply([],[].concat([[],d],$jscomp.arrayFromIterable(c))),this.guard){if(this.guard.apply(this.controller,d))return this.before.apply(this.controller),
this.action.apply(this.controller,d),this.after.apply(this.controller)}else return this.before.apply(this.controller),this.action.apply(this.controller,d),this.after.apply(this.controller);else if(c=[].concat.apply([],c),this.guard){if(this.guard.apply(this.controller,c))return this.before.apply(this.controller),this.action.apply(this.controller,c),this.after.apply(this.controller)}else return this.before.apply(this.controller),this.action.apply(this.controller,c),this.after.apply(this.controller)};
lib$sirius$classdecl$var5.prototype.tick=function(){this.logger.debug("ControlFlow: tick",this.logger.routing);if(this.guard){if(this.guard.apply(this.controller))return this.before.apply(this.controller),this.action.apply(this.controller),this.after.apply(this.controller)}else return this.before.apply(this.controller),this.action.apply(this.controller),this.after.apply(this.controller)};Sirius.Internal.ControlFlow=lib$sirius$classdecl$var5;
Sirius.Internal.RouteSystem={_every:"every",_scheduler:"scheduler",_once:"once",_selector:"a:not([href^='#'])",_is_hash_route:function(a){return 0===a.toString().indexOf("#")},_is_404_route:function(a){return"404"===a.toString()},_is_plain_route:function(a){return 0===a.toString().indexOf("/")},_is_scheduler_command:function(a){return 0===a.lastIndexOf(this._scheduler)||0===a.lastIndexOf(this._once)||0===a.lastIndexOf(this._every)},_is_event_route:function(a){return!this._is_hash_route(a)&&!this._is_404_route(a)&&
!this._is_plain_route(a)&&!this._is_scheduler_command(a)},_get_time_unit:function(a,b){var c;if(c=b.match(/^(\d+)(ms|s|m)/)){var d=parseInt(c[1],10);c=c[2]||"s";return"ms"===c?d:"s"===c?1E3*d:6E4*d}throw Error("Bad time unit: "+b+" in "+a+", available units: 'ms', 's', 'm'");},_get_scheduler_params:function(a){var b=a.split(" ");var c="Define time unit for scheduler, for example: 'every 10s', given: "+a;if(1===b.length)throw Error(c);if(2===b.length)return c=Sirius.Internal.RouteSystem._get_time_unit(a,
b[1]),{delay:null,time:c};if(3===b.length)return c=Sirius.Internal.RouteSystem._get_time_unit(a,b[1]),a=Sirius.Internal.RouteSystem._get_time_unit(a,b[2]),{delay:c,time:a};throw Error(c);},_scheduler_register:function(a,b,c,d){var e;var f=this._every;var g=this._scheduler;var h=this._get_scheduler_params;var k=[];for(e in a)c=a[e],this._is_scheduler_command(e)&&k.push(function(a,c){var e=Sirius.Utils.is_function(c)?b(c):function(){return(new Sirius.Internal.ControlFlow(c,b)).tick()};var k=h(a);d.debug("Define scheduler for '"+
a+"' with "+JSON.stringify(k),d.routing);return 0===a.lastIndexOf(f)||0===a.lastIndexOf(g)?null===k.delay?setInterval(e,k.time):setTimeout(function(){return setInterval(e,k.time)},k.delay):null===k.delay?setTimeout(e,k.time):setTimeout(function(){return setTimeout(e,k.time)},k.delay)}(e,c));return k},_event_register:function(a,b,c,d){var e;var f=[];for(e in a){var g=a[e];this._is_event_route(e)&&f.push(function(a,e){var f=Sirius.Utils.is_function(e)?b(e):function(a,c){for(var d=[],f=1;f<arguments.length;++f)d[f-
1]=arguments[f];return(new Sirius.Internal.ControlFlow(e,b)).handle_event(a,d)};var g=a.match(/^([a-zA-Z:]+)(\s+)?(.*)?/);var k=g[1];g=g[3]||document;c.bind(document,g,k,f);return d.debug("RouteSystem: define event route: '"+k+"' for '"+g+"'",d.routing)}(e,g))}return f},_get_hash_routes:function(a,b,c,d){var e=[];for(f in a)if(c=a[f],this._is_hash_route(f)){d.info("RouteSystem: define hash route: '"+f+"'",d.routing);var f=new Sirius.Internal.RoutePart(f);c=Sirius.Utils.is_function(c)?b(c):new Sirius.Internal.ControlFlow(c,
b);e.push([f,c])}return e},_get_plain_routes:function(a,b,c,d){var e=[];for(f in a)if(c=a[f],this._is_plain_route(f)){d.debug("RouteSystem: define route: '"+f+"'",d.routing);var f=new Sirius.Internal.RoutePart(f);c=Sirius.Utils.is_function(c)?b(c):new Sirius.Internal.ControlFlow(c,b);e.push([f,c])}return e},create:function(a,b,c){c=void 0===c?function(){}:c;var d=this,e;var f=Sirius.Application.get_logger();var g=e=window.location.hash;var h=b.old;var k=b.support;var l=b.ignore;return Sirius.Application.get_adapter().and_then(function(b){if(h&&
!k){f.info("RouteSystem: Convert plain routing into hash routing",f.routing);var r=[];var p={};for(m in a){var n=a[m];d._is_hash_route(m)&&r.push(m);if(d._is_plain_route(m)){var m="#"+m;-1!==r.indexOf(m)&&f.warn("RouteSystem: Routes already defined '"+m+"' url",f.routing)}p[m]=n}a=p}var q=function(a){var b;var c=Sirius.Application.controller_wrapper;for(b in c){var d=c[b];this[b]=d}return a};d._event_register(a,q,b,f);d._scheduler_register(a,q,b,f);var v=d._get_hash_routes(a,q,b,f);var w=d._get_plain_routes(a,
q,b,f);var x=function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1};var u=function(c){var d,h,p;e=g;var m=p=!1;f.info("RouteSystem: start processing route: '"+g+"'",f.routing);if("hashchange"===c.type){var r=v;g=window.location.hash;var n=window.location.origin;m=!0;k?history.pushState({href:g},""+g,n+"/"+g):history.replaceState({href:g},""+g,n+"/"+g)}else r=w,n=c.target.href,"popstate"!==c.type&&k&&history.pushState({href:n},""+n,n),n=window.location.pathname,""===n&&(n="/"),g=
n;var u=0;for(d=r.length;u<d;u++){var t=r[u];n=t[0];(h=n.match(g))&&!p&&(p=!0,t=t[1],t.handle_event?t.handle_event(null,n.args):t.apply(null,n.args))}p?(x(c),f.debug("RouteSystem: Url change to: "+g,f.routing),b.fire(document,"application:urlchange",g,e)):l?(m&&f.warn("Seems you ignore hash based urls: "+g),f.debug("ignore_not_matched_urls is enabled, url was not matched: '"+g+"'")):(f.warn("RouteSystem: route '"+g+"' not found. Generate 404 event",f.routing),b.fire(document,"application:404",g,e),
(m=a["404"]||a[404])&&(Sirius.Utils.is_function(m)?q(m)(g):(new Sirius.Internal.ControlFlow(m,q)).handle_event(null,g)),x(c))};d.dispatch=u;0!==w.length&&b.bind(document,d._selector,"click",u);window.onhashchange=u;k&&b.bind(window,null,"popstate",function(a){if(history&&null!=history.state&&void 0!==history.state.href&&0!==history.state.href.indexOf("#"))return u(a)});return c()})}};
Sirius.Application={log:!1,adapter:null,running:!1,route:{},start:!1,controller_wrapper:{redirect:Sirius.redirect},mix_logger_into_controller:!0,use_hash_routing_for_old_browsers:!0,ignore_not_matched_urls:!0,default_log_function:function(a,b){return console&&console.log?console.log(a+": "+b):alert("Not supported `console`. You should define own `logger` function for Sirius.Application")},log_filters:[],_wait:[],_messages_queue:[],get_logger:function(){var a;if(this.logger)return this.logger;var b=
Sirius.Logger.Levels;var c={};var d=this._messages_queue;var e=0;for(a=b.length;e<a;e++){var f=b[e];(function(a){return c[a]=function(b,c){return d.push([a,b,c])}})(f)}b=Sirius.Logger.Filters;a=0;for(f=b.length;a<f;a++)e=b[a],c[Sirius.Utils.underscore(e).toLowerCase()]=e;return c},get_adapter:function(){if(null==this.adapter){var a=new Sirius.Promise;this._wait.push(a);return a}return new Sirius.Promise(this.adapter)},run:function(a){a=void 0===a?{}:a;var b=this,c;var d=function(b,c){return null!=
a[b]?a[b]:c};this.running=!0;this.log=a.log||this.log;this.adapter=a.adapter||new VanillaJsAdapter;this.route=a.route||this.route;this.mix_logger_into_controller=d("mix_logger_into_controller",this.mix_logger_into_controller);this.log_filters=a.log_filters||this.log_filters;this.ignore_not_matched_urls=d("ignore_not_matched_urls",this.ignore_not_matched_urls);if("all"===this.log_filters)this.log_filters=Sirius.Logger.Filters;else if(0<this.log_filters.length){var e=Sirius.Logger.Filters;var f=this.log_filters;
if("number"===typeof this.log_filters[0]){var g=f.sort()[f.length-1];var h=f.sort()[0];if(0>h)throw Error("Undefined index for log filters "+h);if(g>e.length)throw Error("Undefined index for log filters "+g);this.log_filters=f.map(function(a){return e[a]})}else if(g=this.log_filters.filter(function(a){return-1===e.indexOf(a)}),0!==g.length)throw Error("Check log filters given `"+f+"`. Allow "+e);}else this.log_filters=[];this.logger=new Sirius.Logger(this.log,this.log_filters,a.logger||this.default_log_function);
this.start=a.start||this.start;f=a.controller_wrapper||{};for(c in f)g=f[c],this.controller_wrapper[c]=g;this.hash_always_on_top=d("hash_always_on_top",this.hash_always_on_top);this.use_hash_routing_for_old_browsers=d("use_hash_routing_for_old_browsers",this.use_hash_routing_for_old_browsers);this.logger.info("Logger enabled? "+this.log,this.logger.application);this.logger.info("Log filters: "+this.log_filters,this.logger.application);this.logger.info("Adapter: "+this.adapter.name,this.logger.application);
this.logger.info("Use hash routing for old browsers: "+this.use_hash_routing_for_old_browsers,this.logger.application);this.logger.info("Current browser: "+navigator.userAgent,this.logger.application);this.logger.info("Ignore not matched urls: "+this.ignore_not_matched_urls,this.logger.application);this.push_state_support=history.pushState?!0:!1;this.logger.info("History pushState support: "+this.push_state_support,this.logger.application);!this.push_state_support&&this.use_hash_routing_for_old_browsers&&
this.logger.warn("You browser not support pushState, and you disable hash routing for old browser",this.logger.application);this.logger.info("Mix logger in controllers "+this.mix_logger_into_controller,this.logger.application);this.mix_logger_into_controller&&(this.controller_wrapper.logger&&this.logger.warn("Logger method already in `controller_wrapper`",this.logger.application),d=this.logger,this.controller_wrapper.logger={info:d.info,debug:d.debug,warn:d.warn,error:d.error});Sirius.Internal.RouteSystem.create(this.route,
{old:this.use_hash_routing_for_old_browsers,support:this.push_state_support,ignore:this.ignore_not_matched_urls},function(){var a;var c=b._wait;var d=0;for(a=c.length;d<a;d++){var e=c[d];e.set_value(b.adapter)}b.adapter.fire(document,"application:run",new Date);c=b._messages_queue;var f=[];e=0;for(d=c.length;e<d;e++)a=c[e],f.push(b.logger[a[0]].call(null,a[1],a[2]));return f});if(this.start)return Sirius.redirect(this.start)}};
var lib$sirius$classdecl$var6=function(){this.logger=Sirius.Application.get_logger();this.msg=null};lib$sirius$classdecl$var6.prototype.error_message=function(){return this.msg};Sirius.Validator=lib$sirius$classdecl$var6;var lib$sirius$classdecl$var7=function(a){Sirius.Validator.apply(this,arguments)};$jscomp.inherits(lib$sirius$classdecl$var7,Sirius.Validator);
lib$sirius$classdecl$var7.prototype.validate=function(a,b){this.logger.info("LengthValidator: start validate '"+a+"'",this.logger.validation);if(null!=a){var c=b.max||Number.POSITIVE_INFINITY;var d=b.min||Number.NEGATIVE_INFINITY;var e=b.length;var f=a.length;if(e){if(f===e)return!0;this.msg="Required length: "+e+", given: "+f;return!1}if(f>=d&&f<=c)return!0;this.msg="Required length in range [0.."+c+"], given: "+f;return!1}this.msg="Given null for LengthValidator";return!1};
Sirius.LengthValidator=lib$sirius$classdecl$var7;var lib$sirius$classdecl$var8=function(a){Sirius.Validator.apply(this,arguments)};$jscomp.inherits(lib$sirius$classdecl$var8,Sirius.Validator);lib$sirius$classdecl$var8.prototype.validate=function(a,b){this.logger.info("ExclusionValidator: start validate '"+a+"'",this.logger.validation);if(-1===(b.within||[]).indexOf(a))return!0;this.msg="Value "+a+" reserved";return!1};Sirius.ExclusionValidator=lib$sirius$classdecl$var8;
var lib$sirius$classdecl$var9=function(a){Sirius.Validator.apply(this,arguments)};$jscomp.inherits(lib$sirius$classdecl$var9,Sirius.Validator);lib$sirius$classdecl$var9.prototype.validate=function(a,b){this.logger.info("InclusionValidator: start validate '"+a+"'",this.logger.validation);var c=b.within||[];if(-1<c.indexOf(a))return!0;this.msg="Value "+a+" should be in range "+c;return!1};Sirius.InclusionValidator=lib$sirius$classdecl$var9;
var lib$sirius$classdecl$var10=function(a){Sirius.Validator.apply(this,arguments)};$jscomp.inherits(lib$sirius$classdecl$var10,Sirius.Validator);lib$sirius$classdecl$var10.prototype.validate=function(a,b){this.logger.info("FormatValidator: start validate '"+a+"'",this.logger.validation);var c;if(!(c=b["with"]))throw Error("format attribute required");if(null!=a){if(c.test(a))return!0;this.msg="Value "+a+" not for current format";return!1}this.msg="Given null for Format";return!1};
Sirius.FormatValidator=lib$sirius$classdecl$var10;var lib$sirius$classdecl$var11=function(a){Sirius.Validator.apply(this,arguments)};$jscomp.inherits(lib$sirius$classdecl$var11,Sirius.Validator);
lib$sirius$classdecl$var11.prototype.validate=function(a,b){b=void 0===b?{}:b;this.logger.info("NumericalityValidator: start validate '"+a+"'",this.logger.validation);if(b.only_integers){if(/^\d+$/.test(a))return!0;this.msg="Only allows integer numbers";return!1}if(/^\d+(?:\.\d{1,})?$/.test(a))return!0;this.msg="Only allows numbers";return!1};Sirius.NumericalityValidator=lib$sirius$classdecl$var11;var lib$sirius$classdecl$var12=function(a){Sirius.Validator.apply(this,arguments)};
$jscomp.inherits(lib$sirius$classdecl$var12,Sirius.Validator);lib$sirius$classdecl$var12.prototype.validate=function(a,b){this.logger.info("PresenceValidator: start validate '"+a+"'",this.logger.validation);if(a)return!0;this.msg="Value required";return!1};Sirius.PresenceValidator=lib$sirius$classdecl$var12;var lib$sirius$classdecl$var13=function(a,b,c,d,e,f){this.from_element=a;this.watch_for=b;this.event=c;this.handler=d;this.observer=e;this.config=f};
lib$sirius$classdecl$var13.prototype.is_observer=function(){return null!==this.observer};lib$sirius$classdecl$var13.prototype.is_listener=function(){return!this.is_observer};Sirius.Internal.CacheHandlerProperty=lib$sirius$classdecl$var13;
Sirius.Internal.CacheObserverHandlers={_handlers:[],add_new_observer:function(a,b,c,d,e){a=new Sirius.Internal.CacheHandlerProperty(a,b,null,c,d,e);return this._handlers.push(a)},add_new_bind_event:function(a,b,c,d){a=new Sirius.Internal.CacheHandlerProperty(a,b,c,d,null);return this._handlers.push(a)},find_by_element:function(a){return this._handlers.filter(function(b){return b.from_element===a})},find_by_element_and_watch_for:function(a,b){return this._handlers.filter(function(c){return c.from_element===
a&&c.watch_for===b})},find_by_element_watch_for_and_event:function(a,b,c){return this._handlers.filter(function(d){return d.from_element===a&&d.watch_for===b&&d.event===c})}};
Sirius.Internal.Observer=function(){var a=function(a,b,c,d){d=void 0===d?function(){}:d;this._create=this._create.bind(this);this.from_element=a;this.original=b;this.watch_for=c;this.clb=d;Sirius.Application.get_adapter().and_then(this._create)};a.is_text_event=function(a){return-1!==this.TextEvents.indexOf(a.type)};a.is_focus_event=function(a){return-1!==[this.Ev.focusin,this.Ev.focusout].indexOf(a.type)};a.prototype._create=function(a){var f=Sirius.Application.get_logger();var h=this.clb;var k=
this.from_element;var l=this.original;var q=null;var r=this.watch_for;var p=a.get_attr(k,"tagName");var n=a.get_attr(k,"type");f.debug("Create binding for "+k,f.binding);var m=Sirius.Internal.Observer;var t=function(b){f.debug("Handler Function: given "+b.type+" event",f.binding);var c={text:null,attribute:null,from:k,original:l,element:b.target};if(!m.is_focus_event(b)){var d=a.text(k);if(-1===[m.Ev.input,m.Ev.selectionchange].indexOf(b.type)||d!==q){m.is_text_event(b)&&(q=c.text=d);b.type===m.Ev.change&&
(c.state=a.get_state(k));if("attributes"===b.type){d=b.attributeName;var e=b.oldValue||[];var g=a.get_attr(k,d);c.text=g;c.attribute=d;c.previous=e}b.type===m.Ev.DOMAttrModified&&(d=b.originalEvent.attrName,e=b.originalEvent.prevValue,g=a.get_attr(k,d),c.text=g,c.attribute=d,c.previous=e);return h(c)}}};if("text"===r)if(-1!==c.indexOf(p)){f.debug("It is not a "+c,f.binding);if(-1!==d.indexOf(n)||p===e)return f.debug("Get a "+n+" & "+p+" element for bool elements",f.binding),a.bind(document,k,m.Ev.change,
t),Sirius.Internal.CacheObserverHandlers.add_new_bind_event(k,r,m.Ev.change,t);q=a.text(k);a.bind(document,k,m.Ev.input,t);Sirius.Internal.CacheObserverHandlers.add_new_bind_event(k,r,m.Ev.input,t);if(Sirius.Utils.is_ie9())return f.warn("Hook for work with IE9 browser",f.binding),a.bind(document,k,m.Ev.selectionchange,t),Sirius.Internal.CacheObserverHandlers.add_new_bind_event(k,r,m.Ev.selectionchange,t)}else return f.warn("Seems you try to bind for "+p+" of "+n+" for 'text' which is not supported");
else{if(b){f.debug("MutationObserver support",f.binding);var v=new b(function(a){return a.forEach(t)});p={childList:!0,attributes:!0,characterData:!0,attributeOldValue:!0,characterDataOldValue:!0,subtree:!1};n=a.get(k);v.observe(n,p);return Sirius.Internal.CacheObserverHandlers.add_new_observer(k,r,t,v,p)}f.warn("MutationObserver not supported",f.binding);f.warn("Use Deprecated events for observe",f.binding);a.bind(document,k,m.Ev.DOMNodeInserted,t);a.bind(document,k,m.Ev.DOMAttrModified,t);Sirius.Internal.CacheObserverHandlers.add_new_bind_event(k,
r,m.Ev.DOMNodeInserted,t);return Sirius.Internal.CacheObserverHandlers.add_new_bind_event(k,r,m.Ev.DOMAttrModified,t)}};var b=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver||null;var c=["INPUT","TEXTAREA","SELECT"];var d=["checkbox","radio"];var e="OPTION";a.Ev={input:"input",selectionchange:"selectionchange",childList:"childList",change:"change",DOMNodeInserted:"DOMNodeInserted",focusout:"focusout",focusin:"focusin",DOMAttrModified:"DOMAttrModified"};a.TextEvents=
[a.Ev.input,a.Ev.childList,a.Ev.change,a.Ev.DOMNodeInserted,a.Ev.selectionchange];return a}.call(this);
Sirius.View=function(){var a=function(a,b){b=void 0===b?function(a){return a}:b;var c=this,d;this.element=a;this.clb=b;var e=this.element;var k=this.clb;var l=Sirius.View._Cache.filter(function(a){return a.element===e&&""+a.clb===""+k});if(0!==l.length)return l[0];this._listeners=[];this._cache_event_handlers=[];this.logger=Sirius.Application.get_logger();this._result_fn=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];return k.apply.apply(k,[].concat([null],$jscomp.arrayFromIterable(b)))};
this.logger.debug("Create a new View for "+this.element,this.logger.view);var q=this.constructor._Strategies;l=0;for(d=q.length;l<d;l++){var r=q[l];(function(a){var b=a[0];c.logger.debug("Define "+b+" strategy",c.logger.view);var d=a[1];var f=a[2];return c[b]=function(a){a=void 0===a?"text":a;var b=c._result;e=c.element;c.logger.debug("Start processing strategy for "+e,c.logger.view);return Sirius.Application.get_adapter().and_then(function(c){var g="text"===a?c.text(e):c.get_attr(e,a);g=d(g,b);return f(c,
e,g,a)})}})(r)}Sirius.View._Cache.push(this);return this};a.prototype.name=function(){return"View"};a.prototype.get_element=function(){return this.element};a.prototype._register_state_listener=function(a){this.logger.debug("Register new listener for element: "+this.get_element,this.logger.view);return this._listeners.push(a)};a.prototype.render=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];this.logger.debug("Call render for "+b,this.logger.view);this._result=this._result_fn(b);
return this};a.prototype.zoom=function(a){a=a===this.element?this:new Sirius.View(this.element+" "+a);a._result=this._result;return a};a.prototype.on=function(a,b,f,g){for(var d=[],e=3;e<arguments.length;++e)d[e-3]=arguments[e];a=a===this.element?a:this.element+" "+a;if(Sirius.Utils.is_string(f))var l=0;else if(Sirius.Utils.is_function(f))l=1;else throw Error("View: 'custom_event_name' must be string or function, "+typeof f+" given");var q=new c(a,b,f);e=this._cache_event_handlers.filter(function(a){return a.eq(q)});
if(0===e.length)if(this.logger.info("Bind event for "+a+", event name: "+b+", will be called : "+f,this.logger.view),0===l){var r=function(a){return Sirius.Application.get_adapter().and_then(function(b){return b.fire.call.apply(b.fire,[].concat([null,document,f,a],$jscomp.arrayFromIterable(d)))})};Sirius.Application.get_adapter().and_then(function(c){return c.bind(document,a,b,r)});e=new c(a,b,r);this._cache_event_handlers.push(e)}else Sirius.Application.get_adapter().and_then(function(c){return c.bind(document,
a,b,f)}),this._cache_event_handlers.push(q);else{var p=e.shift();e=this._cache_event_handlers.indexOf(p);-1<e&&this._cache_event_handlers.splice(e,1);this._cache_event_handlers.push(q);Sirius.Application.get_adapter().and_then(function(c){c.off(document,a,b,p.custom_event_name);p=null;return c.bind(document,a,b,f)})}};a.prototype.for_me=function(a,b,c){for(var d=[],e=2;e<arguments.length;++e)d[e-2]=arguments[e];return this.on.apply(this,[].concat([this.get_element(),a,b],$jscomp.arrayFromIterable(d)))};
a.prototype.get_attr=function(a){var b=this.get_element();return Sirius.Application.get_adapter().and_then(function(c){return c.get_attr(b,a)})};a.is_valid_strategy=function(a){return 0!==this._Strategies.filter(function(b){return b[0]===a}).length};a.prototype.bind=function(a,b){return this.pipe(a,b)};a.prototype.pipe=function(a,b){(new Sirius.Transformer(this,a)).run(b)};a.register_strategy=function(a,b){b=void 0===b?{}:b;var c=Sirius.Application.get_logger();c.info("View: Register new Strategy "+
a,c.view);var d=b.transform;var e=b.render;if(!Sirius.Utils.is_function(d))throw e="Strategy must be Function, but "+typeof d+" given.",c.error("View: "+e,c.view),Error(e);if(!Sirius.Utils.is_function(e))throw e="Strategy must be Function, but "+typeof e+" given.",c.error("View: "+e,c.view),Error(e);if(!Sirius.Utils.is_string(a))throw e="Strategy name must be String, but "+typeof a+" given.",c.error("View: "+e,c.view),Error(e);this._Strategies.push([a,d,e]);return null};a._Strategies=[];a._Cache=
[];var b=function(a,b,c){this.selector=a;this.event_name=b;this.custom_event_name=c};b.prototype.eq=function(a){return this.selector===a.selector&&this.event_name===a.event_name&&this.custom_event_name.toString===a.custom_event_name.toString};var c=b;return a}.call(this);
Sirius.View.register_strategy("swap",{transform:function(a,b){return""+b},render:function(a,b,c,d){return"text"===d?a.swap(b,c):"checked"===d?(c=Sirius.Utils.is_string(c)?"true"===c?!0:!1:!!c,a.set_prop(b,"checked",c)):a.set_attr(b,d,c)}});
Sirius.View.register_strategy("append",{transform:function(a,b){return b},render:function(a,b,c,d){var e=a.get_attr(b,"tagName");if("INPUT"===e||"TEXTAREA"===e||"SELECT"===e)throw Error("'append' strategy not work for `input` or `textarea` or `select` elements");if("text"===d)return a.append(b,c);throw Error("Strategy 'append' only work for 'text' content, not for '"+d+"'");}});
Sirius.View.register_strategy("prepend",{transform:function(a,b){return b},render:function(a,b,c,d){var e=a.get_attr(b,"tagName");if("INPUT"===e||"TEXTAREA"===e||"SELECT"===e)throw Error("'prepend' strategy not work for `input` or `textarea` or `select` elements");if("text"===d)return a.prepend(b,c);throw Error("Strategy 'prepend' only work for 'text' content, not for '"+d+"'");}});Sirius.View.register_strategy("clear",{transform:function(a,b){return""},render:function(a,b,c,d){return a.clear(b)}});
var lib$sirius$classdecl$var15=function(a,b,c){this.main=a;this.fields=b;this.fn=void 0===c?null:c;this._count=this.fields.length;this._values=[]};lib$sirius$classdecl$var15.prototype.get_fields=function(){return this.fields};lib$sirius$classdecl$var15.prototype.complete=function(a,b){var c={};c[a]=b;return-1===this._values.map(function(a){return Object.keys(a)[0]}).indexOf(a)?(this._values.push(c),this.is_full()?this._result():null):null};lib$sirius$classdecl$var15.prototype.field_name=function(){return this.main};
lib$sirius$classdecl$var15.prototype.remove=function(a){return delete this._values[a]};lib$sirius$classdecl$var15.prototype._result=function(){var a=this._values;var b=this.fields.map(function(b){return a.filter(function(a){return a[b]})[0][b]});return null===this.fn?b.join(" "):this.fn.apply(null,b)};lib$sirius$classdecl$var15.prototype.is_full=function(){return this._values.length===this._count};ComputedField=lib$sirius$classdecl$var15;
Sirius.BaseModel=function(){var a=function(a){a=void 0===a?{}:a;var b,d,e,f;(b=this.constructor.prototype)._cmp||(b._cmp=[]);(d=this.constructor.prototype)._cmp_fields||(d._cmp_fields=[]);this._listeners=[];this.logger=Sirius.Application.get_logger();this.errors={};this.attributes=this.normalize_attrs();var g=this.constructor.name;this.errors={};this._is_valid_attr={};d=this.attrs();var h=0;for(e=d.length;h<e;h++)if(b=d[h],this.logger.info("define '"+JSON.stringify(b)+"' attribute for '"+g+"'",this.logger.base_model),
Sirius.Utils.is_object(b)){var k=Object.keys(b);k=k[0];if(!k)throw this.logger.error("Attributes should have a key and value",this.logger.base_model),Error("Attributes should have a key and value");this["_"+k]=b[k];this._gen_method_name_for_attribute(k)}else this._gen_method_name_for_attribute(b),this["_"+b]=null;var l=this.constructor.skip;d=this.attributes;if(0!==Object.keys(a).length){var q=Object.keys(a);e=0;for(h=q.length;e<h;e++)b=q[e],-1===d.indexOf(b)&&l||(this._attribute_present(b),g=this["_"+
b],this["_"+b]=a[b],this._call_callbacks(b,a[b],g))}d=this.guid_for();h=0;for(b=d.length;h<b;h++)a=d[h],this.logger.debug("Generate guid for '"+this._klass_name()+"."+a+"'",this.logger.base_model),this.set(a,this._generate_guid());this._registered_validators=this.constructor._Validators;this._registered_validators_keys=this._registered_validators.map(function(a){return a[0]});a=this._model_validators=this.validators();for(k in a)for(f in b=a[k],this.errors[k]={},this._is_valid_attr[k]=!1,b)if(-1===
this._registered_validators_keys.indexOf(f)&&"validate_with"!==f)throw Error("Unregistered validator: "+f);this.after_create()};a.comp=function(a){for(var b=[],d=0;d<arguments.length;++d)b[d-0]=arguments[d];var e=this,f,g,h,k;(f=this.prototype)._cmp||(f._cmp=[]);(g=this.prototype)._cmp_fields||(g._cmp_fields=[]);(h=this.prototype)._cmp_refs||(h._cmp_refs={});if(0===b.length)throw new Exception("Compute field is empty");if(2===b.length)throw new Exception('Define compute field like: \'@comp("default_computed_field", "first_name", "last_name")\'');
var l=b[0];d=b.length;f=$jscomp.makeIterator(Sirius.Utils.is_function(b[d-1])?(k=b[d-1],[b.slice(1,d-1),b.slice(1,d-1),k]):[b.slice(1),b.slice(1),null]);b=f.next().value;d=f.next().value;k=f.next().value;f=[l].concat(b);if(f.filter(function(a,b,c){return c.indexOf(a)===b}).length!==f.length)throw Error("Seems your calculated fields are not unique: ["+f+"]");var q=this.attrs.concat(this.prototype._cmp_fields);b.forEach(function(a){if(-1===q.indexOf(a))throw Error("Field is '"+a+"' not found, for '"+
l+"'");});if(0<this.prototype._cmp_fields.length&&(f=b.filter(function(a){return e.prototype._cmp_refs[a]&&-1!==e.prototype._cmp_refs[a].indexOf(l)}),0<f.length))throw Error("Cyclic references detected in '"+l+"' field");Sirius.Application.get_logger().info("Define compute field '"+l+"' <- '["+b+"]'",Sirius.Application.get_logger().base_model);this.prototype._cmp_refs[l]=b;this.prototype._cmp_fields.push(l);return this.prototype._cmp.push(new ComputedField(l,d,k))};a.prototype.attrs=function(){return(this.constructor.attrs||
[]).concat(this.constructor.prototype._cmp_fields)};a.prototype.normal_name=function(){return Sirius.Utils.underscore(this.constructor.name)};a.prototype._klass_name=function(){return this.constructor.name};a.prototype.validators=function(){return this.constructor.validate};a.prototype.guid_for=function(){var a;if(a=this.constructor.guid_for){if(Sirius.Utils.is_string(a))return[a];if(Sirius.Utils.is_array(a))return a;throw Error("'@guid_for' must be array of string, but "+typeof a+" given");}return[]};
a.prototype._compute=function(a,c){var b=this;return this.constructor.prototype._cmp.forEach(function(d){if(-1!==d.get_fields().indexOf(a)){var e=d.complete(a,c);if(d.is_full())return b._set(d.field_name(),e)}})};a.prototype.normalize_attrs=function(){var a;var c=this.attrs();var d=[];var e=0;for(a=c.length;e<a;e++){var f=c[e];d.push(function(a){return Sirius.Utils.is_object(a)?Object.keys(a)[0]:a}(f))}return d};a.prototype._gen_method_name_for_attribute=function(a){var b=this;var d=Sirius.Utils.underscore(a);
if(-1!==Object.keys(this).indexOf(d))throw Error("Method "+d+" already exist");return this[d]=function(c){return null!=c?b.set(a,c):b.get(a)}};a.prototype._generate_guid=function(){var a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return""+a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()};a.prototype.get_attributes=function(){return this.attributes};a.prototype._is_computed_attribute=function(a){return-1!==this.constructor.prototype._cmp_fields.indexOf(a)?!0:!1};
a.prototype._attribute_present=function(a){if(-1===this.attributes.indexOf(a))throw Error("Attribute '"+a+"' not found for "+this._klass_name()+" model");};a.prototype._call_callbacks=function(a,c,d){var b;var f=this._listeners;var g=0;for(b=f.length;g<b;g++){var h=f[g];h.apply(null,[a,c])}return this.after_update(a,c,d)};a.prototype._call_callbacks_for_errors=function(a,c,d){var b;a="errors."+a+"."+c;var f=this._listeners;var g=[];var h=0;for(b=f.length;h<b;h++)c=f[h],g.push(c.apply(null,[a,d]));
return g};a.prototype.set=function(a,c){if(this._is_computed_attribute(a))throw Error("Impossible set computed attribute "+a+" for "+this._klass_name());return this._set(a,c)};a.prototype._set=function(a,c){this._attribute_present(a);var b=this["_"+a];this["_"+a]=c;this.logger.debug("["+this.constructor.name+"] set: 'attr' to '"+c+"'",this.logger.base_model);this.validate(a);this._compute(a,c);return this._call_callbacks(a,c,b)};a.prototype.get=function(a){this._attribute_present(a);return this["_"+
a]};a.prototype.reset=function(a){for(var b=[],d=0;d<arguments.length;++d)b[d-0]=arguments[d];var e,d=this.attributes;this.logger.debug("Reset attributes: '"+b+"' for "+this._klass_name());var f=0;for(e=b.length;f<e;f++){var g=b[f];if(-1===d.indexOf(g))throw Error("Attribute '"+g+"' not found for "+this._klass_name()+" model");g="_"+g;"number"===typeof this[g]&&(this[g]=0);Sirius.Utils.is_string(this[g])&&(this[g]="");Sirius.Utils.is_array(this[g])&&(this[g]=[]);null!=this.errors[g]&&(this.errors[g]=
{})}};a.prototype.is_valid=function(){var a=this;return 0===Object.keys(this._is_valid_attr).filter(function(b){return!a._is_valid_attr[b]}).length};a.prototype.validate=function(a){a=void 0===a?null:a;var b=this;var d=this._klass_name();var e=this.logger;var f=this.logger.base_model;Object.keys(this._model_validators||{}).filter(function(b){return null!=a?b===a:!0}).map(function(a){var c,g;var l=b.get(a);var q=b._model_validators[a];var r=[];for(c in q){var p=q[c];var n="validate_with"===c?(g=new Sirius.Validator,
g.validate=p,g.msg=null,g):(g=b._registered_validators.filter(function(a){return a[0]===c})[0][1],new g);p=n.validate(l,p);e.debug("Validate: '"+d+"."+a+" = "+l+"' with '"+c+"' validator, valid?: '"+p+"'",f);n=p?(delete b.errors[a][c],b._is_valid_attr[a]=!0,""):(b.errors[a][c]=n.error_message(),b._is_valid_attr[a]=!1,n.error_message());r.push(b._call_callbacks_for_errors(a,c,n))}return r})};a.prototype.get_errors=function(a){a=void 0===a?null:a;var b;if(-1===this.attributes.indexOf(a)&&null!==a)throw Error("Attribute '"+
a+"' not found for "+this._klass_name()+" model");if(null!=a){var d=[];a=this.errors[a];for(b in a){var e=a[b];""!==e&&d.push(e)}return d}return this.errors};a.prototype.set_error=function(a,c){var b=a.split(".");if(2!==b.length)throw Error("Error must be pass as 'attr.validator' like 'name.length'");var e=$jscomp.makeIterator(b);b=e.next().value;e=e.next().value;this.errors[b][e]=c;this._is_valid_attr[b]=!1;return this._call_callbacks_for_errors(b,e,c)};a.prototype.save=function(){this.validate();
return this.is_valid()?!1:!0};a.prototype.to_json=function(a){for(var b=[],d=0;d<arguments.length;++d)b[d-0]=arguments[d];return JSON.stringify(this.to_object.apply(this,[].concat($jscomp.arrayFromIterable(b))))};a.prototype.to_object=function(a){for(var b=[],d=0;d<arguments.length;++d)b[d-0]=arguments[d];var e;var f={};var g=this.attributes;var h=0;for(e=g.length;h<e;h++)if(d=g[h],-1===b.indexOf(d)){var k=this.get(d);f[d]=k}return f};a.from_json=function(a){var b;var d=new this;a=JSON.parse(a);var e=
[].concat(d.attrs());var f=0;for(b=e.length;f<b;f++){var g=e[f];if("object"===typeof g){var h=Object.keys(g);h=h[0];d.set(h,a[h]||g[h])}else h=a[g],d.set(g,h||d.get(g))}return d};a.prototype.compare=function(a){throw Error("`compare` method must be overridden");};a.prototype.after_create=function(){};a.prototype.after_update=function(a,c,d){};a.prototype.clone=function(){return this.constructor.from_json(this.to_json())};a.prototype._register_state_listener=function(a){var b;this.logger.debug("Register new listener for "+
this.constructor.name,this.logger.base_model);this._listeners.push(a);var d=this.get_attributes();var e=[];var f=0;for(b=d.length;f<b;f++){var g=d[f];null!==this["_"+g]?e.push(a.apply(null,[g,this["_"+g]])):e.push(void 0)}return e};a.prototype.pipe=function(a,c){c=void 0===c?{}:c;(new Sirius.Transformer(this,a)).run(c)};a.prototype.bind=function(a,c){c=void 0===c?{}:c;return this.pipe(a,c)};a.register_validator=function(a,c){var b=Sirius.Application.get_logger();b.info("register validator: "+a,b.base_model);
this._Validators.push([a,c]);return null};a._Validators=[];a.attrs=[];a.skip=!1;a.guid_for=null;a.validate={};a.prototype.__name="BaseModel";return a}.call(this);Sirius.BaseModel.register_validator("length",Sirius.LengthValidator);Sirius.BaseModel.register_validator("exclusion",Sirius.ExclusionValidator);Sirius.BaseModel.register_validator("inclusion",Sirius.InclusionValidator);Sirius.BaseModel.register_validator("format",Sirius.FormatValidator);
Sirius.BaseModel.register_validator("numericality",Sirius.NumericalityValidator);Sirius.BaseModel.register_validator("presence",Sirius.PresenceValidator);var lib$sirius$classdecl$var16=function(a,b,c){this._path=a;this._from=b;this._to=c;this.logger=Sirius.Application.get_logger();this._ln=this.logger.transformer;this._register()};lib$sirius$classdecl$var16.prototype._register=function(){};Sirius.Internal.AbstractTransformer=lib$sirius$classdecl$var16;
var lib$sirius$classdecl$var17=function(a){Sirius.Internal.AbstractTransformer.apply(this,arguments)};$jscomp.inherits(lib$sirius$classdecl$var17,Sirius.Internal.AbstractTransformer);
lib$sirius$classdecl$var17.prototype._register=function(){var a;if(this._from instanceof Sirius.BaseModel)return this._from._register_state_listener(this._to);this._from._register_state_listener(this);var b=this._fire_generator();var c=this._from.get_element();var d=this._path;var e=[];for(a in d)d=this._path.from||"text",e.push(new Sirius.Internal.Observer(c+" "+a,a,d,b));return e};
lib$sirius$classdecl$var17.prototype._fire_generator=function(){var a=this._from;var b=this._to;return function(c){return b(c,a)}};Sirius.Internal.ToFunctionTransformer=lib$sirius$classdecl$var17;var lib$sirius$classdecl$var18=function(a){Sirius.Internal.AbstractTransformer.apply(this,arguments)};$jscomp.inherits(lib$sirius$classdecl$var18,Sirius.Internal.AbstractTransformer);
lib$sirius$classdecl$var18.prototype._register=function(){var a;var b=this._fire_generator();if(this._from instanceof Sirius.View){var c=this._from.get_element();var d=this._path.to;var e=[];var f=0;for(a=d.length;f<a;f++){var g=d[f];var h=$jscomp.makeIterator(Sirius.Utils.is_string(g)?[null,"text",g]:[g.from||c,g.attribute||"text",g.selector]);var k=h.next().value;g=h.next().value;h=h.next().value;c=c===k?c:null!=k?c+" "+k:c;this.logger.debug("Observe '"+c+"' -> '"+this._to.get_element()+" "+h+"'",
this._ln);e.push(new Sirius.Internal.Observer(c,k,g,b))}return e}return this._from._register_state_listener(b)};lib$sirius$classdecl$var18._default_via_method=function(){return function(a,b,c,d){d=void 0===d?"text":d;return c.zoom(b).render(a).swap(d)}};
lib$sirius$classdecl$var18.prototype._fire_generator=function(){var a=this._to;var b=this._path;var c=this.logger;var d=this._ln;if(this._from instanceof Sirius.View)var e=function(c){var d;var e=b.to;var f=c.text;var g=[];var r=0;for(d=e.length;r<d;r++){var p=e[r];if(Sirius.Utils.is_string(p)){var n=Sirius.Internal.ToViewTransformer._default_via_method();g.push(n(f,p,a,attribute))}else{var m=p.selector;c=p.attribute||"text";n=p.via||Sirius.Internal.ToViewTransformer._default_via_method();g.push(n(f,
m,a,c))}}return g};else{var f=this._from;e=function(e,h){var g;if(g=b[e]){c.debug("Apply new value for '"+e+"' for '"+a.get_element()+"', value: "+h+" from "+f._klass_name(),d);var l=g.to;var q=g.attr||"text";g=g.via||Sirius.Internal.ToViewTransformer._default_via_method();return g(h,l,a,q)}}}return e};Sirius.Internal.ToViewTransformer=lib$sirius$classdecl$var18;var lib$sirius$classdecl$var19=function(a){Sirius.Internal.AbstractTransformer.apply(this,arguments)};
$jscomp.inherits(lib$sirius$classdecl$var19,Sirius.Internal.AbstractTransformer);lib$sirius$classdecl$var19.prototype._register=function(){var a;this._from._register_state_listener(this);var b=this._fire_generator();var c=this._from.get_element();var d=this._path;var e=[];for(a in d)d=this._path.from||"text",e.push(new Sirius.Internal.Observer(c+" "+a,a,d,b));return e};lib$sirius$classdecl$var19.prototype._default_via_method=function(){return function(a){return a}};
lib$sirius$classdecl$var19.prototype._fire_generator=function(){var a=this._from;var b=this._path;var c=this._to;var d=this.logger;var e=this._ln;return function(f){var g;if(g=b[f.original]){var h=g.to;var k=g.from||"text";g=g.via||function(a){return a};d.debug("Apply new value from "+f.from+" ("+f.original+") to "+c._klass_name()+"."+h,e);return c.set(h,g(f.text,a,f.original,k,f.element))}}};Sirius.Internal.ToModelTransformer=lib$sirius$classdecl$var19;
Sirius.Transformer=function(){var a=function(a,c){this.logger=Sirius.Application.get_logger();this.ln=this.logger.transformer;if(a instanceof Sirius.BaseModel)this._from=a;else if(a instanceof Sirius.View)this._from=a;else throw Error("Bad argument for Transformer, Model or View required, given "+a);if(c instanceof Sirius.BaseModel){if(this._from instanceof Sirius.BaseModel)throw Error("Impossible bind model and model");this._to=c}else if(c instanceof Sirius.View)this._to=c;else if(Sirius.Utils.is_function(c))this._to=
c;else throw Error("Bind works only with BaseModel, BaseView or Function, given: "+c);};a.prototype.run=function(a){var b;if(this._from&&this._to){if(this._from instanceof Sirius.BaseModel)for(g in a){var d=a[g];if(-1===this._from.get_attributes().indexOf(g)){var e=this._from._klass_name();var f=this._from.get_attributes();f="Attribute '"+g+"' not found in model attributes: '"+e+"', available: ["+f+"]";-1!==g.indexOf(".")?0===g.lastIndexOf("errors")?(f=g.split("."),3!==f.length&&this.logger.warn("Try to bind '"+
g+"' from errors, but validator was not found, correct definition like 'errors.id.numericality'",this.ln),this.logger.debug("bind: "+e+"."+g+" -> "+d.to,this.ln)):this.logger.warn(f,this.ln):this.logger.warn(f,this.ln)}}if(this._to instanceof Sirius.BaseModel)for(g in e=this._to._klass_name(),a)if(d=a[g],d=d.to)f=this._to.get_attributes(),-1===f.indexOf(d)?this.logger.warn("Attribute '"+d+"' not found in model attributes: '"+e+"', available: ["+f+"]",this.ln):this.logger.debug("bind: '"+g+"' -> '"+
e+"."+d+"'",this.ln);else throw a=JSON.stringify(a),Error("Impossible create transformer for "+e+", because in object: "+a+", 'to' key not defined");if(this._from instanceof Sirius.View&&this._to instanceof Sirius.View){e=this._from.get_element();var g=this._to.get_element();if(b=a.to)if(Sirius.Utils.is_array(b)){d=0;for(f=b.length;d<f;d++){var h=b[d];if(h.selector)h=h.selector,this.logger.debug("bind: '"+e+"' -> '"+g+" "+h+"'",this.ln);else throw Error('You define binding with \'to\' as array of objects, but \'selector\' property was not found. Correct definition: {to: [{"selector": "#my-id", "attribute": "data-attr"}]}');
}this._path=a}else if(Sirius.Utils.is_string(b))this.logger.debug("bind: '"+e+"' -> '"+g+" "+b+"'"),a.to=[b],this._path=a;else throw Error("For binding 'to' must be array or string, but "+typeof b+" given");else throw Error("Define View to View binding with: 'view1.bind(view2, {\"to\": \"selector\"})', but 'to' key not found");}else{if(this._from instanceof Sirius.View&&Sirius.Utils.is_function(this._to)){e=this._from.get_element();if(0===Object.keys(a).length)throw Error("Binding with empty object forbidden");
for(g in a)if(d=a[g],d.from)d=d.from,this.logger.debug("bind: '"+e+" "+g+"' (from '"+d+"') -> function",this.ln);else throw Error('For binding View and Function, you need to define object like: {"selector": {"from": "text"}}');}this._path=a}if(this._to instanceof Sirius.BaseModel)return new Sirius.Internal.ToModelTransformer(a,this._from,this._to);if(this._to instanceof Sirius.View)return new Sirius.Internal.ToViewTransformer(a,this._from,this._to);if(Sirius.Utils.is_function(this._to))return new Sirius.Internal.ToFunctionTransformer(a,
this._from,this._to)}else throw Error("Not all parameters defined for transformer: from: "+this._from+", to: "+this._to);};a.draw=function(a){var b=Sirius.Application.get_logger();b.debug("Draw Transformer",b.transformer);return a};a._Model=0;a._View=1;a._Function=2;a.prototype._from=null;a.prototype._to=null;a.prototype._path=null;return a}.call(this);
Sirius.Collection=function(){var a=function(a,c){c=void 0===c?{}:c;var b=this,e;if(!(a.prototype instanceof Sirius.BaseModel))throw Error("Collection must be used only with `BaseModel` inheritor");this._array=[];this.logger=Sirius.Application.get_logger();this._klass=a;this._type=a.name;this._indexes=c.index||[];if(0<this._indexes.length){var f=a.prototype.attrs().map(function(a){return Sirius.Utils.is_object(a)?Object.keys(a)[0]:a});this._indexes.forEach(function(a){if(-1===f.indexOf(a))throw Error("Collection: field "+
a+" from indexes: ["+this._indexes+"] not exist in "+this._type);});this._indexes.forEach(function(a){b.logger.debug("create index for "+a+" field in "+b._type,b.logger.collection);return b["index_"+a]={}})}this._subscribers={};var g=this.constructor._EVENTS;var h=0;for(e=g.length;h<e;h++){var k=g[h];this._subscribers[k]=[]}this.length=0};a.prototype.push=function(a){return this.add(a)};a.prototype.add=function(a){this._add(a)};a.prototype._add=function(a){var b=this;var d=a.name;if(null!=a.constructor){if(this._type!==
a.constructor.name)throw d="Require `"+this._type+"`, but given `"+d+"`",this.logger.error("Collection: "+d,this.logger.collection),Error(d);}else throw d="Seems "+a+" is not instance of "+this._type+".",this.logger.error(d),Error(d);this._array.push(a);0<this._indexes.length&&this._indexes.forEach(function(c){return b["index_"+c][a.get(c)]=b.length});this.length++;return this._gen("add",a)};a.prototype.remove=function(a){var b=this;var d=this.index(a);null!==d&&(this._array.splice(d,1),this._gen("remove",
a),this.length--,0<this._indexes.length&&this._indexes.forEach(function(c){delete b["index_"+c][a.get(c)];return Object.keys(b["index_"+c]).filter(function(a){return b["index_"+c][a]>d}).map(function(a){return--b["index_"+c][a]})}))};a.prototype.index=function(a){var b,d;var e=null;var f=this._array;var g=b=0;for(d=f.length;b<d;g=++b){var h=f[g];h.compare(a)&&(e=g)}return e};a.prototype.find=function(a,c){return this.find_all(a,c)[0]||null};a.prototype.find_all=function(a,c){var b;if(0<this._indexes.length&&
-1!==this._indexes.indexOf(a))return[this._array[this["index_"+a][c]]];var e=this._array;var f=[];var g=0;for(b=e.length;g<b;g++){var h=e[g];h.get(a)===c&&f.push(h)}return f};a.prototype.filter=function(a){a=void 0===a?function(){}:a;var b;var d=this._array;var e=[];var f=0;for(b=d.length;f<b;f++){var g=d[f];a.call(null,g)&&e.push(g)}return e};a.prototype.each=function(a){a=void 0===a?function(){}:a;var b;var d=this._array;var e=[];var f=0;for(b=d.length;f<b;f++){var g=d[f];e.push(a.call(g))}return e};
a.prototype.first=function(){return this._array[0]};a.prototype.last=function(){return this._array[this._array.length-1]};a.prototype.all=function(){return this._array};a.prototype.clear=function(){var a=this;this.length=0;this._array=[];if(0<this._indexes.length)return this._indexes.forEach(function(b){return a["index_"+b]={}})};a.prototype.map=function(a){return this.collect(a)};a.prototype.collect=function(a){return this._array.map(a)};a.prototype.takeFirst=function(a){var b;var d=null;var e=this._array;
var f=0;for(b=e.length;f<b;f++){var g=e[f];if(a(g)){d=g;break}}return d};a.prototype.size=function(){return this._array.length};a.prototype.to_json=function(){var a;var c=this._array;var d=[];var e=0;for(a=c.length;e<a;e++){var f=c[e];d.push(f.to_object())}return JSON.stringify(d)};a.prototype.subscribe=function(a,c){if(-1===this.constructor._EVENTS.indexOf(a))throw Error("For 'subscribe' method available only ["+this.constructor._EVENTS+"], but given '"+a+"'");if(Sirius.Utils.is_string(c)||Sirius.Utils.is_function(c))this.logger.info("Collection: Add new subscriber for '"+
a+"' event",this.logger.collection),this._subscribers[a].push(c);else throw Error("Second parameter for 'subscribe' method must be Function or String, but '"+typeof c+"' given");};a.prototype._gen=function(a,c){for(var b=[],e=1;e<arguments.length;++e)b[e-1]=arguments[e];var f=this._subscribers[a];return Sirius.Application.get_adapter().and_then(function(a){var c;var d=[];var e=0;for(c=f.length;e<c;e++){var g=f[e];Sirius.Utils.is_string(g)?d.push(a.fire.apply(a,[].concat([document,g],$jscomp.arrayFromIterable(b)))):
d.push(g.apply(null,b))}return d})};a._EVENTS=["add","remove"];return a}.call(this);
