/*!
 *  Sirius.js v0.5.1
 *  (c) 2014 fntzr
 *  license: MIT
 */
;var Sirius,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};Sirius={VERSION:"0.5.1"};Sirius.redirect=function(url){var app,origin;app=Sirius.Application;if(url.indexOf("#")===0){if(app.hash_always_on_top&&app.push_state_support){origin=window.location.origin;return history.replaceState({href:url},""+url,""+origin+"/"+url)}}else{if(app.push_state_support){return history.pushState({href:url},""+url,url)}}};Sirius.RoutePart=(function(){function RoutePart(route){var parts;this.end=true;this.start=null;this.parts=[];this.args=[];parts=route.replace(/\/$/,"").split("/");if(parts[0]===""){parts[0]="#"}if(parts[parts.length-1]==="*"){this.end=false}this.parts=parts.slice(0)}RoutePart.prototype.match=function(url){var args,cp,gp,i,is_end_part,is_named_part,is_regexp_part,parts,r,_ref;this.args=[];parts=url.replace(/\/$/,"").split("/");if(parts[0]===""){parts[0]="#"}if((parts.length!==this.parts.length)&&this.end){return false}if((this.parts.length>1)&&parts.length<this.parts.length){return false}is_named_part=function(part){return part.indexOf(":")===0};is_regexp_part=function(part){return part.indexOf("[")===0};is_end_part=function(part){return part.indexOf("*")===0};i=-1;args=[];while(i<10){i++;_ref=[this.parts[i],parts[i]],cp=_ref[0],gp=_ref[1];if(!cp||!gp){break}if(is_named_part(cp)){args.push(parts[i]);continue}if(is_regexp_part(cp)){r=new RegExp("^"+cp+"$");if(!r.test(gp)){return false}args.push(r.exec(gp)[0]);continue}if(is_end_part(cp)){args=args.concat(parts.slice(i));break}if(cp!==gp){return false}}this.args=args;return true};return RoutePart})();Sirius.ControlFlow=(function(){function ControlFlow(params,wrapper){var act,action,controller,extract;if(wrapper==null){wrapper=function(x){return x}}controller=params.controller||(function(){throw new Error("Params must contain a Controller")})();act=params.action;action=(function(){if(Sirius.Utils.is_string(act)){return controller[act]}else{if(Sirius.Utils.is_function(act)){return act}else{throw new Error("Action must be string or function")}}})();if(!action){throw new Error("action "+act+" not found in controller "+controller)}this.action=wrapper(action);extract=(function(_this){return function(property,is_guard){var err,k,p,t;if(is_guard==null){is_guard=false}p=params[property];k=controller[""+property+"_"+act];err=function(a){return new Error(""+a+" action must be string or function")};if(Sirius.Utils.is_string(p)){t=controller[p];if(!Sirius.Utils.is_function(t)){throw err(Sirius.Utils.camelize(property))}return t}else{if(Sirius.Utils.is_function(p)){return p}else{if(p){throw err(Sirius.Utils.camelize(property))}else{if(k){if(!Sirius.Utils.is_function(k)){throw err(Sirius.Utils.camelize(property))}return k}else{if(!is_guard){return function(){}}else{return null}}}}}}})(this);this.before=extract("before");this.after=extract("after");this.guard=extract("guard",true);this.data=params.data||null}ControlFlow.prototype.handle_event=function(){var args,data,e,merge,_ref;e=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];if(e){data=Sirius.Utils.is_array(this.data)?this.data:this.data?[this.data]:[];data=Sirius.Application.adapter.get_property(e,data);merge=[].concat([],[e],data);merge=(_ref=[]).concat.apply(_ref,[[],merge].concat(__slice.call(args)));if(this.guard){if(this.guard.apply(null,merge)){this.before();this.action.apply(null,merge);return this.after()}}else{this.before();this.action.apply(null,merge);return this.after()}}else{args=[].concat.apply([],args);if(this.guard){if(this.guard.apply(null,args)){this.before();this.action.apply(null,args);return this.after()}}else{this.before();this.action.apply(null,args);return this.after()}}};return ControlFlow})();Sirius.RouteSystem={_selector:"a:not([href^='#'])",_hash_route:function(url){return url.toString().indexOf("#")===0},_404_route:function(url){return url.toString()==="404"},_plain_route:function(url){return url.toString().indexOf("/")===0},_event_route:function(url){return !this._hash_route(url)&&!this._404_route(url)&&!this._plain_route(url)},create:function(routes,setting,fn){var action,adapter,array_of_routes,current,dispatcher,hash_on_top,href,link,links,new_href,plain_routes,prev,push_state_support,redirect_to_hash,route,url,urls,wrapper,_i,_len;if(fn==null){fn=function(){}}current=prev=window.location.hash;hash_on_top=setting.top;redirect_to_hash=setting.old;push_state_support=setting.support;if(redirect_to_hash&&!push_state_support){Sirius.Application.logger("Convert plain routing into hash routing");urls=[];route={};for(url in routes){action=routes[url];if(this._hash_route(url)){urls.push(url)}if(this._plain_route(url)){url="#"+url;if(urls.indexOf(url)!==-1){Sirius.Application.logger("Warning! Routes already have '"+url+"' url")}}route[url]=action}routes=route}adapter=Sirius.Application.adapter;wrapper=function(fn){var key,value,_ref;_ref=Sirius.Application.controller_wrapper;for(key in _ref){value=_ref[key];this[key]=value}return fn};for(url in routes){action=routes[url];if(this._event_route(url)){(function(url,action){var event_name,handler,selector,z;handler=Sirius.Utils.is_function(action)?wrapper(action):function(){var e,params;e=arguments[0],params=2<=arguments.length?__slice.call(arguments,1):[];return(new Sirius.ControlFlow(action,wrapper)).handle_event(e,params)};z=url.match(/^([a-zA-Z:]+)(\s+)?(.*)?/);event_name=z[1];selector=z[3]||document;return adapter.bind(document,selector,event_name,handler)})(url,action)}}array_of_routes=(function(){var _results;_results=[];for(url in routes){action=routes[url];if(!(this._hash_route(url))){continue}url=new Sirius.RoutePart(url);action=Sirius.Utils.is_function(action)?wrapper(action):new Sirius.ControlFlow(action,wrapper);_results.push([url,action])}return _results}).call(this);plain_routes=(function(){var _results;_results=[];for(url in routes){action=routes[url];if(!(this._plain_route(url))){continue}url=new Sirius.RoutePart(url);action=Sirius.Utils.is_function(action)?wrapper(action):new Sirius.ControlFlow(action,wrapper);_results.push([url,action])}return _results}).call(this);dispatcher=function(e){var f,flow,href,origin,part,pathname,r,r404,result,route_array,_i,_len;prev=current;route_array=null;result=false;if(e.type==="hashchange"){route_array=array_of_routes;current=window.location.hash;if(hash_on_top&&push_state_support){origin=window.location.origin;history.replaceState({href:current},""+current,""+origin+"/"+current)}}else{route_array=plain_routes;href=e.target.href;if(push_state_support){history.pushState({href:href},""+href,href)}pathname=window.location.pathname;if(pathname===""){pathname="/"}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}current=pathname}Sirius.Application.logger("Url change to: "+current);adapter.fire(document,"application:urlchange",current,prev);for(_i=0,_len=route_array.length;_i<_len;_i++){part=route_array[_i];f=part[0];r=f.match(current);if(r&&!result){result=true;flow=part[1];if(flow.handle_event){flow.handle_event(null,f.args)}else{flow.apply(null,f.args)}return}}if(!result){adapter.fire(document,"application:404",current,prev);r404=routes["404"]||routes[404];if(r404){if(Sirius.Utils.is_function(r404)){wrapper(r404)(current)}else{(new Sirius.ControlFlow(r404,wrapper)).handle_event(null,current)}}}return false};if(redirect_to_hash&&!push_state_support){links=adapter.all(this._selector);Sirius.Application.logger("Found "+links.length+" link. Convert href into hash based routing");for(_i=0,_len=links.length;_i<_len;_i++){link=links[_i];href=link.getAttribute("href");new_href=href.indexOf("/")===0?"#"+href:"#/"+href;Sirius.Application.logger("Convert '"+href+"' -> '"+new_href+"'");link.setAttribute("href",new_href)}}if(plain_routes.length!==0){adapter.bind(document,this._selector,"click",dispatcher)}window.onhashchange=dispatcher;if(push_state_support){adapter.bind(window,null,"popstate",function(e){if(history&&history.state&&(history.state===null||history.state.href.indexOf("#")!==0)){return dispatcher(e)}})}return fn()}};Sirius.Application={log:false,adapter:null,running:false,route:{},start:false,controller_wrapper:{redirect:Sirius.redirect},hash_always_on_top:true,use_hash_routing_for_old_browsers:true,logger:function(msg){if(!this.log){return}if(console&&console.log){return console.log(msg)}else{return alert("Not supported `console`. You should define own `logger` function for Sirius.Application")}},run:function(options){var key,setting,value,_ref;if(options==null){options={}}this.running=true;this.log=options.log||this.log;this.adapter=options.adapter||(function(){throw new Error("Specify adapter")})();this.route=options.route||this.route;this.logger=options.logger||this.logger;this.start=options.start||this.start;_ref=options.controller_wrapper||{};for(key in _ref){value=_ref[key];this.controller_wrapper[key]=value}this.hash_always_on_top=options.hash_always_on_top!=null?options.hash_always_on_top:this.hash_always_on_top;this.use_hash_routing_for_old_browsers=options.use_hash_routing_for_old_browsers!=null?options.use_hash_routing_for_old_browsers:this.use_hash_routing_for_old_browsers;this.logger("Logger enabled? "+this.log);this.logger("Adapter: "+(this.adapter.__name()));this.logger("Hash always on top: "+this.hash_always_on_top);this.logger("Use hash routing for old browsers: "+this.use_hash_routing_for_old_browsers);this.logger("Current browser: "+navigator.userAgent);this.push_state_support=history.pushState?true:false;this.logger("History pushState support: "+this.push_state_support);if(!this.push_state_support&&this.use_hash_routing_for_old_browsers){this.logger("Warning! You browser not support pushState, and you disable hash routing for old browser")}setting={old:this.use_hash_routing_for_old_browsers,top:this.hash_always_on_top,support:this.push_state_support};Sirius.RouteSystem.create(this.route,setting,(function(_this){return function(){return _this.adapter.fire(document,"application:run",new Date())}})(this));if(this.start){return Sirius.redirect(this.start)}}};Sirius.Observer=(function(){var MO,ONCHANGE_TAGS;Observer._observers=[];Observer.add_observer=function(new_observer){return[]};MO=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver||null;ONCHANGE_TAGS=["INPUT","TEXTAREA","SELECT"];function Observer(from_element,clb){var adapter,cnf,current_value,elements,from,handler,logger,observer,tag,type;this.from_element=from_element;this.clb=clb!=null?clb:function(){};adapter=Sirius.Application.adapter;logger=Sirius.Application.logger;clb=this.clb;from=this.from_element;tag=adapter.get_attr(from,"tagName");type=adapter.get_attr(from,"type");current_value=null;handler=function(e){var attr_name,new_attr,old_attr,result,txt;result={text:null,attribute:null};if(["focusout","focusin"].indexOf(e.type)!==-1){return}txt=adapter.text(from);if(["input","selectionchange"].indexOf(e.type)!==-1&&txt===current_value){return}if(e.type==="input"||e.type==="childList"||e.type==="change"||e.type==="DOMNodeInserted"||e.type==="selectionchange"){result.text=txt;current_value=txt}if(e.type==="change"){result.state=adapter.get_state(from)}if(e.type==="attributes"){attr_name=e.attributeName;old_attr=e.oldValue||[];new_attr=adapter.get_attr(from,attr_name);result.text=new_attr;result.attribute=attr_name;result.previous=old_attr}if(e.type==="DOMAttrModified"){attr_name=e.originalEvent.attrName;old_attr=e.originalEvent.prevValue;new_attr=adapter.get_attr(from,attr_name);result.text=new_attr;result.attribute=attr_name;result.previous=old_attr}return clb(result)};if(ONCHANGE_TAGS.indexOf(tag)!==-1){if(type==="checkbox"||type==="radio"){adapter.bind(document,this.from_element,"change",handler)}else{current_value=adapter.text(this.from_element);adapter.bind(document,this.from_element,"input",handler);if(Sirius.Utils.ie_version()===9){adapter.bind(document,document,"selectionchange",handler)}}}else{if(MO){observer=new MO(function(mutations){return mutations.forEach(handler)});cnf={childList:true,attributes:true,characterData:true,attributeOldValue:true,characterDataOldValue:true,subtree:false};if(Sirius.Utils.is_string(from)){elements=adapter.get(from);observer.observe(elements,cnf)}else{observer.observe(from,cnf)}}else{adapter.bind(document,this.from_element,"DOMNodeInserted",handler);adapter.bind(document,this.from_element,"DOMNodeRemoved",handler);adapter.bind(document,this.from_element,"DOMAttrModified",handler)}}}return Observer})();Sirius.BaseModel=(function(){BaseModel.attrs=[];BaseModel.has_many=[];BaseModel.has_one=[];BaseModel.belongs_to=[];BaseModel.guid_for=null;BaseModel.validate={};BaseModel.prototype.attrs=function(){return this.constructor.attrs||[]};BaseModel.prototype.__name="BaseModel";BaseModel.prototype.normal_name=function(){return Sirius.Utils.underscore(this.constructor.name)};BaseModel.prototype.has_many=function(){return this.constructor.has_many||[]};BaseModel.prototype.has_one=function(){return this.constructor.has_one||[]};BaseModel.prototype.belongs_to=function(){return this.constructor.belongs_to||[]};BaseModel.prototype.validators=function(){return this.constructor.validate};BaseModel.prototype.guid_for=function(){return this.constructor.guid_for};BaseModel.prototype.normalize_attrs=function(){var a,_i,_len,_ref,_results;_ref=this.constructor.attrs;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){a=_ref[_i];_results.push((function(a){if(typeof a==="object"){return Object.keys(a)[0]}else{return a}})(a))}return _results};function BaseModel(obj){var attr,g,key,klass,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2,_ref3,_ref4;if(obj==null){obj={}}this._isValid=false;this.callbacks=[];this.errors={};this.attributes=this.normalize_attrs();_ref=this.attrs();for(_i=0,_len=_ref.length;_i<_len;_i++){attr=_ref[_i];if(typeof attr==="object"){_ref1=Object.keys(attr),key=_ref1[0];if(!key){throw new Error("Attributes should have a key and value")}this["_"+key]=attr[key];this._gen_method_name_for_attribute(key)}else{this._gen_method_name_for_attribute(attr);this["_"+attr]=null}}_ref2=this.has_many();for(_j=0,_len1=_ref2.length;_j<_len1;_j++){klass=_ref2[_j];this["_"+klass]=[];this.attributes.push(""+klass);this._has_create(klass);this._gen_method_name_for_attribute(klass,true)}_ref3=this.has_one();for(_k=0,_len2=_ref3.length;_k<_len2;_k++){klass=_ref3[_k];this["_"+klass]=null;this.attributes.push(""+klass);this._has_create(klass,true);this._gen_method_name_for_attribute(klass,true)}if(Object.keys(obj).length!==0){_ref4=Object.keys(obj);for(_l=0,_len3=_ref4.length;_l<_len3;_l++){attr=_ref4[_l];this.set(attr,obj[attr])}}if(g=this.guid_for()){this.set(g,this._generate_guid())}this.after_create()||function(){}}BaseModel.prototype._gen_method_name_for_attribute=function(attribute,when_has_attribute){var normalize_name;if(when_has_attribute==null){when_has_attribute=false}normalize_name=Sirius.Utils.underscore(attribute);if(Object.keys(this).indexOf(normalize_name)!==-1){throw new Error("Method "+normalize_name+" already exist")}return this[normalize_name]=(function(_this){return function(value){if(value!=null){if(when_has_attribute){return _this["add_"+attribute](value)}else{return _this.set(attribute,value)}}else{return _this.get(attribute)}}})(this)};BaseModel.prototype._generate_guid=function(){var s4;s4=function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)};return""+(s4())+(s4())+"-"+(s4())+"-"+(s4())+"-"+(s4())+"-"+(s4())+(s4())+(s4())};BaseModel.prototype._has_create=function(klass,is_one){if(is_one==null){is_one=false}return this["add_"+klass]=(function(_this){return function(z){var b_model,back,expected,i,key,m_name,me,name;name=z.constructor.name;me=_this.normal_name();m_name=_this.constructor.name;expected=klass.charAt(0).toUpperCase()+klass.slice(1);if(name!==expected){throw new Error("Expected "+expected+", but given: "+name)}if(is_one){if(_this.get(""+klass)){throw new Error("Model "+expected+" already exist for "+m_name)}_this.set(""+klass,z)}else{_this.get(""+klass).push(z)}b_model=((function(){var _i,_len,_ref,_results;_ref=z.belongs_to();_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){i=_ref[_i];if(i.model===me){_results.push(i)}}return _results})())[0];if(!b_model){throw new Error("Model "+name+" must contain '@belongs_to: [{model: "+me+", back: "+me+"_id]'")}if(!(back=b_model.back)){throw new Error("Define 'back' property for @belongs_to")}if(_this.attributes.indexOf(back)===-1){throw new Error("Foreign key: '"+back+"' not contain in a '"+m_name+"' model")}key=(b_model.compose||function(model,back){return""+model+"_"+back})(me,back);if(z.attributes.indexOf(key)===-1){throw new Error("Define "+key+" in @attrs for '"+expected+"' model")}return z.set(""+key,_this.get(back))}})(this)};BaseModel.prototype.get_attributes=function(){return this.attributes};BaseModel.prototype.set=function(attr,value){var clb,_i,_len,_ref,_results;if(this.attributes.indexOf(attr)===-1){throw new Error("Attribute '"+attr+"' not found for "+(this.normal_name().toUpperCase())+" model")}this["_"+attr]=value;_ref=this.callbacks;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){clb=_ref[_i];_results.push(clb.apply(null,[attr,value]))}return _results};BaseModel.prototype.get=function(attr){if(this.attributes.indexOf(attr)===-1){throw new Error("Attribute '"+attr+"' not found for "+(this.normal_name().toUpperCase())+" model")}return this["_"+attr]};BaseModel.prototype.valid=function(){return this._isValid};BaseModel.prototype.validate=function(){var current_value,e,key,klass,r,v,validator,value,vv,z,_base,_name,_ref;this.errors={};vv=this.validators();for(key in vv){value=vv[key];current_value=this.get(key);for(validator in value){v=value[validator];klass=(function(){switch(validator){case"length":return new Sirius.LengthValidator();case"exclusion":return new Sirius.ExclusionValidator();case"inclusion":return new Sirius.InclusionValidator();case"format":return new Sirius.FormatValidator();case"numericality":return new Sirius.NumericalityValidator();case"presence":return new Sirius.PresenceValidator();case"validate_with":z=new Sirius.Validator();z.validate=v;z.msg=null;return z}})();r=klass.validate(current_value,v);if(!r){e=typeof v==="object"?v.error||klass.error_message():klass.error_message();((_base=this.errors)[_name=""+key]!=null?_base[_name]:_base[_name]=[]).push(""+e)}}}return this._isValid=(_ref=Object.keys(this.errors).length===0)!=null?_ref:{"true":false}};BaseModel.prototype.save=function(exception){var name;if(exception==null){exception=false}this.validate();name=this.constructor.name;if(exception&&!this._isValid){throw new Error(""+name+" model not valid!")}if(this._isValid){return false}return true};BaseModel.prototype.to_json=function(root){var attr,name,o,v,value,z,_i,_len,_ref;if(root==null){root=false}z={};_ref=this.attributes;for(_i=0,_len=_ref.length;_i<_len;_i++){attr=_ref[_i];value=this.get(""+attr);z[""+attr]=(function(){var _j,_len1,_results;if(this.has_many().indexOf(attr)>-1){_results=[];for(_j=0,_len1=value.length;_j<_len1;_j++){v=value[_j];_results.push(JSON.parse(v.to_json()))}return _results}else{if(this.has_one().indexOf(attr)>-1){return JSON.parse(value.to_json())}else{return value}}}).call(this)}if(root){o={};name=this.normal_name();o[name]=z;return JSON.stringify(o)}else{return JSON.stringify(z)}};BaseModel.from_json=function(json,models){var attr,attrs,key,m,model,value,z,_i,_len,_ref;if(models==null){models={}}m=new this;json=JSON.parse(json);attrs=[].concat(m.attrs(),m.has_many(),m.has_one());for(_i=0,_len=attrs.length;_i<_len;_i++){attr=attrs[_i];if(typeof attr==="object"){_ref=Object.keys(attr),key=_ref[0];m.set(key,json[key]||attr[key])}else{value=(function(){var _j,_len1,_ref1,_results;if(m.has_many().indexOf(attr)>-1){model=models[attr];if(model){_ref1=json[attr];_results=[];for(_j=0,_len1=_ref1.length;_j<_len1;_j++){z=_ref1[_j];_results.push(model.from_json(JSON.stringify(z),models))}return _results}else{return json[attr]}}else{if(m.has_one().indexOf(attr)>-1){model=models[attr];if(model){return model.from_json(JSON.stringify(json[attr]),models)}else{return json[attr]}}else{return json[attr]}}})();m.set(attr,value||m.get(attr))}}return m};BaseModel.prototype.compare=function(other){throw new Error("`compare` method must be overridden")};BaseModel.prototype.after_create=function(){};BaseModel.prototype.clone=function(){return this.constructor.from_json(this.to_json())};BaseModel.prototype.bind=function(view,object_setting){var adapter,bind_from,bind_to,callbacks,child,children,clb,count,current,elements,from,tmp,to,_i,_len;if(object_setting==null){object_setting={}}if(!(view.name&&view.name()==="View")){throw new Error("`bind` only work with Sirius.View")}to=object_setting.to||null;from=object_setting.from||null;callbacks=this.callbacks;adapter=Sirius.Application.adapter;current=view.element;children=adapter.all(""+current+" *");count=children.length;if(count===0){to=adapter.get_attr(view.element,"data-bind-view-to")||to||"text";from=adapter.get_attr(view.element,"data-bind-view-from")||from||this.attributes[0];clb=function(attr,value){if(attr===from){if(to==="text"){return view.render(value).swap()}else{return view.render(value).swap(to)}}};return callbacks.push(clb)}else{if(to||from){throw new Error("For element with children not use object setting")}elements=[];for(_i=0,_len=children.length;_i<_len;_i++){child=children[_i];if(!(adapter.get_attr(child,"data-bind-view-from"))){continue}bind_to=adapter.get_attr(child,"data-bind-view-to")||"text";bind_from=adapter.get_attr(child,"data-bind-view-from");tmp={to:bind_to,from:bind_from,element:child,view:new Sirius.View(child)};elements.push(tmp)}clb=function(attr,value){var element,_j,_len1,_results;_results=[];for(_j=0,_len1=elements.length;_j<_len1;_j++){element=elements[_j];if(element.from===attr){_results.push((function(element){var current_value,tag,type;if(element.to==="text"){tag=adapter.get_attr(element.element,"tagName");type=adapter.get_attr(element.element,"type");if(type==="checkbox"||type==="radio"){current_value=adapter.get_attr(element.element,"value");if(current_value===value){adapter.set_prop(element.element,"checked",true)}}if(tag==="OPTION"){current_value=adapter.get_attr(element.element,"value");if(current_value===value){return adapter.set_prop(element.element,"selected",true)}}else{return element.view.render(value).swap(element.to)}}else{return element.view.render(value).swap(element.to)}})(element))}}return _results};return callbacks.push(clb)}};BaseModel.prototype.bind2=function(klass){this.bind(klass);if(klass.name&&klass.name()==="View"){if(klass.bind&&Sirius.Utils.is_function(klass.bind)){return klass.bind(this)}else{return new Error("For double-sided binding need bind method, but it not found in "+klass)}}else{return new Error("BaseModel#bind2 work only with Sirius.View")}};return BaseModel})();Sirius.View=(function(){View.prototype.name=function(){return"View"};function View(element,clb){this.element=element;if(clb==null){clb=function(txt){return txt}}this._result_fn=(function(_this){return function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];return clb.apply.apply(clb,[null].concat(__slice.call(args)))}})(this)}View.prototype.render=function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];this._result=this._result_fn(args);return this};View.prototype.swap=function(){var a,attributes;attributes=1<=arguments.length?__slice.call(arguments,0):[];return this._apply_strategy({attributes:(function(){var _i,_len,_results;_results=[];for(_i=0,_len=attributes.length;_i<_len;_i++){a=attributes[_i];if(a!==null){_results.push(a)}}return _results})(),name:"swap",transform:function(old,result){return""+result}})};View.prototype.append=function(){var a,attributes;attributes=1<=arguments.length?__slice.call(arguments,0):[];return this._apply_strategy({attributes:(function(){var _i,_len,_results;_results=[];for(_i=0,_len=attributes.length;_i<_len;_i++){a=attributes[_i];if(a!==null){_results.push(a)}}return _results})(),name:"append",transform:function(old,result){return""+old+result}})};View.prototype.prepend=function(){var a,attributes;attributes=1<=arguments.length?__slice.call(arguments,0):[];return this._apply_strategy({attributes:(function(){var _i,_len,_results;_results=[];for(_i=0,_len=attributes.length;_i<_len;_i++){a=attributes[_i];if(a!==null){_results.push(a)}}return _results})(),name:"prepend",transform:function(old,result){return""+result+old}})};View.prototype.on=function(){var adapter,custom_event_name,event_name,handler,params,selector;selector=arguments[0],event_name=arguments[1],custom_event_name=arguments[2],params=4<=arguments.length?__slice.call(arguments,3):[];selector=selector===this.element?selector:""+this.element+" "+selector;adapter=Sirius.Application.adapter;handler=function(e){var _ref;return(_ref=adapter.fire).call.apply(_ref,[null,document,custom_event_name,e].concat(__slice.call(params)))};adapter.bind(document,selector,event_name,handler);return null};View.prototype._apply_strategy=function(object){var adapter,attr,_fn,_i,_len,_ref;if(object==null){object={attributes:[],name:"swap",transform:function(old,result){return""+result}}}adapter=Sirius.Application.adapter;if(object.attributes.length===0){adapter[object.name](this.element,this._result)}else{_ref=object.attributes;_fn=(function(_this){return function(attr){var old_val;if(attr==="text"){return adapter[object.name](_this.element,_this._result)}else{old_val=adapter.get_attr(_this.element,attr);return adapter.set_attr(_this.element,attr,object.transform(old_val,_this._result))}}})(this);for(_i=0,_len=_ref.length;_i<_len;_i++){attr=_ref[_i];_fn(attr)}}return null};View.prototype.clear=function(){Sirius.Application.adapter.clear(this.element);return this};View.prototype.bind=function(klass,object_setting){var adapter,child,children,clb,count,current,from,tmp_from,tmp_to,to,_fn,_i,_len;if(object_setting==null){object_setting={}}var c=function(m){console.log(m)};adapter=Sirius.Application.adapter;current=this.element;if(klass){if(klass.name&&klass.name()==="View"){to=object_setting.to||"text";from=object_setting.from||"text";clb=function(result){var txt;txt=result.text;if((txt!=null)&&!result.attribute){return klass.render(txt).swap(to)}else{return klass.render(txt).swap(to)}};new Sirius.Observer(current,clb)}else{to=object_setting.to;from=object_setting.from;children=adapter.all(""+current+" *");count=children.length;if(count===0){tmp_to=adapter.get_attr(current,"data-bind-to");tmp_from=adapter.get_attr(current,"data-bind-from")||"text";if(to&&tmp_to){new Error("Error: You define `to` attribute twice")}if(from&&tmp_from){new Error("Error: You define `from` attribute twice")}if(!tmp_to&&!to){new Error("Error: need pass `to` attribute into `.bind` method or define `data-bind-to` into html element code")}to=!to?tmp_to:to;from=!from?tmp_from:from;clb=(function(_this){return function(result){var txt;txt=result.text;if((txt!=null)&&from==="text"){klass.set(to,txt)}if(from===result.attribute){return klass.set(to,txt)}}})(this);new Sirius.Observer(this.element,clb)}else{if(to||from){new Error("Error: `to` or `from` which pass into `bind` method, not taken use `data-bind-to` or `name` and `data-bind-from`")}}children=count===0?[current]:children;_fn=function(child){var data_bind_from,data_bind_to;data_bind_to=count===0?to:adapter.get_attr(child,"data-bind-to");if(data_bind_to){if(klass.attributes.indexOf(data_bind_to)===-1){c("Error attribute "+to+" not exist in model class "+klass)}data_bind_from=count===0?from:adapter.get_attr(child,"data-bind-from");if(data_bind_to){clb=function(result){var txt;txt=result.text;if((txt!=null)&&!data_bind_from){klass[data_bind_to](txt)}if(data_bind_from===result.attribute){klass[data_bind_to](txt)}if(data_bind_from==="checked"){return klass[data_bind_to](result.state)}};return new Sirius.Observer(child,clb)}}};for(_i=0,_len=children.length;_i<_len;_i++){child=children[_i];_fn(child)}}}else{if(Sirius.Utils.is_string(klass)){this.bind(new Sirius.View(klass))}else{new Error("Unsupported argument for `bind`. Need View, Model, or String.")}}return this};View.prototype.bind2=function(klass){this.bind(klass);if(klass.bind&&Sirius.Utils.is_function(klass.bind)){return klass.bind(this)}};return View})();Sirius.Utils=(function(){function Utils(){}Utils.is_function=function(a){return Object.prototype.toString.call(a)==="[object Function]"};Utils.is_string=function(a){return Object.prototype.toString.call(a)==="[object String]"};Utils.is_array=function(a){return Object.prototype.toString.call(a)==="[object Array]"};Utils.camelize=function(str){return str.charAt(0).toUpperCase()+str.slice(1)};Utils.underscore=function(str){return str.replace(/([A-Z])/g,"_$1").replace(/^_/,"").toLowerCase()};Utils.ie_version=function(){var msie,rv,trident,ua;ua=window.navigator.userAgent;msie=ua.indexOf("MSIE ");trident=ua.indexOf("Trident/");if(msie>0){return parseInt(ua.substring(msie+5,ua.indexOf(".",msie)),10)}if(trident>0){rv=ua.indexOf("rv:");return parseInt(ua.substring(rv+3,ua.indexOf(".",rv)),10)}return false};return Utils})();Sirius.Collection=(function(){function Collection(klass,klasses,options){if(klasses==null){klasses=[]}if(options==null){options={every:0,on_add:this.on_add,on_remove:this.on_remove,remote:null,on_push:this.on_push}}if(klass.__super__.__name!=="BaseModel"){throw new Error("Collection must be used only with `BaseModel` inheritor")}this._array=[];this._klasses=klasses;this._klass=klass;this._type=this._klass.name;this.on_add=options.on_add||this.on_add;this.on_push=options.on_push||this.on_push;this.on_remove=options.on_push||this.on_remove;if(options.remote){this.remote=(function(_this){return function(){var json,model,result,_i,_len,_results;result=options.remote();json=JSON.parse(result);if(Sirius.Utils.is_array(json)){if(json.length!==0){_results=[];for(_i=0,_len=json.length;_i<_len;_i++){model=json[_i];_results.push(_this.push(klass.from_json(JSON.stringify(model),_this._klasses)))}return _results}}else{return _this.push(klass.from_json(result,_this._klasses))}}})(this)}this._timer=null;this._start_sync(options.every||0)}Collection.prototype._start_sync=function(every){if(every!==0){return this._timer=setInterval(this.remote,every)}};Collection.prototype.unsync=function(){if(this._timer){return clearInterval(this._timer)}};Collection.prototype.sync=function(every){return this._start_sync(every)};Collection.prototype.push=function(model){this._add(model);return this.on_push(model)};Collection.prototype.add=function(model){this._add(model);return this.on_add(model)};Collection.prototype._add=function(model){var type;type=model.constructor.name;if(this._type!==type){throw new Error("Require `"+this._type+"`, but given `"+model.constructor.name+"`")}return this._array.push(model)};Collection.prototype.remove=function(other){var inx;inx=this.index(other);if(inx!==null){this._array.splice(inx,1);return this.on_remove(other)}};Collection.prototype.index=function(other){var i,inx,model,_i,_len,_ref;inx=null;_ref=this._array;for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){model=_ref[i];if(model.compare(other)){inx=i}}return inx};Collection.prototype.find=function(key,value){return this.find_all(key,value)[0]||null};Collection.prototype.find_all=function(key,value){var model,_i,_len,_ref,_results;_ref=this._array;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){model=_ref[_i];if(model.get(key)===value){_results.push(model)}}return _results};Collection.prototype.filter=function(fn){var model,_i,_len,_ref,_results;if(fn==null){fn=function(){}}_ref=this._array;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){model=_ref[_i];if(fn.call(null,model)){_results.push(model)}}return _results};Collection.prototype.each=function(fn){var model,_i,_len,_ref,_results;if(fn==null){fn=function(){}}_ref=this._array;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){model=_ref[_i];_results.push(fn.call(model))}return _results};Collection.prototype.first=function(){return this._array[0]};Collection.prototype.last=function(){return this._array[this._array.length-1]};Collection.prototype.all=function(){return this._array};Collection.prototype.clear=function(){return this._array=[]};Collection.prototype.size=function(){return this._array.length};Collection.prototype.from_json=function(json){var j,jj,_i,_len;j=JSON.stringify(json);if(Sirius.Utils.is_array(j)){for(_i=0,_len=j.length;_i<_len;_i++){jj=j[_i];this._array.push(this._klass.from_json(jj))}}else{this._array.push(this._klass.from_json(json))}return this};Collection.prototype.to_json=function(){var e,z;z=(function(){var _i,_len,_ref,_results;_ref=this._array;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){e=_ref[_i];_results.push(e.to_json())}return _results}).call(this);return JSON.parse(JSON.stringify(z))};Collection.prototype.on_remove=function(model){};Collection.prototype.on_add=function(model){};Collection.prototype.on_push=function(model){};return Collection})();Sirius.Validator=(function(){function Validator(){this.msg=null}Validator.prototype.error_message=function(){return this.msg};return Validator})();Sirius.LengthValidator=(function(_super){__extends(LengthValidator,_super);function LengthValidator(){return LengthValidator.__super__.constructor.apply(this,arguments)}LengthValidator.prototype.validate=function(value,attributes){var actual_length,length,max,min;max=attributes.max||Number.POSITIVE_INFINITY;min=attributes.min||Number.NEGATIVE_INFINITY;length=attributes.length;actual_length=value.length;if(length){if(actual_length===length){return true}else{this.msg="Required length: "+length+", given: "+actual_length;return false}}else{if((actual_length>=min)&&(actual_length<=max)){return true}else{this.msg="Required length in range ["+min+".."+max+"], given: "+actual_length;return false}}};return LengthValidator})(Sirius.Validator);Sirius.ExclusionValidator=(function(_super){__extends(ExclusionValidator,_super);function ExclusionValidator(){return ExclusionValidator.__super__.constructor.apply(this,arguments)}ExclusionValidator.prototype.validate=function(value,attributes){var range;range=attributes.within||[];if(range.indexOf(value)===-1){return true}else{this.msg="Value "+value+" reserved";return false}};return ExclusionValidator})(Sirius.Validator);Sirius.InclusionValidator=(function(_super){__extends(InclusionValidator,_super);function InclusionValidator(){return InclusionValidator.__super__.constructor.apply(this,arguments)}InclusionValidator.prototype.validate=function(value,attributes){var range;range=attributes.within||[];if(range.indexOf(value)>-1){return true}else{this.msg="Value "+value+" should be in range "+range;return false}};return InclusionValidator})(Sirius.Validator);Sirius.FormatValidator=(function(_super){__extends(FormatValidator,_super);function FormatValidator(){return FormatValidator.__super__.constructor.apply(this,arguments)}FormatValidator.prototype.validate=function(value,attributes){var format;format=attributes["with"]||(function(){throw new Error("format attribute required")})();if(format.test(value)){return true}else{this.msg="Value "+value+" not for current format";return false}};return FormatValidator})(Sirius.Validator);Sirius.NumericalityValidator=(function(_super){__extends(NumericalityValidator,_super);function NumericalityValidator(){return NumericalityValidator.__super__.constructor.apply(this,arguments)}NumericalityValidator.prototype.validate=function(value,attributes){if(attributes==null){attributes={}}if(attributes.only_integers){if(/^\d+$/.test(value)){return true}else{this.msg="Only allows integer numbers";return false}}else{if(/^\d+(?:\.\d{1,})?$/.test(value)){return true}else{this.msg="Only allows numbers";return false}}};return NumericalityValidator})(Sirius.Validator);Sirius.PresenceValidator=(function(_super){__extends(PresenceValidator,_super);function PresenceValidator(){return PresenceValidator.__super__.constructor.apply(this,arguments)}PresenceValidator.prototype.validate=function(value,attributes){if(attributes==null){attributes=true}if(value){return true}else{this.msg="Value required";return false}};return PresenceValidator})(Sirius.Validator);